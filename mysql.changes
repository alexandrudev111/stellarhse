/* added by Hend May 17th, 2017 */

USE `stellarhse_auth`;
CREATE 
 OR REPLACE VIEW `get_user_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `o`.`org_id` AS `org_id`,
        `e`.`employee_id` AS `employee_id`,
        `e`.`first_name` AS `first_name`,
        `e`.`last_name` AS `last_name`,
        `e`.`email` AS `email`,
        `e`.`address` AS `address`,
        `e`.`city_id` AS `city_id`,
        `e`.`postal_code` AS `postal_code`,
        `e`.`position` AS `position`,
        `e`.`area` AS `area`,
        `e`.`primary_phone` AS `primary_phone`,
        `e`.`alternate_phone` AS `alternate_phone`,
        `e`.`last_update_date` AS `last_update_date`,
        `e`.`editing_by` AS `editing_by`,
        `e`.`hide` AS `hide`,
        `e`.`supervisor_id` AS `supervisor_id`,
        `e`.`password` AS `password`,
        `e`.`user_name` AS `user_name`,
        `e`.`security_questionid` AS `security_questionid`,
        `e`.`security_answer` AS `security_answer`,
        `e`.`is_login` AS `is_login`,
        `em`.`first_name` AS `supervisor_name`
    FROM
        (((`employee` `e`
        JOIN `org_employee` `oe` ON ((`oe`.`employee_id` = `e`.`employee_id`)))
        JOIN `organization` `o` ON ((`oe`.`org_id` = `o`.`org_id`)))
        LEFT JOIN `employee` `em` ON ((`e`.`supervisor_id` = `em`.`employee_id`)));

/* */

/* added by Alaa May 17th, 2017 */

USE `stellarhse_common`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `stellarhse_common`.`location_view` AS
    SELECT 
        `stellarhse_common`.`location1`.`org_id` AS `org_id`,
        `stellarhse_common`.`location1`.`location1_id` AS `location1_id`,
        `stellarhse_common`.`location1`.`location1_name` AS `location1_name`,
        `stellarhse_common`.`location1`.`order` AS `location1_order`,
        `stellarhse_common`.`location1`.`hide` AS `location1_hide`,
        `stellarhse_common`.`location2`.`location2_id` AS `location2_id`,
        `stellarhse_common`.`location2`.`location2_name` AS `location2_name`,
        `stellarhse_common`.`location2`.`order` AS `location2_order`,
        `stellarhse_common`.`location2`.`hide` AS `location2_hide`,
        `stellarhse_common`.`location3`.`location3_id` AS `location3_id`,
        `stellarhse_common`.`location3`.`location3_name` AS `location3_name`,
        `stellarhse_common`.`location3`.`order` AS `location3_order`,
        `stellarhse_common`.`location3`.`hide` AS `location3_hide`,
        `stellarhse_common`.`location4`.`location4_id` AS `location4_id`,
        `stellarhse_common`.`location4`.`location4_name` AS `location4_name`,
        `stellarhse_common`.`location4`.`order` AS `location4_order`,
        `stellarhse_common`.`location4`.`hide` AS `location4_hide`
    FROM
        (((`stellarhse_common`.`location1`
        LEFT JOIN `stellarhse_common`.`location2` ON ((`stellarhse_common`.`location1`.`location1_id` = `stellarhse_common`.`location2`.`location1_id`)))
        LEFT JOIN `stellarhse_common`.`location3` ON ((`stellarhse_common`.`location2`.`location2_id` = `stellarhse_common`.`location3`.`location2_id`)))
        LEFT JOIN `stellarhse_common`.`location4` ON ((`stellarhse_common`.`location3`.`location3_id` = `stellarhse_common`.`location4`.`location3_id`)));

/* */

/* added by Hend May 21th, 2017 */

USE `stellarhse_common`;
CREATE 
VIEW `get_third_party_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `tp`.`third_party_id` AS `third_party_id`,
        `tp`.`third_party_name` AS `third_party_name`,
        `tp`.`contact_name` AS `contact_name`,
        `tp`.`org_id` AS `org_id`,
        `tp`.`address` AS `address`,
        `tp`.`city_id` AS `city_id`,
        `tp`.`postal_code` AS `postal_code`,
        `tp`.`primary_phone` AS `primary_phone`,
        `tp`.`is_active` AS `is_active`,
        `tp`.`last_update_date` AS `last_update_date`,
        `tp`.`editing_by` AS `editing_by`,
        `tp`.`hide` AS `hide`,
        `tpt`.`third_party_type_id` AS `third_party_type_id`,
        `tpt`.`third_party_type_code` AS `third_party_type_code`,
        `tpt`.`third_party_type_name` AS `third_party_type_name`,
        `tpt`.`language_id` AS `language_id`,
        `tpt`.`order` AS `order`,
        `tpt`.`last_update_date` AS `type_last_update_date`,
        `tpt`.`editing_by` AS `type_editing_by`,
        `tpt`.`hide` AS `type_hide`
    FROM
        ((`stellarhse_common`.`third_party` `tp`
        JOIN `stellarhse_common`.`third_party_type` `tpt` ON ((`tp`.`third_party_type_id` = `tpt`.`third_party_type_id`)))
        JOIN `stellarhse_auth`.`organization` `o` ON ((`tp`.`org_id` = `o`.`org_id`)));

/* */

/* added by Alaa May 22th, 2017 */

USE `stellarhse_auth`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `get_user_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `o`.`org_id` AS `org_id`,
        `e`.`employee_id` AS `employee_id`,
        `e`.`first_name` AS `first_name`,
        `e`.`last_name` AS `last_name`,
        CONCAT(`e`.`first_name`, ' ', `e`.`last_name`) AS `full_name`,
        `e`.`email` AS `email`,
        `e`.`address` AS `address`,
        `e`.`city_id` AS `city_id`,
        `e`.`postal_code` AS `postal_code`,
        `e`.`position` AS `position`,
        `e`.`area` AS `area`,
        `e`.`primary_phone` AS `primary_phone`,
        `e`.`alternate_phone` AS `alternate_phone`,
        `e`.`last_update_date` AS `last_update_date`,
        `e`.`editing_by` AS `editing_by`,
        `e`.`hide` AS `hide`,
        `e`.`supervisor_id` AS `supervisor_id`,
        `e`.`password` AS `password`,
        `e`.`user_name` AS `user_name`,
        `e`.`security_questionid` AS `security_questionid`,
        `e`.`security_answer` AS `security_answer`,
        `e`.`is_login` AS `is_login`,
        `em`.`first_name` AS `supervisor_name`
    FROM
        (((`employee` `e`
        JOIN `org_employee` `oe` ON ((`oe`.`employee_id` = `e`.`employee_id`)))
        JOIN `organization` `o` ON ((`oe`.`org_id` = `o`.`org_id`)))
        LEFT JOIN `employee` `em` ON ((`e`.`supervisor_id` = `em`.`employee_id`)));

/* */

/* added by Hend May 25th, 2017 */

USE `stellarhse_auth`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
VIEW `get_user_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `o`.`org_id` AS `org_id`,
        `e`.`employee_id` AS `employee_id`,
        `e`.`first_name` AS `first_name`,
        `e`.`last_name` AS `last_name`,
        `e`.`emp_id` AS `emp_id`,
        `e`.`email` AS `email`,
        `e`.`address` AS `address`,
        `e`.`city_id` AS `city_id`,
        `e`.`postal_code` AS `postal_code`,
        `e`.`position` AS `position`,
        `e`.`area` AS `area`,
        `e`.`primary_phone` AS `primary_phone`,
        `e`.`alternate_phone` AS `alternate_phone`,
        `e`.`last_update_date` AS `last_update_date`,
        `e`.`editing_by` AS `editing_by`,
        `e`.`hide` AS `hide`,
        `e`.`supervisor_id` AS `supervisor_id`,
        `e`.`password` AS `password`,
        `e`.`user_name` AS `user_name`,
        `e`.`security_questionid` AS `security_questionid`,
        `e`.`security_answer` AS `security_answer`,
        `e`.`is_login` AS `is_login`,
        `e`.`crew_id` AS `crew_id`,
        `c`.`crew_name` AS `crew_name`,
        `em`.`first_name` AS `supervisor_name`
    FROM
        ((((`employee` `e`
        JOIN `org_employee` `oe` ON ((`oe`.`employee_id` = `e`.`employee_id`)))
        JOIN `organization` `o` ON ((`oe`.`org_id` = `o`.`org_id`)))
        LEFT JOIN `crew` `c` ON ((`e`.`crew_id` = `c`.`crew_id`)))
        LEFT JOIN `employee` `em` ON ((`e`.`supervisor_id` = `em`.`employee_id`)));

/* */

/* added by Hend June 6th, 2017 */
USE `stellarhse_auth`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
VIEW `stellarhse_auth`.`get_user_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `o`.`org_id` AS `org_id`,
          `o`.`language_id` AS `language_id`,
        `e`.`employee_id` AS `employee_id`,
        `e`.`first_name` AS `first_name`,
        `e`.`last_name` AS `last_name`,
        CONCAT(`e`.`first_name`, ' ', `e`.`last_name`) AS `full_name`,
        `e`.`email` AS `email`,
        `e`.`address` AS `address`,
        `e`.`city_id` AS `city_id`,
        `e`.`postal_code` AS `postal_code`,
        `e`.`position` AS `position`,
        `e`.`area` AS `area`,
        `e`.`primary_phone` AS `primary_phone`,
        `e`.`alternate_phone` AS `alternate_phone`,
        `e`.`last_update_date` AS `last_update_date`,
        `e`.`editing_by` AS `editing_by`,
        `e`.`hide` AS `hide`,
        `e`.`supervisor_id` AS `supervisor_id`,
        `e`.`password` AS `password`,
        `e`.`user_name` AS `user_name`,
        `e`.`security_questionid` AS `security_questionid`,
        `e`.`security_answer` AS `security_answer`,
        `e`.`is_login` AS `is_login`,
        `em`.`first_name` AS `supervisor_name`
    FROM
        (((`stellarhse_auth`.`employee` `e`
        JOIN `stellarhse_auth`.`org_employee` `oe` ON ((`oe`.`employee_id` = `e`.`employee_id`)))
        JOIN `stellarhse_auth`.`organization` `o` ON ((`oe`.`org_id` = `o`.`org_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `em` ON ((`e`.`supervisor_id` = `em`.`employee_id`)));


/* */

/* added by Hend June 8th, 2017 */

use stellarhse_hazard;
alter table hazard change column  is_deleted is_deleted  tinyint(1) default 0;

/* */

/* added by Alaa June 20th, 2017 */

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
DROP COLUMN `super_visor`;

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action` 
CHANGE COLUMN `haz_corrective_action_id` `hazard_corrective_action_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ;

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action` 
DROP FOREIGN KEY `FK_HazCorrectiveAction_AssignedById`;
ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action` 
DROP COLUMN `assigned_by_id`,
DROP INDEX `FK_HazCorrectiveAction_AssignedById_idx` ;

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
DROP FOREIGN KEY `FK_hazCorrectiveActionNotified_haz_corrective_action_id`;
ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
CHANGE COLUMN `haz_corrective_action_id` `hazard_corrective_action_id` VARCHAR(100) NOT NULL ;

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
DROP FOREIGN KEY `FK_hazCorrectiveActionNotified_haz_corrective_action_id`;

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
ADD CONSTRAINT `FK_hazCorrectiveActionNotified_haz_corrective_action_id`
  FOREIGN KEY (`hazard_corrective_action_id`)
  REFERENCES `stellarhse_hazard`.`hazard_corrective_action` (`hazard_corrective_action_id`)
  ON DELETE RESTRICT
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
DROP FOREIGN KEY `FK_hazCorrectiveActionNotified_EmployeeId`;
ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
CHANGE COLUMN `employee_id` `notified_id` VARCHAR(100) NOT NULL ;
ALTER TABLE `stellarhse_hazard`.`hazard_corrective_action_notified` 
ADD CONSTRAINT `FK_hazCorrectiveActionNotified_EmployeeId`
  FOREIGN KEY (`notified_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

/* */

/* added by Alaa June 22th, 2017 */

USE `stellarhse_hazard`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `all_corrective_action` AS
    SELECT 
        `hca`.`hazard_corrective_action_id` AS `corrective_action_id`,
        `h`.`hazard_number` AS `hazard_number`,
        `h`.`hazard_id` AS `hazard_id`,
        `h`.`hazard_date` AS `hazard_date`,
        `h`.`hazard_time` AS `hazard_hour`,
        `h`.`hazard_min` AS `hazard_min`,
        `h`.`org_id` AS `org_id`,
        `cs`.`corrective_action_status_name` AS `status`,
        `cp`.`corrective_action_priority_name` AS `priority`,
        CONCAT(`ed`.`first_name`, ' ', `ed`.`last_name`) AS `editing_by`,
        CONCAT(`e`.`first_name`, ' ', `e`.`last_name`) AS `assigned_to`,
        `hca`.`start_date` AS `start_date`,
        `hca`.`target_end_date` AS `target_end_date`,
        `hca`.`actual_end_date` AS `actual_end_date`,
        `hca`.`estimated_cost` AS `estimated_cost`,
        `hca`.`actual_cost` AS `actual_cost`,
        `hca`.`out_come_follow_up` AS `out_come_follow_up`,
        `hca`.`desired_results` AS `desired_results`,
        `hca`.`comments` AS `comments`,
        (SELECT 
                GROUP_CONCAT(CONCAT(`x`.`first_name`, ' ', `x`.`last_name`)
                        SEPARATOR ', ')
            FROM
                (`stellarhse_hazard`.`hazard_corrective_action_notified` `hcan1`
                JOIN `stellarhse_auth`.`employee` `x` ON ((`hcan1`.`notified_id` = `x`.`employee_id`)))
            WHERE
                (`hca`.`hazard_corrective_action_id` = `hcan1`.`hazard_corrective_action_id`)) AS `notified_names`,
        `hca`.`task_description` AS `task_description`
    FROM
        (((((`stellarhse_hazard`.`hazard_corrective_action` `hca`
        JOIN `stellarhse_hazard`.`hazard` `h` ON ((`h`.`hazard_id` = `hca`.`hazard_id`)))
        LEFT JOIN `stellarhse_common`.`corrective_action_status` `cs` ON ((`cs`.`corrective_action_status_id` = `hca`.`corrective_action_status_id`)))
        LEFT JOIN `stellarhse_common`.`corrective_action_priority` `cp` ON ((`cp`.`corrective_action_priority_id` = `hca`.`corrective_action_priority_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e` ON ((`e`.`employee_id` = `hca`.`assigned_to_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `ed` ON ((`h`.`editing_by` = `ed`.`employee_id`)))
    WHERE
        (`h`.`is_deleted` = 0)
    GROUP BY `corrective_action_id`
    ORDER BY `h`.`hazard_number`;

/* */

/* added by Alaa June 22th, 2017 */

USE `stellarhse_hazard`;
DROP procedure IF EXISTS `sp_all_corrective_action`;

DELIMITER $$
USE `stellarhse_hazard`$$
CREATE PROCEDURE `sp_all_corrective_action`($org_id varchar(50),$search varchar(1000),$lmt int,$strt int)
begin
set @sql = concat('select SQL_CALC_FOUND_ROWS * from all_corrective_action ');
if  $org_id <>'' then 
set @sql = concat(@sql,' where org_id =',"'",$org_id,"'");
end if;

if $search <> '' and $org_id <>''  then 
set @sql = concat(@sql,' and ',$search);
end if;

if ($search <> '' and ($org_id =''))  then 
set @sql = concat(@sql,' where ',$search);
end if;

set @sql = concat(@sql,' limit ',$strt,',',$lmt);
-- select @sql;
prepare stmt from @sql;
execute stmt;
deallocate prepare stmt;
select FOUND_ROWS();
end$$

DELIMITER ;


/* */

/* added by Hend June 28th, 2017 */

ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `Suspected_cause_of_hazard` `suspected_cause_of_hazard` TEXT NULL DEFAULT NULL ;


/* added by Alaa June 28th, 2017 */

USE `stellarhse_auth`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    DEFINER = `devuser`@`%` 
    SQL SECURITY DEFINER
VIEW `get_user_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `o`.`org_id` AS `org_id`,
        `o`.`language_id` AS `language_id`,
        `e`.`employee_id` AS `employee_id`,
        `e`.`first_name` AS `first_name`,
        `e`.`last_name` AS `last_name`,
        CONCAT(`e`.`first_name`, ' ', `e`.`last_name`) AS `full_name`,
        `e`.`emp_id` AS `emp_id`,
        `e`.`email` AS `email`,
        `e`.`address` AS `address`,
        `e`.`city_id` AS `city_id`,
        `e`.`postal_code` AS `postal_code`,
        `e`.`position` AS `position`,
        `e`.`area` AS `area`,
        `e`.`primary_phone` AS `primary_phone`,
        `e`.`alternate_phone` AS `alternate_phone`,
        `e`.`last_update_date` AS `last_update_date`,
        `e`.`editing_by` AS `editing_by`,
        `e`.`hide` AS `hide`,
        `e`.`supervisor_id` AS `supervisor_id`,
        `e`.`crew_id` AS `crew_id`,
        `e`.`password` AS `password`,
        `e`.`user_name` AS `user_name`,
        `e`.`security_questionid` AS `security_questionid`,
        `e`.`security_answer` AS `security_answer`,
        `e`.`is_login` AS `is_login`,
        CONCAT(`em`.`first_name`, ' ', `em`.`last_name`) AS `supervisor_name`,
        `c`.`crew_name` AS `crew_name`
    FROM
        ((((`employee` `e`
        JOIN `org_employee` `oe` ON ((`oe`.`employee_id` = `e`.`employee_id`)))
        JOIN `organization` `o` ON ((`oe`.`org_id` = `o`.`org_id`)))
        LEFT JOIN `employee` `em` ON ((`e`.`supervisor_id` = `em`.`employee_id`)))
        LEFT JOIN `crew` `c` ON ((`e`.`crew_id` = `c`.`crew_id`)));

/* */

/* added by Alaa June 28th, 2017 */

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
ADD COLUMN `safetymeeting_other_location` VARCHAR(200) NULL DEFAULT NULL AFTER `safety_meeting_number`;

/* */

/* added by Alaa June 28th, 2017 */

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
CHANGE COLUMN `reason_for_safety_meeting` `safety_meeting_description` TEXT NULL DEFAULT NULL ;

/* */

/* added by Alaa July 2nd, 2017 */

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
DROP COLUMN `meeting_desc`;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
DROP COLUMN `sign_off_date`;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
DROP FOREIGN KEY `FK_SMCorrectiveAction_CorrActStatusId`;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
CHANGE COLUMN `safetymeeting_folloeup_action_id` `safetymeeting_followup_action_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ,
CHANGE COLUMN `safetymeeting_corr_act_status_id` `safetymeeting_followup_action_status_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
ADD CONSTRAINT `FK_SMCorrectiveAction_CorrActStatusId`
  FOREIGN KEY (`safetymeeting_followup_action_status_id`)
  REFERENCES `stellarhse_common`.`corrective_action_status` (`corrective_action_status_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
DROP FOREIGN KEY `FK_SMCorrectiveAction_PriorityId`;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
CHANGE COLUMN `priority_id` `safetymeeting_followup_priority_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
ADD CONSTRAINT `FK_SMCorrectiveAction_PriorityId`
  FOREIGN KEY (`safetymeeting_followup_priority_id`)
  REFERENCES `stellarhse_common`.`corrective_action_priority` (`corrective_action_priority_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_corrective_action_notified` 
RENAME TO  `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` ;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` 
DROP FOREIGN KEY `FK_SMCorrectiveActionNotified_CorrectiveActionId`;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` 
CHANGE COLUMN `safetymeeting_corrective_action_id` `safetymeeting_followup_action_id` VARCHAR(100) NOT NULL ;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` 
ADD CONSTRAINT `FK_SMCorrectiveActionNotified_CorrectiveActionId`
  FOREIGN KEY (`safetymeeting_followup_action_id`)
  REFERENCES `stellarhse_safetymeeting`.`safetymeeting_followup_action` (`safetymeeting_followup_action_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
DROP FOREIGN KEY `FK_SafetyMeeting_EventTypeId`;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
ADD CONSTRAINT `FK_SafetyMeeting_EventTypeId`
  FOREIGN KEY (`safetymeeting_type_id`)
  REFERENCES `stellarhse_safetymeeting`.`safetymeeting_event_type` (`safetymeeting_type_id`)
  ON UPDATE CASCADE;

/* */

/* added by Alaa July 3rd, 2017 */

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action` 
ADD COLUMN `supervisor_notify` TINYINT(2) NULL DEFAULT 0 AFTER `supervisor`;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` 
DROP FOREIGN KEY `FK_SMCorrectiveActionNotified_EmployeeId`;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` 
CHANGE COLUMN `employee_id` `notified_id` VARCHAR(100) NOT NULL ;
ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` 
ADD CONSTRAINT `FK_SMCorrectiveActionNotified_EmployeeId`
  FOREIGN KEY (`notified_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

/* */

/* added by Hend July 7th, 2017 */

ALTER TABLE `stellarhse_inspection`.`inspection` 
DROP FOREIGN KEY `FK_Inspection_reason_for_inspection_id`;
ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `reason_for_inspection_id` `inspection_reason_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_inspection`.`inspection` 
ADD CONSTRAINT `FK_Inspection_reason_for_inspection_id`
  FOREIGN KEY (`inspection_reason_id`)
  REFERENCES `stellarhse_inspection`.`inspection_reason` (`inspection_reason_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `Suspected_cause_of_hazard` `hazard_suspected_cause` TEXT NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `initial_actions_taken` `initial_action_token` TEXT NULL DEFAULT NULL ;


ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `summary_of_recommended_corrective_actions` `recommended_corrective_actions_summary` TEXT NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `other_location` `hazard_other_location` VARCHAR(200) NULL DEFAULT NULL ;


ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `is_deleted` `is_deleted` TINYINT(1) NULL DEFAULT b'0' ;

ALTER TABLE `stellarhse_inspection`.`inspection_third_party` 
CHANGE COLUMN `inspection_third_party` `inspection_third_party_id` VARCHAR(100) NOT NULL DEFAULT 'myuuid function' ;

ALTER TABLE `stellarhse_inspection`.`inspection_corrective_action` 
DROP FOREIGN KEY `FK_insCorrectiveAction_CorrActStatusId`;
ALTER TABLE `stellarhse_inspection`.`inspection_corrective_action` 
CHANGE COLUMN `inspection_corrective_action_status_id` `corrective_action_status_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_inspection`.`inspection_corrective_action` 
ADD CONSTRAINT `FK_insCorrectiveAction_CorrActStatusId`
  FOREIGN KEY (`corrective_action_status_id`)
  REFERENCES `stellarhse_common`.`corrective_action_status` (`corrective_action_status_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_inspection`.`inspection_corrective_action` 
DROP FOREIGN KEY `FK_insCorrectiveAction_PriorityId`;
ALTER TABLE `stellarhse_inspection`.`inspection_corrective_action` 
CHANGE COLUMN `priority_id` `corrective_action_priority_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_inspection`.`inspection_corrective_action` 
ADD CONSTRAINT `FK_insCorrectiveAction_PriorityId`
  FOREIGN KEY (`corrective_action_priority_id`)
  REFERENCES `stellarhse_common`.`corrective_action_priority` (`corrective_action_priority_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_inspection`.`inspection_acting` 
DROP FOREIGN KEY `FK_ins_acting_Inspection_people_involved_id`;
ALTER TABLE `stellarhse_inspection`.`inspection_acting` 
CHANGE COLUMN `inspection_people_involved_id` `people_involved_id` VARCHAR(100) NOT NULL ;
ALTER TABLE `stellarhse_inspection`.`inspection_acting` 
ADD CONSTRAINT `FK_ins_acting_Inspection_people_involved_id`
  FOREIGN KEY (`people_involved_id`)
  REFERENCES `stellarhse_inspection`.`inspection_people_involved` (`people_involved_id`)
  ON UPDATE CASCADE;

/* */

/* added by Alaa July 9th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident_corrective_action` 
DROP FOREIGN KEY `FK_incident_corrective_action_CorrActStatusId`,
DROP FOREIGN KEY `FK_incident_corrective_action_PriorityId`;
ALTER TABLE `stellarhse_incident`.`incident_corrective_action` 
CHANGE COLUMN `supervisor` `supervisor` VARCHAR(200) NULL DEFAULT NULL AFTER `assigned_to_id`,
CHANGE COLUMN `notify_supervisor` `notify_supervisor` TINYINT(2) NULL DEFAULT '0' AFTER `supervisor`,
CHANGE COLUMN `actual_cost` `actual_cost` DECIMAL(10,2) NULL DEFAULT NULL AFTER `estimated_cost`,
CHANGE COLUMN `corr_act_status_id` `corrective_action_status_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `priority_id` `corrective_action_priority_id` VARCHAR(100) NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_incident`.`incident_corrective_action` 
ADD CONSTRAINT `FK_incident_corrective_action_CorrActStatusId`
  FOREIGN KEY (`corrective_action_status_id`)
  REFERENCES `stellarhse_common`.`corrective_action_status` (`corrective_action_status_id`)
  ON DELETE RESTRICT
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_incident_corrective_action_PriorityId`
  FOREIGN KEY (`corrective_action_priority_id`)
  REFERENCES `stellarhse_common`.`corrective_action_priority` (`corrective_action_priority_id`)
  ON DELETE RESTRICT
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_event_type` 
CHANGE COLUMN `event_type_name` `incident_event_type_name` VARCHAR(255) NOT NULL ;

ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `is_emer_r_p` `is_emergency_response` BIT(1) NULL DEFAULT NULL ;

/* */

/* added by Alaa July 13th, 2017 */

USE `stellarhse_safetymeeting`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `all_corrective_action_view` AS
    SELECT 
        `ifa`.`safetymeeting_followup_action_id` AS `followup_action_id_`,
        `sm`.`safetymeeting_number` AS `safetymeeting_number`,
        `sm`.`safetymeeting_id` AS `safetymeeting_id`,
        DATE_FORMAT(`sm`.`safetymeeting_date`, '%m/%d/%Y') AS `safetymeeting_date`,
        `sm`.`safetymeeting_hour` AS `safetymeeting_hour`,
        `sm`.`safetymeeting_min` AS `safetymeeting_min`,
        `sm`.`creator_id` AS `creator_id`,
        `sm`.`org_id` AS `org_id`,
        `o`.`org_name` AS `organization_name`,
        `cs`.`corrective_action_status_name` AS `status`,
        `cp`.`corrective_action_priority_name` AS `priority`,
        CONCAT(`ed`.`first_name`, ' ', `ed`.`last_name`) AS `editing_by`,
        CONCAT(`e`.`first_name`, ' ', `e`.`last_name`) AS `assigned_to`,
        `ifa`.`supervisor` AS `supervisor`,
        CONCAT(`e2`.`first_name`, ' ', `e2`.`last_name`) AS `modifier_by`,
        `ifa`.`start_date` AS `start_date`,
        `ifa`.`target_end_date` AS `target_end_date`,
        `ifa`.`actual_end_date` AS `actual_end_date`,
        `ifa`.`estimated_cost` AS `estimated_cost`,
        `ifa`.`actual_cost` AS `actual_cost`,
        `ifa`.`task_description` AS `task_description`,
        `ifa`.`out_come_follow_up` AS `out_come_follow_up`,
        `ifa`.`desired_results` AS `desired_results`,
        `ifa`.`comments` AS `comments`,
        NULL AS `sent_date`,
        (SELECT 
                GROUP_CONCAT(CONCAT(`x`.`first_name`, ' ', `x`.`last_name`)
                        SEPARATOR ', ')
            FROM
                (`stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` `ifan1`
                JOIN `stellarhse_auth`.`employee` `x` ON ((`ifan1`.`notified_id` = `x`.`employee_id`)))
            WHERE
                (`ifa`.`safetymeeting_followup_action_id` = `ifan1`.`safetymeeting_followup_action_id`)) AS `notified_names`
    FROM
        (((((((`stellarhse_safetymeeting`.`safetymeeting_followup_action` `ifa`
        LEFT JOIN `stellarhse_safetymeeting`.`safetymeeting` `sm` ON ((`sm`.`safetymeeting_id` = `ifa`.`safetymeeting_id`)))
        LEFT JOIN `stellarhse_common`.`corrective_action_status` `cs` ON ((`cs`.`corrective_action_status_id` = `ifa`.`safetymeeting_followup_action_status_id`)))
        LEFT JOIN `stellarhse_auth`.`organization` `o` ON ((`o`.`org_id` = `sm`.`org_id`)))
        LEFT JOIN `stellarhse_common`.`corrective_action_priority` `cp` ON ((`cp`.`corrective_action_priority_id` = `ifa`.`safetymeeting_followup_priority_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e` ON ((`e`.`employee_id` = `ifa`.`assigned_to_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `ed` ON ((`sm`.`editing_by` = `ed`.`employee_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON ((`sm`.`modifier_id` = `e2`.`employee_id`)))
    WHERE
        (`sm`.`is_deleted` = 0)
    ORDER BY `sm`.`safetymeeting_number`;

/* */

/* added by Alaa July 18th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `inv_summary` `investigation_summary` TEXT NULL DEFAULT NULL ,
CHANGE COLUMN `follow_up_note` `investigation_follow_up_note` TEXT NULL DEFAULT NULL ;
CHANGE COLUMN `response_cost` `investigation_response_cost` DECIMAL(10,2) NULL DEFAULT NULL ,
CHANGE COLUMN `repair_cost` `investigation_repair_cost` DECIMAL(10,2) NULL DEFAULT NULL ,
CHANGE COLUMN `insurance_cost` `investigation_insurance_cost` DECIMAL(10,2) NULL DEFAULT NULL ,
CHANGE COLUMN `w_c_b_cost` `investigation_wcb_cost` DECIMAL(10,2) NULL DEFAULT NULL ,
CHANGE COLUMN `other_cost` `investigation_other_cost` DECIMAL(10,2) NULL DEFAULT NULL ,
CHANGE COLUMN `total_cost` `investigation_total_cost` DECIMAL(11,2) NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_incident`.`incident` 
DROP FOREIGN KEY `FK_Incident_IncidentSeverityId`,
DROP FOREIGN KEY `FK_Incident_RiskOfRecurrenceId`;
ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `risk_of_recurrence_id` `investigation_risk_of_recurrence_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `incident_severity_id` `investigation_severity_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `source_details` `investigation_source_details` TEXT NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident` 
ADD CONSTRAINT `FK_Incident_IncidentSeverityId`
  FOREIGN KEY (`investigation_severity_id`)
  REFERENCES `stellarhse_incident`.`severity` (`severity_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_Incident_RiskOfRecurrenceId`
  FOREIGN KEY (`investigation_risk_of_recurrence_id`)
  REFERENCES `stellarhse_incident`.`risk_of_recurrence` (`risk_of_recurrence_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `sign_off_date` `investigation_sign_off_date` DATETIME NULL DEFAULT NULL AFTER `sign_off_investigator_name`,
CHANGE COLUMN `root_cause_note` `investigation_root_cause_note` TEXT NULL DEFAULT NULL ;

/* */

/* added by Alaa July 19th, 2017 */

INSERT INTO `stellarhse_common`.`how_involved_field` (`how_involved_id`,`field_code`, `language_id`, `how_involved_name`, `key`, `org_id`, `hide`) VALUES (MyUUID(),'investigator', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Investigator', 'investigator', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', '0');
INSERT INTO `stellarhse_common`.`how_involved_field` (`how_involved_id`,`field_code`, `language_id`, `how_involved_name`, `key`, `hide`) VALUES (MyUUID(),'investigator', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Investigator', 'investigator', '0');

/* */

/* added by Alaa July 20th, 2017 */

USE `stellarhse_auth`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `stellarhse_auth`.`get_user_info` AS
    SELECT 
        `o`.`org_name` AS `org_name`,
        `o`.`org_id` AS `org_id`,
        `o`.`language_id` AS `language_id`,
        `e`.`employee_id` AS `employee_id`,
        `e`.`first_name` AS `first_name`,
        `e`.`last_name` AS `last_name`,
        CONCAT(`e`.`first_name`, ' ', `e`.`last_name`) AS `full_name`,
        `e`.`emp_id` AS `emp_id`,
        `e`.`email` AS `email`,
        `e`.`address` AS `address`,
        `e`.`city_id` AS `city_id`,
        `e`.`postal_code` AS `postal_code`,
        `e`.`position` AS `position`,
        `e`.`area` AS `area`,
        `e`.`primary_phone` AS `primary_phone`,
        `e`.`alternate_phone` AS `alternate_phone`,
        `e`.`last_update_date` AS `last_update_date`,
        `e`.`editing_by` AS `editing_by`,
        `e`.`hide` AS `hide`,
        `e`.`supervisor_id` AS `supervisor_id`,
        `e`.`crew_id` AS `crew_id`,
        `e`.`password` AS `password`,
        `e`.`user_name` AS `user_name`,
        `e`.`security_questionid` AS `security_questionid`,
        `e`.`security_answer` AS `security_answer`,
        `e`.`is_login` AS `is_login`,
        CONCAT(`em`.`first_name`, ' ', `em`.`last_name`) AS `supervisor_name`,
        `c`.`crew_name` AS `crew_name`,
        `oe`.`department` AS `department`
    FROM
        ((((`stellarhse_auth`.`employee` `e`
        JOIN `stellarhse_auth`.`org_employee` `oe` ON ((`oe`.`employee_id` = `e`.`employee_id`)))
        JOIN `stellarhse_auth`.`organization` `o` ON ((`oe`.`org_id` = `o`.`org_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `em` ON ((`e`.`supervisor_id` = `em`.`employee_id`)))
        LEFT JOIN `stellarhse_auth`.`crew` `c` ON ((`e`.`crew_id` = `c`.`crew_id`)));

/* */

/* added by Alaa July 20th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident_impact` 
DROP FOREIGN KEY `FK_Impact_PrimRespondId`;
ALTER TABLE `stellarhse_incident`.`incident_impact` 
CHANGE COLUMN `prim_respond_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL AFTER `custom_open_txt`,
CHANGE COLUMN `prim_respond_name` `primary_responder_name` VARCHAR(255) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_impact` 
ADD CONSTRAINT `FK_Impact_PrimRespondId`
  FOREIGN KEY (`primary_responder_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_impact` 
DROP FOREIGN KEY `FK_incident_impact_Intemployee_id4`;
ALTER TABLE `stellarhse_incident`.`incident_impact` 
DROP COLUMN `initial_employee_dept4`,
DROP COLUMN `initial_employee_name4`,
DROP COLUMN `initial_employee_id4`,
CHANGE COLUMN `primary_responder_name` `primary_responder_name` VARCHAR(100) NULL DEFAULT NULL ,
DROP INDEX `FK_incident_impact_Intemployee_id4_idx` ;

/* */

/* added by Alaa July 20th, 2017 */

ALTER TABLE `stellarhse_incident`.`sp_rel_agency` 
RENAME TO  `stellarhse_incident`.`spill_release_agency` ;

ALTER TABLE `stellarhse_incident`.`spill_release_agency` 
CHANGE COLUMN `sp_rel_agency_id` `spill_release_agency_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ,
CHANGE COLUMN `sp_rel_agency_name` `spill_release_agency_name` VARCHAR(255) NOT NULL ;

ALTER TABLE `stellarhse_incident`.`spill_release_source` 
CHANGE COLUMN `source_id` `spill_release_source_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ,
CHANGE COLUMN `source_name` `spill_release_source_name` VARCHAR(255) NOT NULL ;

ALTER TABLE `stellarhse_incident`.`spill_release` 
CHANGE COLUMN `what_was_it` `what_was_spill_release` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `how_did_s_r_occur` `how_spill_release_occur` TEXT NULL DEFAULT NULL ;\\

ALTER TABLE `stellarhse_incident`.`traffic_violation` 
CHANGE COLUMN `traffic_driver_id` `driver_id` VARCHAR(100) NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_incident`.`traffic_violation` 
CHANGE COLUMN `details` `damage_description` TEXT NULL DEFAULT NULL ;

/* */

/* added by Hend July 25th, 2017 */


ALTER TABLE `stellarhse_incident`.`incident` 
DROP COLUMN `rep_id`;


ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `supervisor` `rep_supervisor` VARCHAR(15) NULL DEFAULT NULL ;


ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `crew` `rep_crew` VARCHAR(15) NULL DEFAULT NULL ;

/* */

/* added by Alaa July 26th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident` 
ADD COLUMN `crew_involved` VARCHAR(100) NULL DEFAULT NULL AFTER `operation_type_id`,
CHANGE COLUMN `is_emergency_response` `is_emergency_response` BIT(1) NULL DEFAULT NULL AFTER `crew_involved`,
ADD COLUMN `rep_emp_id` VARCHAR(100) NULL DEFAULT NULL AFTER `rep_name`,
ADD COLUMN `rep_crew` VARCHAR(100) NULL DEFAULT NULL AFTER `rep_alternate_phone`,
ADD COLUMN `rep_supervisor` VARCHAR(100) NULL DEFAULT NULL AFTER `rep_crew`;

ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `incident_description` `incident_description` TEXT NULL DEFAULT NULL AFTER `event_sequence`;

ALTER TABLE `stellarhse_incident`.`incident` 
DROP FOREIGN KEY `FK_Incident_event_type_id`;
ALTER TABLE `stellarhse_incident`.`incident` 
ADD INDEX `FK_Incident_event_type_id_idx` (`event_type_id` ASC),
DROP INDEX `FK_Incident_event_type_id_idx` ;
ALTER TABLE `stellarhse_incident`.`incident` 
ADD CONSTRAINT `FK_Incident_event_type_id`
  FOREIGN KEY (`event_type_id`)
  REFERENCES `stellarhse_incident`.`incident_event_type` (`incident_event_type_id`)
  ON UPDATE CASCADE;

/* */

/* added by Hend July 26th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident_corrective_action` 
CHANGE COLUMN `notify_supervisor` `supervisor_notify` TINYINT(2) NULL DEFAULT '0' ;

/* */

/* added by Alaa July 27th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident` 
DROP COLUMN `rep_id`;

ALTER TABLE `stellarhse_incident`.`incident` 
DROP FOREIGN KEY `FK_Incident_ReporterId`;
ALTER TABLE `stellarhse_incident`.`incident` 
DROP INDEX `FK_Incident_ReporterId_idx` ;

use `stellarhse_incident`;
alter table `incident`
add CONSTRAINT `FK_Incident_ReporterId` FOREIGN KEY (`reporter_id`) REFERENCES `stellarhse_auth`.`employee` (`employee_id`) ON UPDATE CASCADE;

/* */

/* added by Alaa July 27th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident_impact` 
DROP COLUMN `custom_open_txt`,
CHANGE COLUMN `description` `impact_description` TEXT NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_incident`.`illness` 
RENAME TO  `stellarhse_incident`.`incident_illness` ;

ALTER TABLE `stellarhse_incident`.`incident_illness` 
CHANGE COLUMN `illness_id` `incident_illness_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ;

ALTER TABLE `stellarhse_incident`.`incident_illness` 
DROP COLUMN `custom_open_txt`,
DROP COLUMN `illness_description`,
CHANGE COLUMN `impact_sub_type_id` `impact_sub_type_id` VARCHAR(100) NULL DEFAULT NULL AFTER `incident_id`,
CHANGE COLUMN `prim_respond_id` `prim_respond_id` VARCHAR(100) NULL DEFAULT NULL AFTER `int_employee_dept3`,
CHANGE COLUMN `personal_afflicted_id` `personal_afflicted_id` VARCHAR(100) NULL DEFAULT NULL AFTER `estimated_cost`,
CHANGE COLUMN `personal_afflicted_name` `personal_afflicted_name` VARCHAR(255) NULL DEFAULT NULL AFTER `personal_afflicted_id`,
CHANGE COLUMN `initial_treatment_id` `initial_treatment_id` VARCHAR(100) NULL DEFAULT NULL AFTER `personal_afflicted_name`,
CHANGE COLUMN `restricted_work_id` `restricted_work_id` VARCHAR(100) NULL DEFAULT NULL AFTER `initial_treatment_id`,
CHANGE COLUMN `lost_time_start` `lost_time_start` DATETIME NULL DEFAULT NULL AFTER `restricted_work_id`,
CHANGE COLUMN `lost_time_end` `lost_time_end` DATETIME NULL DEFAULT NULL AFTER `lost_time_start`,
CHANGE COLUMN `total_days_off` `total_days_off` INT(11) NULL DEFAULT NULL AFTER `lost_time_end`,
CHANGE COLUMN `adjustment_days` `adjustment_days` INT(11) NULL DEFAULT NULL AFTER `total_days_off`,
CHANGE COLUMN `description` `impact_description` TEXT NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_incident`.`incident_illness` 
DROP FOREIGN KEY `FK_illness_Intemployee_id1`,
DROP FOREIGN KEY `FK_illness_Intemployee_id2`,
DROP FOREIGN KEY `FK_illness_Intemployee_id3`;
ALTER TABLE `stellarhse_incident`.`incident_illness` 
CHANGE COLUMN `int_employee_id1` `initial_employee_id1` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name1` `initial_employee_name1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept1` `initial_employee_dept1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id2` `initial_employee_id2` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name2` `initial_employee_name2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept2` `initial_employee_dept2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id3` `initial_employee_id3` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name3` `initial_employee_name3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept3` `initial_employee_dept3` VARCHAR(255) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_illness` 
ADD CONSTRAINT `FK_illness_Intemployee_id1`
  FOREIGN KEY (`initial_employee_id1`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_illness_Intemployee_id2`
  FOREIGN KEY (`initial_employee_id2`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON DELETE SET NULL
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_illness_Intemployee_id3`
  FOREIGN KEY (`initial_employee_id3`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_illness` 
DROP FOREIGN KEY `FK_illness_PrimRespondId`;
ALTER TABLE `stellarhse_incident`.`incident_illness` 
CHANGE COLUMN `prim_respond_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_name` `primary_responder_name` VARCHAR(255) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_illness` 
ADD CONSTRAINT `FK_illness_PrimRespondId`
  FOREIGN KEY (`primary_responder_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_illness` 
CHANGE COLUMN `adjustment_days` `adjustment_days` INT(11) NULL DEFAULT NULL AFTER `lost_time_end`;

ALTER TABLE `stellarhse_incident`.`illness_symptoms` 
RENAME TO  `stellarhse_incident`.`incident_illness_symptoms` ;

ALTER TABLE `stellarhse_incident`.`incident_illness_symptoms` 
DROP FOREIGN KEY `FK_illnessSymptoms_illnessId`;
ALTER TABLE `stellarhse_incident`.`incident_illness_symptoms` 
CHANGE COLUMN `illness_id` `incident_illness_id` VARCHAR(100) NOT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_illness_symptoms` 
ADD CONSTRAINT `FK_illnessSymptoms_illnessId`
  FOREIGN KEY (`incident_illness_id`)
  REFERENCES `stellarhse_incident`.`incident_illness` (`incident_illness_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`spill_release` 
RENAME TO  `stellarhse_incident`.`incident_spill_release` ;

ALTER TABLE `stellarhse_incident`.`incident_spill_release` 
DROP FOREIGN KEY `FK_SpillRelease_Intemployee_id1`,
DROP FOREIGN KEY `FK_SpillRelease_Intemployee_id2`,
DROP FOREIGN KEY `FK_SpillRelease_Intemployee_id3`,
DROP FOREIGN KEY `FK_SpillRelease_PrimRespondId`,
DROP FOREIGN KEY `FK_SpillRelease_RecoveredUnitId`,
DROP FOREIGN KEY `FK_SpillRelease_SourceId`,
DROP FOREIGN KEY `FK_SpillRelease_SpRelAgencyId`;

ALTER TABLE `stellarhse_incident`.`incident_spill_release` 
CHANGE COLUMN `spill_release_id` `incident_spill_release_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ;

ALTER TABLE `stellarhse_incident`.`incident_spill_release` 
DROP COLUMN `custom_open_txt`,
CHANGE COLUMN `prim_respond_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL AFTER `initial_employee_dept3`,
CHANGE COLUMN `source_id` `spill_release_source_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `recovered_unit_id` `quantity_recovered_unit_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `sp_rel_agency_id` `spill_release_agency_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id1` `initial_employee_id1` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name1` `initial_employee_name1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept1` `initial_employee_dept1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id2` `initial_employee_id2` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name2` `initial_employee_name2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept2` `initial_employee_dept2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id3` `initial_employee_id3` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name3` `initial_employee_name3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept3` `initial_employee_dept3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_name` `primary_responder_name` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `description` `impact_description` TEXT NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_spill_release` 
ADD CONSTRAINT `FK_SpillRelease_Intemployee_id1`
  FOREIGN KEY (`initial_employee_id1`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_SpillRelease_Intemployee_id2`
  FOREIGN KEY (`initial_employee_id2`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_SpillRelease_Intemployee_id3`
  FOREIGN KEY (`initial_employee_id3`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_SpillRelease_PrimRespondId`
  FOREIGN KEY (`primary_responder_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_SpillRelease_RecoveredUnitId`
  FOREIGN KEY (`quantity_recovered_unit_id`)
  REFERENCES `stellarhse_incident`.`quantity_unit` (`quantity_unit_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_SpillRelease_SourceId`
  FOREIGN KEY (`spill_release_source_id`)
  REFERENCES `stellarhse_incident`.`spill_release_source` (`spill_release_source_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_SpillRelease_SpRelAgencyId`
  FOREIGN KEY (`spill_release_agency_id`)
  REFERENCES `stellarhse_incident`.`spill_release_agency` (`spill_release_agency_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_vehicle_damage` 
CHANGE COLUMN `vehicle_damage_id` `incident_vehicle_damage_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ;

ALTER TABLE `stellarhse_incident`.`incident_vehicle_damage` 
DROP FOREIGN KEY `FK_VehicleDamage_Intemployee_id1`,
DROP FOREIGN KEY `FK_VehicleDamage_Intemployee_id2`,
DROP FOREIGN KEY `FK_VehicleDamage_Intemployee_id3`,
DROP FOREIGN KEY `FK_VehicleDamage_PrimRespondId`;
ALTER TABLE `stellarhse_incident`.`incident_vehicle_damage` 
DROP COLUMN `custom_open_txt`,
CHANGE COLUMN `damage_driver_id` `driver_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `how_did_that_done` `how_did_that_occur` TEXT NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id1` `initial_employee_id1` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name1` `initial_employee_name1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept1` `initial_employee_dept1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id2` `initial_employee_id2` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name2` `initial_employee_name2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept2` `initial_employee_dept2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id3` `initial_employee_id3` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name3` `initial_employee_name3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept3` `initial_employee_dept3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_name` `primary_responder_name` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `description` `impact_description` TEXT NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_vehicle_damage` 
ADD CONSTRAINT `FK_VehicleDamage_Intemployee_id1`
  FOREIGN KEY (`initial_employee_id1`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_VehicleDamage_Intemployee_id2`
  FOREIGN KEY (`initial_employee_id2`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_VehicleDamage_Intemployee_id3`
  FOREIGN KEY (`initial_employee_id3`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_VehicleDamage_PrimRespondId`
  FOREIGN KEY (`primary_responder_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_vehicle_damage` 
CHANGE COLUMN `primary_responder_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL AFTER `initial_employee_dept3`;

/* */

/* added by Alaa July 30th, 2017 */

ALTER TABLE `stellarhse_incident`.`traffic_violation` 
RENAME TO  `stellarhse_incident`.`incident_traffic_violation` ;

ALTER TABLE `stellarhse_incident`.`incident_traffic_violation` 
CHANGE COLUMN `traffic_violation_id` `incident_traffic_violation_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ;

ALTER TABLE `stellarhse_incident`.`incident_traffic_violation` 
DROP FOREIGN KEY `FK_TrafficViolation_Intemployee_id1`,
DROP FOREIGN KEY `FK_TrafficViolation_Intemployee_id2`,
DROP FOREIGN KEY `FK_TrafficViolation_Intemployee_id3`,
DROP FOREIGN KEY `FK_TrafficViolation_PrimRespondId`;
ALTER TABLE `stellarhse_incident`.`incident_traffic_violation` 
DROP COLUMN `custom_open_txt`,
CHANGE COLUMN `int_employee_id1` `initial_employee_id1` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name1` `initial_employee_name1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept1` `initial_employee_dept1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id2` `initial_employee_id2` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name2` `initial_employee_name2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept2` `initial_employee_dept2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id3` `initial_employee_id3` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name3` `initial_employee_name3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept3` `initial_employee_dept3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_name` `primary_responder_name` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `description` `impact_description` TEXT NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_traffic_violation` 
ADD CONSTRAINT `FK_TrafficViolation_Intemployee_id1`
  FOREIGN KEY (`initial_employee_id1`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_TrafficViolation_Intemployee_id2`
  FOREIGN KEY (`initial_employee_id2`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_TrafficViolation_Intemployee_id3`
  FOREIGN KEY (`initial_employee_id3`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_TrafficViolation_PrimRespondId`
  FOREIGN KEY (`primary_responder_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_injury` 
CHANGE COLUMN `incident_id` `incident_id` VARCHAR(100) NOT NULL AFTER `incident_injury_id`,
CHANGE COLUMN `injury_id` `incident_injury_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ;

ALTER TABLE `stellarhse_incident`.`incident_injury` 
DROP FOREIGN KEY `FK_Injury_Intemployee_id1`,
DROP FOREIGN KEY `FK_Injury_Intemployee_id2`,
DROP FOREIGN KEY `FK_Injury_Intemployee_id3`,
DROP FOREIGN KEY `FK_Injury_PrimRespondId`;
ALTER TABLE `stellarhse_incident`.`incident_injury` 
DROP COLUMN `custom_open_txt`,
CHANGE COLUMN `prim_respond_id` `primary_responder_id` VARCHAR(100) NULL DEFAULT NULL AFTER `initial_employee_dept3`,
CHANGE COLUMN `int_employee_id1` `initial_employee_id1` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name1` `initial_employee_name1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept1` `initial_employee_dept1` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id2` `initial_employee_id2` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name2` `initial_employee_name2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept2` `initial_employee_dept2` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_id3` `initial_employee_id3` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_name3` `initial_employee_name3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `int_employee_dept3` `initial_employee_dept3` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `prim_respond_name` `primary_responder_name` VARCHAR(255) NULL DEFAULT NULL ,
CHANGE COLUMN `description` `impact_description` TEXT NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_incident`.`incident_injury` 
ADD CONSTRAINT `FK_Injury_Intemployee_id1`
  FOREIGN KEY (`initial_employee_id1`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_Injury_Intemployee_id2`
  FOREIGN KEY (`initial_employee_id2`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_Injury_Intemployee_id3`
  FOREIGN KEY (`initial_employee_id3`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_Injury_PrimRespondId`
  FOREIGN KEY (`primary_responder_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_incident`.`incident_injury` 
CHANGE COLUMN `contact_agency_id` `contact_agency_id` VARCHAR(100) NULL DEFAULT NULL AFTER `contact_code_id`,
CHANGE COLUMN `injury_description` `injury_description` TEXT NULL DEFAULT NULL AFTER `recordable_id`;

ALTER TABLE `stellarhse_incident`.`injury_type_injury` 
RENAME TO  `stellarhse_incident`.`impact_injury_type` ;

ALTER TABLE `stellarhse_incident`.`incident_body_area_injury` 
RENAME TO  `stellarhse_incident`.`impact_injury_body_area` ;

ALTER TABLE `stellarhse_incident`.`incident_body_part_injury` 
RENAME TO  `stellarhse_incident`.`impact_injury_body_part` ;

ALTER TABLE `stellarhse_incident`.`incident_injury` 
CHANGE COLUMN `personal_injured_id` `personal_injured_id` VARCHAR(100) NULL DEFAULT NULL AFTER `incident_id`;

/* */

/* added by Hend July 30th, 2017 */

ALTER TABLE `stellarhse_incident`.`scat_analysis` 
DROP FOREIGN KEY `FK_scat_analysis_incident_id`;
ALTER TABLE `stellarhse_incident`.`scat_analysis` 
DROP INDEX `FK_scat_analysis_incident_id_idx` ;

ALTER TABLE `stellarhse_incident`.`scat_analysis` 
ADD CONSTRAINT `FK_scat_analysis_incident_id`
  FOREIGN KEY (`incident_id`)
  REFERENCES `stellarhse_incident`.`incident` (`incident_id`)
  ON DELETE restricted
  ON UPDATE cascade;

USE `stellarhse_incident`;
DROP procedure IF EXISTS `sp_get_equipment_involved`;

DELIMITER $$
USE `stellarhse_incident`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_equipment_involved`($org_id varchar(50),$search varchar(1000),$lmt int,$strt int)
begin
set @sql = concat('select SQL_CALC_FOUND_ROWS * from equipment_involved_view ');
if  $org_id <>'' then 
set @sql = concat(@sql,'  where org_id =',"'",$org_id,"'");
end if;
if $search <> '' and $org_id <>''  then 
set @sql = concat(@sql,' and ',$search);
end if;
if ($search <> '' and ($org_id =''))  then 
set @sql = concat(@sql,' where ',$search);
end if;
set @sql = concat(@sql,' limit ',$strt,',',$lmt);
prepare stmt from @sql;
execute stmt;
deallocate prepare stmt;
select FOUND_ROWS();
end$$

DELIMITER ;

/* */

/* added by Alaa Aug. 1st, 2017 */

ALTER TABLE `stellarhse_training`.`training` 
DROP FOREIGN KEY `FK_Training_Staff_member_id`,
CHANGE COLUMN `Staff_member_id` `staff_member_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `cmpleted_date` `completed_date` DATE NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_training`.`training` 
ADD CONSTRAINT `FK_Training_Staff_member_id`
  FOREIGN KEY (`staff_member_id`)
  REFERENCES `stellarhse_auth`.`organization` (`org_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_training`.`training`
ADD COLUMN `is_trainee_observed_post` BIT(1) NULL AFTER `comments`,
CHANGE COLUMN `sign_off_date` `observed_date` DATETIME NULL DEFAULT NULL AFTER `is_trainee_observed_post`,
ADD COLUMN `observed_by_id` VARCHAR(100) NULL AFTER `observed_date`,
ADD COLUMN `observations` TEXT NULL AFTER `observed_by_id`,
CHANGE COLUMN `training_number` `training_number` INT(11) NULL DEFAULT NULL AFTER `observations`;

/* */

/* added by Alaa Aug. 2nd, 2017 */

ALTER TABLE `stellarhse_training`.`training` 
DROP COLUMN `training_minute`,
DROP COLUMN `training_hour`,
CHANGE COLUMN `training_date` `assigned_to_notify_supervisor` VARCHAR(100) NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_training`.`training` 
ADD INDEX `FK_Training_assigned_to_notify_supervisor_idx` (`assigned_to_notify_supervisor` ASC);
ALTER TABLE `stellarhse_training`.`training` 
ADD CONSTRAINT `FK_Training_assigned_to_notify_supervisor`
  FOREIGN KEY (`assigned_to_notify_supervisor`)
  REFERENCES `stellarhse_common`.`yes_no` (`id`)
  ON DELETE RESTRICT
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_training`.`training` 
CHANGE COLUMN `training_reason` `training_reason_id` VARCHAR(200) NULL DEFAULT NULL ,
CHANGE COLUMN `level_achieved` `level_achieved_id` VARCHAR(100) NOT NULL ;

ALTER TABLE `stellarhse_training`.`training` 
add CONSTRAINT `FK_Training_training_reason_id` FOREIGN KEY (`training_reason_id`) REFERENCES `training_reason` (`training_reason_id`) ON UPDATE CASCADE,
add index `FK_Training_training_reason_id_idx` (`training_reason_id`);

ALTER TABLE `stellarhse_training`.`training` 
add CONSTRAINT `FK_Training_level_achieved_id` FOREIGN KEY (`level_achieved_id`) REFERENCES `level_acheived` (`level_acheived_id`) ON UPDATE CASCADE,
add index `FK_Training_level_achieved_id_idx` (`level_achieved_id`);

ALTER TABLE `stellarhse_training`.`training` 
add CONSTRAINT `FK_Training_quality_of_training_id` FOREIGN KEY (`quality_of_training_id`) REFERENCES `level_quality` (`level_quality_id`) ON UPDATE CASCADE,
add index `FK_Training_quality_of_training_id_idx` (`quality_of_training_id`); 

ALTER TABLE `stellarhse_training`.`training_reason` 
CHANGE COLUMN `reason_name` `training_reason_name` VARCHAR(255) NOT NULL ;

ALTER TABLE `stellarhse_training`.`level_acheived` 
RENAME TO  `stellarhse_training`.`level_achieved` ;

ALTER TABLE `stellarhse_training`.`level_achieved` 
CHANGE COLUMN `level_acheived_id` `level_achieved_id` VARCHAR(100) NOT NULL DEFAULT 'MyUUID Function' ,
CHANGE COLUMN `level_acheived_name` `level_achieved_name` VARCHAR(255) NOT NULL ;

/* */

/* added by Alaa Aug. 3rd, 2017 */

ALTER TABLE `stellarhse_training`.`training` 
DROP FOREIGN KEY `FK_Training_assigned_to_notify_supervisor`;
ALTER TABLE `stellarhse_training`.`training` 
CHANGE COLUMN `assigned_to_notify_supervisor` `assigned_to_notify_supervisor` BIT(1) NULL DEFAULT NULL ;

insert into stellarhse_training.level_achieved values 
(`stellarhse_auth`.MyUUID(), 'participation', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'participation', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', NULL, '2017-05-23 02:32:57', NULL, '0'),
(`stellarhse_auth`.MyUUID(), 'certification', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'certification', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', NULL, '2017-05-23 02:32:57', NULL, '0'),
(`stellarhse_auth`.MyUUID(), 'passing grade', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'passing grade', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', NULL, '2017-05-23 02:32:57', NULL, '0'),
(`stellarhse_auth`.MyUUID(), 'incomplete ', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'incomplete ', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', NULL, '2017-05-23 02:32:57', NULL, '0');

ALTER TABLE `stellarhse_training`.`training` 
DROP FOREIGN KEY `FK_Training_Staff_member_id`;
ALTER TABLE `stellarhse_training`.`training` 
ADD INDEX `FK_Training_Staff_member_id_idx` (`staff_member_id` ASC),
DROP INDEX `FK_Training_Staff_member_id_idx` ;
ALTER TABLE `stellarhse_training`.`training` 
ADD CONSTRAINT `FK_Training_Staff_member_id`
  FOREIGN KEY (`staff_member_id`)
  REFERENCES `stellarhse_auth`.`employee` (`employee_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_training`.`training_followup_action` 
DROP FOREIGN KEY `FK_training_followup_action_CorrActStatusId`,
DROP FOREIGN KEY `FK_training_followup_action_PriorityId`;
ALTER TABLE `stellarhse_training`.`training_followup_action` 
CHANGE COLUMN `training_corr_act_status_id` `training_followup_action_status_id` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `training_corr_act_priority_id` `training_followup_action_priority_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_training`.`training_followup_action` 
ADD CONSTRAINT `FK_training_followup_action_CorrActStatusId`
  FOREIGN KEY (`training_followup_action_status_id`)
  REFERENCES `stellarhse_common`.`corrective_action_status` (`corrective_action_status_id`)
  ON UPDATE CASCADE,
ADD CONSTRAINT `FK_training_followup_action_PriorityId`
  FOREIGN KEY (`training_followup_action_priority_id`)
  REFERENCES `stellarhse_common`.`corrective_action_priority` (`corrective_action_priority_id`)
  ON UPDATE CASCADE;

/* */

/* added by Hend Aug. 3rd, 2017 */

ALTER TABLE `stellarhse_maintenance`.`maintenance_followup_action` 
DROP FOREIGN KEY `FK_MaintenanceCorrectiveAction_CorrActStatusId`;
ALTER TABLE `stellarhse_maintenance`.`maintenance_followup_action` 
CHANGE COLUMN `maintenance_corr_act_status_id` `corrective_action_status_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_maintenance`.`maintenance_followup_action` 
ADD CONSTRAINT `FK_MaintenanceCorrectiveAction_CorrActStatusId`
  FOREIGN KEY (`corrective_action_status_id`)
  REFERENCES `stellarhse_common`.`corrective_action_status` (`corrective_action_status_id`)
  ON UPDATE CASCADE;

ALTER TABLE `stellarhse_maintenance`.`maintenance_followup_action` 
DROP FOREIGN KEY `FK_MaintenanceCorrectiveAction_maintenance_corr_act_priority_id`;
ALTER TABLE `stellarhse_maintenance`.`maintenance_followup_action` 
CHANGE COLUMN `maintenance_corr_act_priority_id` `corrective_action_priority_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_maintenance`.`maintenance_followup_action` 
ADD CONSTRAINT `FK_MaintenanceCorrectiveAction_maintenance_corr_act_priority_id`
  FOREIGN KEY (`corrective_action_priority_id`)
  REFERENCES `stellarhse_common`.`corrective_action_priority` (`corrective_action_priority_id`)
  ON UPDATE CASCADE;

/* */

/* added by Alaa Aug. 6th, 2017 */

ALTER TABLE `stellarhse_training`.`training` 
DROP COLUMN `email`,
DROP COLUMN `site`,
CHANGE COLUMN `website` `website` VARCHAR(100) NULL DEFAULT NULL AFTER `phone`,
CHANGE COLUMN `street` `state` VARCHAR(100) NULL DEFAULT NULL ,
CHANGE COLUMN `contact_name` `contact_name` VARCHAR(100) NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_training`.`training` 
DROP FOREIGN KEY `FK_Training_city`;
ALTER TABLE `stellarhse_training`.`training` 
DROP INDEX `FK_Training_CityId_idx` ;

ALTER TABLE `stellarhse_training`.`training` 
CHANGE COLUMN `evidence_of_completion` `evidence_of_completion` TEXT NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_training`.`training` 
DROP FOREIGN KEY `FK_Training_level_achieved_id`;
ALTER TABLE `stellarhse_training`.`training` 
CHANGE COLUMN `training_duration` `training_duration` INT(11) NULL DEFAULT NULL ,
CHANGE COLUMN `level_achieved_id` `level_achieved_id` VARCHAR(100) NULL DEFAULT NULL ;
ALTER TABLE `stellarhse_training`.`training` 
ADD CONSTRAINT `FK_Training_level_achieved_id`
  FOREIGN KEY (`level_achieved_id`)
  REFERENCES `stellarhse_training`.`level_achieved` (`level_achieved_id`)
  ON UPDATE CASCADE;

/* */

/* added by Hend Aug. 6th, 2017 */

USE `stellarhse_maintenance`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `maintenance_view` AS
    SELECT 
        `m`.`maintenance_id` AS `maintenance_id`,
        `met`.`maintenance_type_name` AS `maintenance_type_name`,
        `mr`.`maintenance_reason_name` AS `maintenance_reason_name`,
        `m`.`org_id` AS `org_id`,
		`m`.`creator_id` AS `creator_id`,
        `o`.`org_name` AS `organization_name`,
        `m`.`maintenance_number` AS `maintenance_number`,
        DATE_FORMAT(`m`.`maintenance_date`, '%m/%d/%Y') AS `maintenance_date`,
        `m`.`maintenance_hour` AS `maintenance_hour`,
        `m`.`maintenance_minute` AS `maintenance_minute`,
        CONCAT(`e1`.`first_name`, ' ', `e1`.`last_name`) AS `reporter_id`,
        `m`.`rep_name` AS `rep_name`,
        `m`.`rep_emp_id` AS `rep_emp_id`,
        `m`.`rep_position` AS `rep_position`,
        `m`.`rep_crew` AS `rep_crew`,
        `m`.`rep_email` AS `rep_email`,
        `m`.`rep_company` AS `rep_company`,
        `m`.`rep_primary_phone` AS `rep_primary_phone`,
        `m`.`rep_alternate_phone` AS `rep_alternate_phone`,
        `m`.`rep_supervisor` AS `rep_supervisor`,
        `l1`.`location1_name` AS `location1_name`,
        `l2`.`location2_name` AS `location2_name`,
        `l3`.`location3_name` AS `location3_name`,
        `l4`.`location4_name` AS `location4_name`,
        `m`.`other_location` AS `other_location`,
        `m`.`crew_involved` AS `crew_involved`,
        `op`.`operation_type_name` AS `operation_type_name`,
        `m`.`Facility_location_last_maintenance` AS `Facility_location_last_maintenance`,
        DATE_FORMAT(`m`.`last_maintenance_date`, '%m/%d/%Y') AS `last_maintenance_date`,
        `m`.`maintenance_description` AS `maintenance_description`,
        `m`.`unusual_findings_resulting_from_maintenance` AS `unusual_findings_resulting_from_maintenance`,
        IF((`m`.`are_additional_followup_actions_required` = 0),
            'No',
            'Yes') AS `are_additional_followup_actions_required`,
        `m`.`summary_of_recommended_followup_actions` AS `summary_of_recommended_followup_actions`,
        `mav`.`attachment_name` AS `attachment_name`,
        `mev`.`equipemnt_name` AS `equipment_name`,
        `mtpv`.`third_party_name` AS `third_party_name`,
        `mfav`.`followup_action_status_name` AS `followup_action_status_name`,
        `mfav`.`followup_action_priority_name` AS `followup_action_priority_name`,
        `mfav`.`notified_names` AS `notified_names`,
        `mfav`.`assigned_to_name` AS `assigned_to_name`,
        `mfav`.`supervisor` AS `supervisor`,
        `mfav`.`supervisor_notify` AS `supervisor_notify`,
        `mfav`.`start_date` AS `start_date`,
        `mfav`.`target_end_date` AS `target_end_date`,
        `mfav`.`actual_end_date` AS `actual_end_date`,
        `mfav`.`estimated_cost` AS `estimated_cost`,
        `mfav`.`actual_cost` AS `actual_cost`,
        `mfav`.`task_description` AS `task_description`,
        `mfav`.`out_come_follow_up` AS `out_come_follow_up`,
        `mfav`.`desired_results` AS `desired_results`,
        `mfav`.`comments` AS `followup_action_comments`,
        `mpiv`.`people_name` AS `people_name`,
        `mpiv`.`people_involved_name` AS `people_involved_name`,
        `mpiv`.`company` AS `company`,
        `mpiv`.`position` AS `position`,
        `mpiv`.`email` AS `email`,
        `mpiv`.`primary_phone` AS `primary_phone`,
        `mpiv`.`alternate_phone` AS `alternate_phone`,
        `mpiv`.`exp_in_current_postion` AS `exp_in_current_postion`,
        `mpiv`.`exp_over_all` AS `exp_over_all`,
        `mpiv`.`age` AS `age`,
        `mpiv`.`how_he_involved` AS `how_he_involved`,
        `mpiv`.`role_description` AS `role_description`,
        `mpiv`.`supervisor` AS `people_involved_supervisor`,
        `mpiv`.`crew` AS `crew`,
        `mpiv`.`crtificate_name` AS `crtificate_name`,
        `mpiv`.`acting_name` AS `acting_name`,
        CONCAT(`e2`.`first_name`, ' ', `e2`.`last_name`) AS `creator_by`,
        CONCAT(`e3`.`first_name`, ' ', `e3`.`last_name`) AS `editing_by`,
        CONCAT(`e4`.`first_name`, ' ', `e4`.`last_name`) AS `modifier_by`,
        IF((`m`.`is_deleted` = 0), 'No', 'Yes') AS `is_deleted`,
        IF((`m`.`hide` = 0), 'No', 'Yes') AS `hide`
    FROM
        (((((((((((((((((`stellarhse_maintenance`.`maintenance` `m`
        LEFT JOIN `stellarhse_maintenance`.`maintenance_event_type` `met` ON ((`m`.`maintenance_type_id` = `met`.`maintenance_type_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_reason` `mr` ON ((`mr`.`maintenance_reason_id` = `m`.`maintenance_reason_id`)))
        LEFT JOIN `stellarhse_auth`.`organization` `o` ON ((`o`.`org_id` = `m`.`org_id`)))
        LEFT JOIN `stellarhse_common`.`location1` `l1` ON ((`l1`.`location1_id` = `m`.`location1_id`)))
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON ((`l2`.`location2_id` = `m`.`location2_id`)))
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON ((`l3`.`location3_id` = `m`.`location3_id`)))
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON ((`l4`.`location4_id` = `m`.`location4_id`)))
        LEFT JOIN `stellarhse_common`.`operation_type` `op` ON ((`op`.`operation_type_id` = `m`.`operation_type_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_attachment_view` `mav` ON ((`mav`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_equipment_view` `mev` ON ((`mev`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_followup_action_view` `mfav` ON ((`mfav`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_people_involved_view` `mpiv` ON ((`mpiv`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_third_party_view` `mtpv` ON ((`mtpv`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON ((`e1`.`employee_id` = `m`.`reporter_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON ((`e2`.`employee_id` = `m`.`creator_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e3` ON ((`e3`.`employee_id` = `m`.`editing_by`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e4` ON ((`e4`.`employee_id` = `m`.`modifier_id`)))
    WHERE
        (`m`.`is_deleted` = 0)
    GROUP BY `m`.`maintenance_id`
    ORDER BY `m`.`maintenance_number`;

/* */

/* added by Hend Aug. 6th, 2017 */

USE `stellarhse_maintenance`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `followup_action_view` AS
    SELECT 
        `mfav`.`maintenance_id` AS `maintenance_id`,
        `met`.`maintenance_type_name` AS `maintenance_type_name`,
        `mr`.`maintenance_reason_name` AS `maintenance_reason_name`,
        `m`.`org_id` AS `org_id`,
         `m`.`creator_id` AS `creator_id`,
        `o`.`org_name` AS `organization_name`,
        `m`.`maintenance_number` AS `maintenance_number`,
        DATE_FORMAT(`m`.`maintenance_date`, '%m/%d/%Y') AS `maintenance_date`,
        CONCAT(`e1`.`first_name`, ' ', `e1`.`last_name`) AS `reporter_name`,
        `m`.`rep_name` AS `rep_name`,
        `m`.`rep_email` AS `rep_email`,
        `m`.`rep_primary_phone` AS `rep_primary_phone`,
        `l1`.`location1_name` AS `country`,
        `l2`.`location2_name` AS `province`,
        `l3`.`location3_name` AS `city`,
        `l4`.`location4_name` AS `community`,
        `m`.`other_location` AS `other_location`,
        `m`.`Facility_location_last_maintenance` AS `Facility_location_last_maintenance`,
        `op`.`operation_type_name` AS `operation_type_name`,
        DATE_FORMAT(`m`.`last_maintenance_date`, '%m/%d/%Y') AS `last_maintenance_date`,
        `m`.`maintenance_description` AS `maintenance_description`,
        `m`.`unusual_findings_resulting_from_maintenance` AS `unusual_findings_resulting_from_maintenance`,
        IF((`m`.`are_additional_followup_actions_required` = 0),
            'No',
            'Yes') AS `are_additional_followup_actions_required`,
        `m`.`summary_of_recommended_followup_actions` AS `summary_of_recommended_followup_actions`,
        `mev`.`equipemnt_name` AS `equipment_name`,
        `mfav`.`followup_action_status_name` AS `followup_action_status_name`,
        `mfav`.`followup_action_priority_name` AS `followup_action_priority_name`,
        `mfav`.`notified_names` AS `notified_names`,
        `mfav`.`assigned_to_name` AS `assigned_to_name`,
        `mfav`.`supervisor` AS `supervisor`,
        `mfav`.`supervisor_notify` AS `supervisor_notify`,
        `mfav`.`start_date` AS `start_date`,
        `mfav`.`target_end_date` AS `target_end_date`,
        `mfav`.`actual_end_date` AS `actual_end_date`,
        `mfav`.`estimated_cost` AS `estimated_cost`,
        `mfav`.`actual_cost` AS `actual_cost`,
        `mfav`.`task_description` AS `task_description`,
        `mfav`.`out_come_follow_up` AS `out_come_follow_up`,
        `mfav`.`desired_results` AS `desired_results`,
        `mfav`.`comments` AS `followup_action_comments`,
        CONCAT(`e2`.`first_name`, ' ', `e2`.`last_name`) AS `creator_by`,
        NULL AS `sent_date`,
        CONCAT(`e4`.`first_name`, ' ', `e4`.`last_name`) AS `modifier_by`,
        IF((`m`.`is_deleted` = 0), 'No', 'Yes') AS `is_deleted`,
        IF((`m`.`hide` = 0), 'No', 'Yes') AS `hide`
    FROM
        ((((((((((((((`stellarhse_maintenance`.`maintenance_followup_action_view` `mfav`
        JOIN `stellarhse_maintenance`.`maintenance` `m` ON ((`m`.`maintenance_id` = `mfav`.`maintenance_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_event_type` `met` ON ((`m`.`maintenance_type_id` = `met`.`maintenance_type_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_reason` `mr` ON ((`mr`.`maintenance_reason_id` = `m`.`maintenance_reason_id`)))
        LEFT JOIN `stellarhse_auth`.`organization` `o` ON ((`o`.`org_id` = `m`.`org_id`)))
        LEFT JOIN `stellarhse_common`.`location1` `l1` ON ((`l1`.`location1_id` = `m`.`location1_id`)))
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON ((`l2`.`location2_id` = `m`.`location2_id`)))
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON ((`l3`.`location3_id` = `m`.`location3_id`)))
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON ((`l4`.`location4_id` = `m`.`location4_id`)))
        LEFT JOIN `stellarhse_common`.`operation_type` `op` ON ((`op`.`operation_type_id` = `m`.`operation_type_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_attachment_view` `mav` ON ((`mav`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_maintenance`.`maintenance_equipment_view` `mev` ON ((`mev`.`maintenance_id` = `m`.`maintenance_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON ((`e1`.`employee_id` = `m`.`reporter_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON ((`e2`.`employee_id` = `m`.`creator_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e4` ON ((`e4`.`employee_id` = `m`.`modifier_id`)))
    WHERE
        (`m`.`is_deleted` = 0)
    ORDER BY `m`.`maintenance_number`;

/* */

/* added by Alaa Aug. 6th, 2017 */

USE `stellarhse_training`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED
    SQL SECURITY DEFINER
VIEW `training_view` AS
    SELECT 
        `t`.`training_id` AS `training_id`,
        `tev`.`training_type_name` AS `training_type`,
        `t`.`training_number` AS `training_number`,
        `t`.`org_id` AS `org_id`,
        `o`.`org_name` AS `organization_name`,
        `tr`.`training_reason_name` AS `training_reason`,
        DATE_FORMAT(`t`.`traininy_completed_by`, '%m/%d/%Y') AS `traininy_completed_by`,
        CONCAT(`e2`.`first_name`, ' ', `e2`.`last_name`) AS `assigned_by`,
        `t`.`assigned_to_name` AS `assigned_to_name`,
        `t`.`assigned_to_emp_id` AS `assigned_to_emp_id`,
        `t`.`assigned_to_position` AS `assigned_to_position`,
        `t`.`assigned_to_crew` AS `assigned_to_crew`,
        `t`.`assigned_to_email` AS `assigned_to_email`,
        `t`.`assigned_to_company` AS `assigned_to_company`,
        `t`.`assigned_to_primary_phone` AS `assigned_to_primary_phone`,
        `t`.`assigned_to_alternate_phone` AS `assigned_to_alternate_phone`,
        `t`.`assigned_to_supervisor` AS `assigned_to_supervisor`,
        `t`.`training_assigned_by` AS `training_aprovided_by`,
        CONCAT(`e3`.`first_name`, ' ', `e3`.`last_name`) AS `staff_member`,
        `tp`.`third_party_name` AS `third_party_name`,
        `t`.`location_of_training` AS `location_of_training`,
        `t`.`website` AS `website`,
        `t`.`state` AS `state`,
        `t`.`city` AS `city`,
        `t`.`contact_name` AS `provider_contact_name`,
        `t`.`phone` AS `provider_phone`,
        `t`.`evidence_of_completion` AS `evidence_of_completion`,
        `t`.`training_duration` AS `training_duration`,
        DATE_FORMAT(`t`.`completed_date`, '%m/%d/%Y') AS `completed_date`,
        `tl`.`level_achieved_name` AS `level_achieved`,
        `t`.`course_mark` AS `course_mark`,
        DATE_FORMAT(`t`.`expiry_date`, '%m/%d/%Y') AS `expiry_date`,
        `q`.`level_quality_name` AS `training_quality`,
        `t`.`comments` AS `comments`,
        IF((`t`.`is_trainee_observed_post` = 0),
            'No',
            'Yes') AS `is_trainee_observed_post`,
        DATE_FORMAT(`t`.`observed_date`, '%m/%d/%Y') AS `observed_date`,
        CONCAT(`e4`.`first_name`, ' ', `e4`.`last_name`) AS `observed_by`,
        `t`.`observations` AS `observations`,
        `tfav`.`followup_action_status_name` AS `followup_action_status_name`,
        `tfav`.`followup_action_priority_name` AS `followup_action_priority_name`,
        `tfav`.`notified_names` AS `notified_names`,
        `tfav`.`assigned_to_name` AS `assigned_name`,
        `tfav`.`supervisor` AS `followup_action_supervisor`,
        `tfav`.`supervisor_notify` AS `supervisor_notify`,
        `tfav`.`start_date` AS `start_date`,
        `tfav`.`target_end_date` AS `target_end_date`,
        `tfav`.`actual_end_date` AS `actual_end_date`,
        `tfav`.`estimated_cost` AS `estimated_cost`,
        `tfav`.`actual_cost` AS `actual_cost`,
        `tfav`.`task_description` AS `task_description`,
        `tfav`.`out_come_follow_up` AS `out_come_follow_up`,
        `tfav`.`desired_results` AS `desired_results`,
        `tfav`.`comments` AS `followup_action_comment`,
        `tpiv`.`people_name` AS `people_name`,
        `tpiv`.`people_involved_name` AS `people_involved_name`,
        `tpiv`.`company` AS `company`,
        `tpiv`.`position` AS `position`,
        `tpiv`.`email` AS `email`,
        `tpiv`.`primary_phone` AS `primary_phone`,
        `tpiv`.`alternate_phone` AS `alternate_phone`,
        `tpiv`.`exp_in_current_postion` AS `exp_in_current_postion`,
        `tpiv`.`exp_over_all` AS `exp_over_all`,
        `tpiv`.`age` AS `age`,
        `tpiv`.`how_he_involved` AS `how_he_involved`,
        `tpiv`.`role_description` AS `role_description`,
        `tpiv`.`last_update_date` AS `last_update_date`,
        `tpiv`.`supervisor` AS `people_involved_supervisor`,
        `tpiv`.`crew` AS `crew`,
        `tpiv`.`crtificate_name` AS `crtificate_name`,
        `tpiv`.`acting_name` AS `acting_name`,
        CONCAT(`e5`.`first_name`, ' ', `e5`.`last_name`) AS `modified_by`,
        `t`.`creator_id` AS `creator_id`,
        CONCAT(`e6`.`first_name`, ' ', `e6`.`last_name`) AS `created_by`,
        CONCAT(`e7`.`first_name`, ' ', `e7`.`last_name`) AS `edititng_by`,
        IF((`t`.`is_deleted` = 0), 'No', 'Yes') AS `is_deleted`,
        IF(`t`.`hide`, 'No', 'Yes') AS `hide`
    FROM
        ((((((((((((((`stellarhse_training`.`training` `t`
        JOIN `stellarhse_training`.`training_event_type` `tev` ON ((`tev`.`training_type_id` = `t`.`training_type_id`)))
        LEFT JOIN `stellarhse_auth`.`organization` `o` ON ((`o`.`org_id` = `t`.`org_id`)))
        LEFT JOIN `stellarhse_training`.`training_reason` `tr` ON ((`tr`.`training_reason_id` = `t`.`training_reason_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON ((`e2`.`employee_id` = `t`.`assigned_to_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e3` ON ((`e3`.`employee_id` = `t`.`staff_member_id`)))
        LEFT JOIN `stellarhse_common`.`third_party` `tp` ON ((`tp`.`third_party_id` = `t`.`third_party_id`)))
        LEFT JOIN `stellarhse_training`.`level_achieved` `tl` ON ((`tl`.`level_achieved_id` = `t`.`level_achieved_id`)))
        LEFT JOIN `stellarhse_training`.`level_quality` `q` ON ((`q`.`level_quality_id` = `t`.`quality_of_training_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e4` ON ((`e4`.`employee_id` = `t`.`observed_by_id`)))
        LEFT JOIN `stellarhse_training`.`training_followup_action_view` `tfav` ON ((`tfav`.`training_id` = `t`.`training_id`)))
        LEFT JOIN `stellarhse_training`.`training_people_involved_view` `tpiv` ON ((`tpiv`.`training_id` = `t`.`training_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e5` ON ((`e5`.`employee_id` = `t`.`modifier_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e6` ON ((`e6`.`employee_id` = `t`.`creator_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e7` ON ((`e7`.`employee_id` = `t`.`editing_by`)))
    WHERE
        ((`t`.`is_deleted` = 'No')
            AND (`t`.`hide` = 'No'))
    GROUP BY `t`.`training_id`
    ORDER BY `t`.`training_number`;

/* */

/* added by Alaa Aug. 6th, 2017 */

USE `stellarhse_training`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `followup_action_view` AS
    SELECT 
        `tfav`.`training_id` AS `training_id`,
        `tev`.`training_type_name` AS `training_type`,
        `t`.`training_number` AS `training_number`,
        `t`.`org_id` AS `org_id`,
        `o`.`org_name` AS `organization_name`,
        `tr`.`training_reason_name` AS `training_reason`,
        DATE_FORMAT(`t`.`traininy_completed_by`, '%m/%d/%Y') AS `traininy_completed_by_date`,
        CONCAT(`e2`.`first_name`, ' ', `e2`.`last_name`) AS `assigned_by`,
        `t`.`assigned_to_name` AS `assigned_to_name`,
        `t`.`assigned_to_email` AS `assigned_to_email`,
        `t`.`assigned_to_primary_phone` AS `assigned_to_primary_phone`,
        `t`.`training_assigned_by` AS `training_assigned_by`,
        CONCAT(`e3`.`first_name`, ' ', `e3`.`last_name`) AS `staff_member`,
        `tp`.`third_party_name` AS `third_party_name`,
        `t`.`location_of_training` AS `location_of_training`,
        `t`.`website` AS `website`,
        `t`.`state` AS `state`,
        `t`.`city` AS `city`,
        `t`.`contact_name` AS `provider_contact_name`,
        `t`.`phone` AS `provider_phone`,
        `t`.`evidence_of_completion` AS `evidence_of_completion`,
        `t`.`training_duration` AS `training_duration`,
        DATE_FORMAT(`t`.`completed_date`, '%m/%d/%Y') AS `completed_date`,
        `tl`.`level_achieved_name` AS `level_achieved`,
        `t`.`course_mark` AS `course_mark`,
        DATE_FORMAT(`t`.`expiry_date`, '%m/%d/%Y') AS `expiry_date`,
        `q`.`level_quality_name` AS `training_quality`,
        `t`.`comments` AS `comments`,
        IF((`t`.`is_trainee_observed_post` = 0),
            'No',
            'Yes') AS `is_trainee_observed_post`,
        DATE_FORMAT(`t`.`observed_date`, '%m/%d/%Y') AS `observed_date`,
        CONCAT(`e4`.`first_name`, ' ', `e4`.`last_name`) AS `observed_by`,
        `t`.`observations` AS `observations`,
        `tfav`.`followup_action_status_name` AS `followup_action_status_name`,
        `tfav`.`followup_action_priority_name` AS `followup_action_priority_name`,
        `tfav`.`notified_names` AS `notified_names`,
        `tfav`.`assigned_to_name` AS `assigned_name`,
        `tfav`.`supervisor` AS `followup_action_supervisor`,
        `tfav`.`supervisor_notify` AS `supervisor_notify`,
        `tfav`.`start_date` AS `start_date`,
        `tfav`.`target_end_date` AS `target_end_date`,
        `tfav`.`actual_end_date` AS `actual_end_date`,
        `tfav`.`estimated_cost` AS `estimated_cost`,
        `tfav`.`actual_cost` AS `actual_cost`,
        `tfav`.`task_description` AS `task_description`,
        `tfav`.`out_come_follow_up` AS `out_come_follow_up`,
        `tfav`.`desired_results` AS `desired_results`,
        `tfav`.`comments` AS `followup_action_comment`,
        NULL AS `send_date`,
        CONCAT(`e6`.`first_name`, ' ', `e6`.`last_name`) AS `created_by`,
        `t`.`creator_id` AS `creator_id`,
        CONCAT(`e7`.`first_name`, ' ', `e7`.`last_name`) AS `edititng_by`,
        IF((`t`.`is_deleted` = 0), 'No', 'Yes') AS `is_deleted`,
        IF(`t`.`hide`, 'No', 'Yes') AS `hide`
    FROM
        ((((((((((((`stellarhse_training`.`training_followup_action_view` `tfav`
        JOIN `stellarhse_training`.`training` `t` ON ((`t`.`training_id` = `tfav`.`training_id`)))
        JOIN `stellarhse_training`.`training_event_type` `tev` ON ((`tev`.`training_type_id` = `t`.`training_type_id`)))
        LEFT JOIN `stellarhse_auth`.`organization` `o` ON ((`o`.`org_id` = `t`.`org_id`)))
        LEFT JOIN `stellarhse_training`.`training_reason` `tr` ON ((`tr`.`training_reason_id` = `t`.`training_reason_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON ((`e2`.`employee_id` = `t`.`assigned_to_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e3` ON ((`e3`.`employee_id` = `t`.`staff_member_id`)))
        LEFT JOIN `stellarhse_common`.`third_party` `tp` ON ((`tp`.`third_party_id` = `t`.`third_party_id`)))
        LEFT JOIN `stellarhse_training`.`level_achieved` `tl` ON ((`tl`.`level_achieved_id` = `t`.`level_achieved_id`)))
        LEFT JOIN `stellarhse_training`.`level_quality` `q` ON ((`q`.`level_quality_id` = `t`.`quality_of_training_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e4` ON ((`e4`.`employee_id` = `t`.`observed_by_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e6` ON ((`e6`.`employee_id` = `t`.`creator_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e7` ON ((`e7`.`employee_id` = `t`.`editing_by`)))
    WHERE
        ((`t`.`is_deleted` = 'No')
            AND (`t`.`hide` = 'No'))
    ORDER BY `t`.`training_number`;

/* */

/* added by Alaa Aug. 6th, 2017 */

USE `stellarhse_training`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    SQL SECURITY DEFINER
VIEW `training_provider_view` AS
    SELECT 
        `py`.`training_id` AS `training_id`,
        `tev`.`training_type_name` AS `training_type`,
        `t`.`training_number` AS `training_number`,
        `t`.`org_id` AS `org_id`,
        `o`.`org_name` AS `organization_name`,
        `tr`.`training_reason_name` AS `training_reason`,
        DATE_FORMAT(`t`.`traininy_completed_by`, '%m/%d/%Y') AS `traininy_completed_by`,
        CONCAT(`e2`.`first_name`, ' ', `e2`.`last_name`) AS `assigned_by`,
        `t`.`assigned_to_name` AS `assigned_to_name`,
        `t`.`assigned_to_email` AS `assigned_to_email`,
        `t`.`assigned_to_primary_phone` AS `assigned_to_primary_phone`,
        `t`.`training_assigned_by` AS `training_assigned_by`,
        `py`.`training_type` AS `provided_type`,
        `py`.`provided_by` AS `provided_by`,
        `py`.`location_of_training` AS `location_of_training`,
        `py`.`website` AS `website`,
        `py`.`state` AS `state`,
        `py`.`city` AS `city`,
        `py`.`provider_contact_name` AS `provider_contact_name`,
        `py`.`provider_phone` AS `provider_phone`,
        `py`.`evidence_of_completion` AS `evidence_of_completion`,
        `py`.`training_duration` AS `training_duration`,
        DATE_FORMAT(`t`.`completed_date`, '%m/%d/%Y') AS `completed_date`,
        `tl`.`level_achieved_name` AS `level_achieved`,
        DATE_FORMAT(`t`.`expiry_date`, '%m/%d/%Y') AS `expiry_date`,
        `q`.`level_quality_name` AS `training_quality`,
        `t`.`comments` AS `comments`,
        IF((`t`.`is_trainee_observed_post` = 0),
            'No',
            'Yes') AS `is_trainee_observed_post`,
        DATE_FORMAT(`t`.`observed_date`, '%m/%d/%Y') AS `observed_date`,
        CONCAT(`e4`.`first_name`, ' ', `e4`.`last_name`) AS `observed_by`,
        `t`.`observations` AS `observations`,
        CONCAT(`e6`.`first_name`, ' ', `e6`.`last_name`) AS `created_by`,
        CONCAT(`e7`.`first_name`, ' ', `e7`.`last_name`) AS `edititng_by`,
        IF((`t`.`is_deleted` = 0), 'No', 'Yes') AS `is_deleted`,
        IF(`t`.`hide`, 'No', 'Yes') AS `hide`
    FROM
        (((((((((((`stellarhse_training`.`provider_type_view` `py`
        LEFT JOIN `stellarhse_training`.`training` `t` ON ((`t`.`training_id` = `py`.`training_id`)))
        LEFT JOIN `stellarhse_training`.`training_event_type` `tev` ON ((`tev`.`training_type_id` = `t`.`training_type_id`)))
        LEFT JOIN `stellarhse_auth`.`organization` `o` ON ((`o`.`org_id` = `t`.`org_id`)))
        LEFT JOIN `stellarhse_training`.`training_reason` `tr` ON ((`tr`.`training_reason_id` = `t`.`training_reason_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON ((`e2`.`employee_id` = `t`.`assigned_to_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e3` ON ((`e3`.`employee_id` = `t`.`staff_member_id`)))
        LEFT JOIN `stellarhse_training`.`level_achieved` `tl` ON ((`tl`.`level_achieved_id` = `t`.`level_achieved_id`)))
        LEFT JOIN `stellarhse_training`.`level_quality` `q` ON ((`q`.`level_quality_id` = `t`.`quality_of_training_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e4` ON ((`e4`.`employee_id` = `t`.`observed_by_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e6` ON ((`e6`.`employee_id` = `t`.`creator_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e7` ON ((`e7`.`employee_id` = `t`.`editing_by`)))
    WHERE
        ((`t`.`is_deleted` = 'No')
            AND (`t`.`hide` = 'No'))
    ORDER BY `t`.`training_number`;

/* */

/* added by Hend Aug. 15th, 2017 */

ALTER TABLE `stellarhse_inspection`.`inspection` 
ADD COLUMN `rep_emp_id` VARCHAR(20) NULL DEFAULT NULL AFTER `inspection_status_id`;

/* */

/* added by Alaa Aug. 16th, 2017 */

delimiter $$
drop procedure if exists reload_data$$
CREATE  PROCEDURE `reload_data`($hazard_number int,$org_id varchar(100))
begin
set @hazard_id=(select hazard_id from hazard where hazard_number=$hazard_number and org_id=$org_id and  version_number=(select max(version_number) from hazard where hazard_number=$hazard_number and org_id=$org_id));
select 
h.haz_type_id as `report_type_id`,
hev.`haz_type_name`,
h.`hazard_date` as `report_date`,
h.`hazard_time` as `report_hour`,
h.`hazard_min` as `report_min`,
`h`.`reporter_id`,
concat(e1.first_name,' ',e1.last_name) as reporter_name,
`h`.`rep_name`,
`h`.`rep_crew`,
`h`.`rep_email`,
`h`.`rep_position`,
`h`.`rep_company`,
`h`.`rep_primary_phone`,
`h`.`rep_alternate_phone`,
`h`.`rep_supervisor`,
`h`.`location1_id`,
`h`.`location2_id`,
`h`.`location3_id`,
`h`.`location4_id`,
`l1`.`location1_name`,
`l2`.`location2_name`,
`l3`.`location3_name`,
`l4`.`location4_name`,
`h`.`crew_involved` as crew_id,
cr.crew_name as crew_involved_name,
`h`.`operation_type_id`,
`otn`.`operation_type_name` AS `operation_type_name`,
`h`.`hazard_desc` as `report_description`,
`h`.`hazard_suspected_cause` as `report_suspected_cause`,
`h`.`initial_action_token`,
`h`.`hazard_status_id` as `hazard_status`,
`hs`.`status_Name` AS `status`,
`h`.`are_additional_corrective_actions_required`,
`h`.`recommended_corrective_actions_summary`,
`h`.`potential_impacts_desc`,
`h`.`should_work_stopped`,
`h`.`creator_id`,
`h`.`hazard_number`,
`h`.`hazard_note`,
`h`.`hazard_cause_note`,
`h`.`hazard_other_location` as `other_location`,
`h`.`is_deleted`,
`h`.`last_update_date`,
`h`.`editing_by`,
`h`.`hide`,
concat(e2.first_name,' ',e2.last_name) as editing_by_name
from hazard  h 
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_hazard`.`h`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_hazard`.`h`.`editing_by`
LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_hazard`.`h`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_hazard`.`h`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_hazard`.`h`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_hazard`.`h`.`location4_id`
LEFT JOIN `stellarhse_hazard`.`hazard_event_type` `hev` ON `hev`.`haz_type_id` = `stellarhse_hazard`.`h`.`haz_type_id`
LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_hazard`.`h`.`operation_type_id`
LEFT JOIN `stellarhse_common`.`status` `hs` ON `hs`.`status_id` = `stellarhse_hazard`.`h`.`hazard_status_id`
        LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_hazard`.`h`.`crew_involved`
where hazard_id=@hazard_id;

select 
hth.third_party_id,
tp.third_party_name,
hth.jop_number,
hth.contact_name,
tht.third_party_type_code
from hazard_third_party hth
left join stellarhse_common.third_party  tp on tp.third_party_id=hth.third_party_id 
left join stellarhse_common.third_party_type tht on tp.third_party_type_id = tht.third_party_type_id where hth.hazard_id=@hazard_id;
-- equipment
select 
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from hazard_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.hazard_id=@hazard_id;
-- impacts
SELECT hi.impact_type_id
FROM`stellarhse_hazard`.`hazard_impact` `hi`
where hazard_id=@hazard_id;
 -- risk_level   
  SELECT `stellarhse_hazard`.`hazard`.`hazard_id` AS `hazard_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_hazard`.`hazard_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`hazard_id` = `stellarhse_hazard`.`hazard`.`hazard_id`)
                    AND (`rl`.`risk_level_key` = 'hazard_exist'))) AS `hazard_exist_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_hazard`.`hazard_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`hazard_id` = `stellarhse_hazard`.`hazard`.`hazard_id`)
                    AND (`rl`.`risk_level_key` = 'worker_exposure'))) AS `worker_exposure_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_hazard`.`hazard_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`hazard_id` = `stellarhse_hazard`.`hazard`.`hazard_id`)
                    AND (`rl`.`risk_level_key` = 'potential_consequences'))) AS `potential_consequences_id`
    FROM
        `stellarhse_hazard`.`hazard`
    
        where hazard_id =@hazard_id;
-- risk_control
        select `risk_control_id` from `stellarhse_hazard`.`hazard_risk_control`
       WHERE  hazard_id=@hazard_id;
  -- hazard_details_tab     
        SELECT * from hazard_details_view where hazard_id=@hazard_id;

-- people_involved
SELECT
    `hp`.`people_involved_id`,
    `hp`.`hazard_id`,
    `hp`.`people_id`,
    `hp`.`third_party_id`,
    `hp`.`people_involved_name`,
    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',') 
    FROM
        `stellarhse_hazard`.`hazard_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
        
      (  SELECT 
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',') 
    FROM
        `stellarhse_hazard`.`hazard_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
        
FROM `stellarhse_hazard`.`hazard_people_involved` `hp`
 where hp.hazard_id =@hazard_id;
  -- corrective_action
  
  SELECT 

    `hc`.`hazard_corrective_action_id`,
    `hc`.`hazard_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_hazard`.`hazard_corrective_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id
where hc.hazard_id=@hazard_id and e.org_id = $org_id;

select `hc`.`hazard_corrective_action_id`,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_hazard`.`hazard_corrective_action_notified` hcn
join  `stellarhse_hazard`.`hazard_corrective_action` hc on hc.hazard_corrective_action_id = hcn.hazard_corrective_action_id
join `stellarhse_hazard`.`hazard` h on h.hazard_id = hc.hazard_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.notified_id
       WHERE h.hazard_id=@hazard_id and e.org_id = $org_id;

end$$
delimiter ;


/* */

/* added by Hend Aug. 17th, 2017 */

USE `stellarhse_inspection`;
DROP procedure IF EXISTS `sp_get_Hazard_classifications`;

DELIMITER $$
USE `stellarhse_inspection`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_Hazard_classifications`($org_id varchar(50),$search varchar(1000),$lmt int,$strt int)
begin
set @sql = concat('select SQL_CALC_FOUND_ROWS * from hazard_classifications_view ');
if  $org_id <>'' then 
set @sql = concat(@sql,'  where org_id =',"'",$org_id,"'");
end if;

if $search <> '' and $org_id <>''  then 
set @sql = concat(@sql,' and ',$search);
end if;

if ($search <> '' and ($org_id =''))  then 
set @sql = concat(@sql,' where ',$search);
end if;

set @sql = concat(@sql,' limit ',$strt,',',$lmt);
prepare stmt from @sql;
execute stmt;
deallocate prepare stmt;
select FOUND_ROWS();
end$$

DELIMITER ;

/* */

/* added by Alaa Aug. 17th, 2017 */

ALTER TABLE `stellarhse_hazard`.`hazard` 
ADD COLUMN `rep_emp_id` VARCHAR(50) NULL DEFAULT NULL AFTER `rep_name`;

ALTER TABLE `stellarhse_hazard`.`hazard` 
ADD COLUMN `hazard_record_number` VARCHAR(50) NULL DEFAULT NULL AFTER `other_event_type`;

/* */

/* added by Alaa Aug. 21st, 2017 */

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
CHANGE COLUMN `safetymeeting_min` `safetymeeting_min` VARCHAR(2) NULL DEFAULT NULL ;

ALTER TABLE `stellarhse_safetymeeting`.`safetymeeting` 
ADD COLUMN `rep_emp_id` VARCHAR(50) NULL DEFAULT NULL AFTER `rep_name`;

/* */

/* added by Alaa Aug. 21st, 2017 */

delimiter $$
drop procedure if exists safetymeeting_reload_data $$
CREATE  PROCEDURE `safetymeeting_reload_data`($safetymeeting_number int,$org_id varchar(100))
begin
set @sm_id=(select safetymeeting_id from safetymeeting where safetymeeting_number=$safetymeeting_number and org_id=$org_id and  version_number=(select max(version_number) from safetymeeting where safetymeeting_number=$safetymeeting_number and org_id=$org_id));
SELECT
    
    `sm`.`safetymeeting_id`,
    `sm`.`safetymeeting_type_id` as `report_type_id`,
    smet.safetymeeting_type_name ,
    `sm`.`org_id`,
    `sm`.`safetymeeting_date` as `report_date`,
    `sm`.`safetymeeting_hour` as `report_hour`,
    `sm`.`safetymeeting_min` as `report_min`,
    `sm`.`reporter_id`,
    concat(e1.first_name,' ',e1.last_name) as reporter_name,
    `sm`.`rep_name`,
    `sm`.`rep_crew`,
    `sm`.`rep_email`,
    `sm`.`rep_position`,
    `sm`.`rep_company`,
    `sm`.`rep_primary_phone`,
    `sm`.`rep_alternate_phone`,
    `sm`.`rep_supervisor`,
    `sm`.`location1_id`,
    `sm`.`location2_id`,
    `sm`.`location3_id`,
    `sm`.`location4_id`,
                `l1`.`location1_name`,
                `l2`.`location2_name`,
                `l3`.`location3_name`,
                `l4`.`location4_name`,
    `sm`.`crew_involved` as crew_id,
    `sm`.`operation_type_id`,
    `sm`.`safetymeeting_description` as `report_description`,
    `sm`.`creator_id`,
    `sm`.`safetymeeting_number`,
    `sm`.`safetymeeting_other_location` as `other_location`,
    `sm`.`is_deleted`,
    `sm`.`last_update_date`,
    `sm`.`editing_by`,
    concat(e2.first_name,' ',e2.last_name) as editing_by_name,
    `sm`.`modifier_id`,
    `sm`.`hide`
FROM `stellarhse_safetymeeting`.safetymeeting_tbl_vw`sm`
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_safetymeeting`.`sm`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_safetymeeting`.`sm`.`editing_by`
        LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_safetymeeting`.`sm`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_safetymeeting`.`sm`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_safetymeeting`.`sm`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_safetymeeting`.`sm`.`location4_id`
        LEFT JOIN `stellarhse_safetymeeting`.`safetymeeting_event_type` `smet` ON `smet`.`safetymeeting_type_id` = `stellarhse_safetymeeting`.`sm`.`safetymeeting_type_id`
where safetymeeting_id=@sm_id;
 
-- third_party
 select
hth.third_party_id,
tp.third_party_name,
hth.jop_number,
hth.contact_name,
tht.third_party_type_code
from safetymeeting_third_party hth
left join stellarhse_common.third_party tp on tp.third_party_id=hth.third_party_id
left join stellarhse_common.third_party_type tht on tp.third_party_type_id = tht.third_party_type_id where hth.safetymeeting_id=@sm_id;
 
-- people involved
SELECT
    `hp`.`people_involved_id`,
    `hp`.`safetymeeting_id`,
    `hp`.`people_id`,
    `hp`.`third_party_id`,
    `hp`.`people_involved_name`,
    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',')
    FROM
        `stellarhse_safetymeeting`.`safetymeeting_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
       
      (  SELECT
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',')
    FROM
        `stellarhse_safetymeeting`.`safetymeeting_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
FROM `stellarhse_safetymeeting`.`safetymeeting_people_involved` `hp`
where hp.safetymeeting_id =@sm_id;

 -- followup_action
SELECT
`smfa`.`safetymeeting_followup_action_id`,
`smfa`.`safetymeeting_id`,
`smfa`.`safetymeeting_followup_action_status_id` as `corrective_action_status_id`,
s.corrective_action_status_name,
`smfa`.`safetymeeting_followup_priority_id` as `corrective_action_priority_id`,
p.corrective_action_priority_name,
`smfa`.`assigned_to_id`,
concat(e.first_name,' ',e.last_name) as assigned_to_name,
e.`position`,
e.`org_name`,
`smfa`.`supervisor`,
`smfa`.`supervisor_notify`,
`smfa`.`start_date`,
`smfa`.`target_end_date`,
`smfa`.`actual_end_date`,
`smfa`.`estimated_cost`,
`smfa`.`actual_cost`,
`smfa`.`task_description`,
`smfa`.`out_come_follow_up`,
	CASE `smfa`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
`smfa`.`comments`
FROM `stellarhse_safetymeeting`.`safetymeeting_followup_action` smfa
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=smfa.safetymeeting_followup_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=smfa.safetymeeting_followup_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=smfa.assigned_to_id
where smfa.safetymeeting_id=@sm_id  and e.org_id = $org_id;
 
-- notified 
 
select `hc`.`safetymeeting_followup_action_id`,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_safetymeeting`.`safetymeeting_followup_action_notified` hcn
join  `stellarhse_safetymeeting`.`safetymeeting_followup_action` hc on hc.safetymeeting_followup_action_id = hcn.safetymeeting_followup_action_id
join `stellarhse_safetymeeting`.`safetymeeting` h on h.safetymeeting_id = hc.safetymeeting_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.`notified_id`
WHERE h.safetymeeting_id=@sm_id and e.org_id = $org_id;
 
end$$
delimiter ;

/* */

/* added by Alaa Aug. 22nd, 2017 */

ALTER TABLE `stellarhse_training`.`training` 
CHANGE COLUMN `location_of_training` `address` VARCHAR(255) NULL DEFAULT NULL ;

/* */



/* */

/* added by Hend Aug. 22th, 2017 */

ALTER TABLE `stellarhse_inspection`.`inspection` 
CHANGE COLUMN `inspection_min` `inspection_min` VARCHAR(2) NULL DEFAULT NULL ;



/* */

/* added by Hend Aug. 22th, 2017 */


USE `stellarhse_inspection`;
DROP procedure IF EXISTS `sp_get_People_involved`;

DELIMITER $$
USE `stellarhse_inspection`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_People_involved`($org_id varchar(50),$search varchar(1000),$lmt int,$strt int)
begin
set @sql = concat('select SQL_CALC_FOUND_ROWS * from people_involved_view ');
if  $org_id <>'' then 
set @sql = concat(@sql,'  where org_id =',"'",$org_id,"'");
end if;

if $search <> '' and $org_id <>''  then 
set @sql = concat(@sql,' and ',$search);
end if;

if ($search <> '' and ($org_id =''))  then 
set @sql = concat(@sql,' where ',$search);
end if;

set @sql = concat(@sql,' limit ',$strt,',',$lmt);
prepare stmt from @sql;
execute stmt;
deallocate prepare stmt;
select FOUND_ROWS();
end$$

DELIMITER ;


/* */

/* added by Hend Aug. 23th, 2017 */

USE `stellarhse_inspection`;
DROP procedure IF EXISTS `ins_reload_data`;

DELIMITER $$
USE `stellarhse_inspection`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `ins_reload_data`($inspection_number int,$org_id varchar(100))
begin
set @inspection_id=(select inspection_id from inspection where inspection_number=$inspection_number and org_id=$org_id and  version_number=(select max(version_number) from inspection where inspection_number=$inspection_number and org_id=$org_id));
select 
h.inspection_type_id as `report_type_id`,
hev.`inspection_type_name`,
h.`inspection_date` as `report_date`,
h.`inspection_hour` as `report_hour`,
h.`inspection_min` as `report_min`,
`h`.`reporter_id`,
`h`.`inspection_reason_id` as `inspection_reason_id`,
`h`.`inspection_description` as `inspection_description`,
concat(e1.first_name,' ',e1.last_name) as reporter_name,
`h`.`rep_name`,
`h`.`rep_crew`,
`h`.`rep_email`,
`h`.`rep_position`,
`h`.`rep_company`,
`h`.`rep_emp_id`, 
`h`.`rep_primary_phone` ,
`h`.`rep_alternate_phone` ,
`h`.`rep_supervisor` as `rep_supervisor`,
`h`.`location1_id`,
`h`.`location2_id`,
`h`.`location3_id`,
`h`.`location4_id`,
`l1`.`location1_name`,
`l2`.`location2_name`,
`l3`.`location3_name`,
`l4`.`location4_name`,
`h`.`crew_involved` as crew_id,
cr.crew_name as crew_involved_name,
`h`.`operation_type_id`,
`otn`.`operation_type_name` AS `operation_type_name`,
`h`.`hazard_description` as `report_description`, 
`h`.`hazard_suspected_cause` as `report_suspected_cause`,
`h`.`initial_action_token`,
`h`.`inspection_status_id` as `inspection_status`,
`hs`.`status_Name` AS `status`,
`h`.`are_additional_corrective_actions_required`,
`h`.`recommended_corrective_actions_summary`,
`h`.`potential_impacts_desc`,
`h`.`should_work_stopped`,
`h`.`creator_id`,
`h`.`inspection_number`,
`h`.`hazard_note`,
`h`.`hazard_cause_note`,
`h`.`inspection_other_location` as `other_location`,
`h`.`is_deleted`,
`h`.`last_update_date`,
`h`.`editing_by`,
`h`.`hide`,
concat(e2.first_name,' ',e2.last_name) as editing_by_name
from inspection  h 
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_inspection`.`h`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_inspection`.`h`.`editing_by`
LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_inspection`.`h`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_inspection`.`h`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_inspection`.`h`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_inspection`.`h`.`location4_id`
LEFT JOIN `stellarhse_inspection`.`inspection_event_type` `hev` ON `hev`.`inspection_type_id` = `stellarhse_inspection`.`h`.`inspection_type_id`
LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_inspection`.`h`.`operation_type_id`
LEFT JOIN `stellarhse_common`.`status` `hs` ON `hs`.`status_id` = `stellarhse_inspection`.`h`.`inspection_status_id`
        LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_inspection`.`h`.`crew_involved`
where inspection_id=@inspection_id;

select 
hth.third_party_id,
tp.third_party_name,
hth.jop_number,
hth.contact_name,
tht.third_party_type_code
from inspection_third_party hth
left join stellarhse_common.third_party  tp on tp.third_party_id=hth.third_party_id 
left join stellarhse_common.third_party_type tht on tp.third_party_type_id = tht.third_party_type_id where hth.inspection_id=@inspection_id;
-- equipment
select 
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from inspection_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.inspection_id=@inspection_id;
-- impacts
SELECT hi.impact_type_id
FROM`stellarhse_inspection`.`inspection_impact` `hi`
where inspection_id=@inspection_id;
 -- risk_level   
  SELECT `stellarhse_inspection`.`inspection`.`inspection_id` AS `inspection_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_inspection`.`inspection_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`inspection_id` = `stellarhse_inspection`.`inspection`.`inspection_id`)
                    AND (`rl`.`risk_level_key` = 'inspection_exist'))) AS `inspection_exist_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_inspection`.`inspection_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`inspection_id` = `stellarhse_inspection`.`inspection`.`inspection_id`)
                    AND (`rl`.`risk_level_key` = 'worker_exposure'))) AS `worker_exposure_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_inspection`.`inspection_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`inspection_id` = `stellarhse_inspection`.`inspection`.`inspection_id`)
                    AND (`rl`.`risk_level_key` = 'potential_consequences'))) AS `potential_consequences_id`
    FROM
        `stellarhse_inspection`.`inspection`
    
        where inspection_id =@inspection_id;
-- risk_control
        select `risk_control_id` from `stellarhse_inspection`.`inspection_risk_control`
       WHERE  inspection_id=@inspection_id;
  -- inspection_details_tab     
     select * from hazard_details_view where inspection_id=@inspection_id;
-- people_involved
SELECT
    `hp`.`people_involved_id`,
    `hp`.`inspection_id`,
    `hp`.`people_id`,
    `hp`.`third_party_id`,
    `hp`.`people_involved_name`,
    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',') 
    FROM
        `stellarhse_inspection`.`inspection_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
        
      (  SELECT 
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',') 
    FROM
        `stellarhse_inspection`.`inspection_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
        
FROM `stellarhse_inspection`.`inspection_people_involved` `hp`
 where hp.inspection_id =@inspection_id;
  -- corrective_action
  
  SELECT 
    `hc`.`inspection_corrective_action_id`,
    `hc`.`inspection_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_inspection`.`inspection_corrective_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id and e.org_id = $org_id
where hc.inspection_id=@inspection_id;

select `hc`.`inspection_corrective_action_id`,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_inspection`.`inspection_corrective_action_notified` hcn
join  `stellarhse_inspection`.`inspection_corrective_action` hc on hc.inspection_corrective_action_id = hcn.inspection_corrective_action_id
join `stellarhse_inspection`.`inspection` h on h.inspection_id = hc.inspection_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.notified_id
WHERE h.inspection_id=@inspection_id and e.org_id = $org_id;
end$$

DELIMITER ;

/* */

/* added by Hend Aug. 24th, 2017 */

ALTER TABLE `stellarhse_maintenance`.`maintenance` 
ADD COLUMN `version_number` INT(5) NULL DEFAULT NULL AFTER `hide`;


ALTER TABLE `stellarhse_maintenance`.`maintenance` 
CHANGE COLUMN `maintenance_minute` `maintenance_minute` VARCHAR(5) NULL DEFAULT NULL ;

USE `stellarhse_maintenance`;
DROP procedure IF EXISTS `maintenance_reload_data`;

DELIMITER $$
USE `stellarhse_maintenance`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `maintenance_reload_data`($maintenance_number int,$org_id varchar(100))
begin
declare $maintenance_id varchar(100);
set $maintenance_id=(select maintenance_id from maintenance where maintenance_number=$maintenance_number and org_id=$org_id and  version_number=(select max(version_number) from maintenance where maintenance_number=$maintenance_number and org_id=$org_id));
 
SELECT
    `m`.`maintenance_id`,
    `m`.`maintenance_type_id`,
    hev.`maintenance_type_name`,
    `m`.`maintenance_reason_id`,
    `m`.`org_id`,
    `m`.`maintenance_date` as `report_date`,
    `m`.`maintenance_hour`as `report_hour`,
    `m`.`maintenance_minute`as `report_min`,
     concat(e1.first_name,' ',e1.last_name) as reporter_name,
    `m`.`reporter_id`,
    `m`.`rep_name`,
    `m`.`rep_emp_id`,
    `m`.`rep_position`,
    `m`.`rep_crew`,
    `m`.`rep_email`,
    `m`.`rep_company`,
    `m`.`rep_primary_phone`,
    `m`.`rep_alternate_phone`,
    `m`.`rep_supervisor`,
    `m`.`location1_id`,
    `m`.`location2_id`,
    `m`.`location3_id`,
    `m`.`location4_id`,
    `l1`.`location1_name`,
    `l2`.`location2_name`,
	`l3`.`location3_name`,
    `l4`.`location4_name`,
    `m`.`other_location`,
    `m`.`crew_involved`  as crew_id,
    cr.crew_name as crew_involved_name,
    `m`.`operation_type_id`,
    `m`.`Facility_location_last_maintenance`,
    `m`.`last_maintenance_date`,
    `m`.`maintenance_description` as `report_description`,
    `m`.`unusual_findings_resulting_from_maintenance`,
    `m`.`are_additional_followup_actions_required`,
    `m`.`summary_of_recommended_followup_actions`,
    `m`.`creator_id`,
    `m`.`maintenance_number`,
    `m`.`is_deleted`,
    `m`.`editing_by`,
    `m`.`modifier_id`,
    `m`.`last_update_date`,
    `m`.`hide`
FROM `stellarhse_maintenance`.maintenance_tbl_vw `m` 
LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_maintenance`.`m`.`reporter_id`
LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_maintenance`.`m`.`editing_by`
LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_maintenance`.`m`.`location1_id`
LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_maintenance`.`m`.`location2_id`
LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_maintenance`.`m`.`location3_id`
LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_maintenance`.`m`.`location4_id`
LEFT JOIN `stellarhse_maintenance`.`maintenance_event_type` `hev` ON `hev`.`maintenance_type_id` = `stellarhse_maintenance`.`m`.`maintenance_type_id`
LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_maintenance`.`m`.`operation_type_id`
LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_maintenance`.`m`.`crew_involved`
where m.maintenance_id=$maintenance_id;
 
-- third_party
select
hth.third_party_id,
tp.third_party_name,
hth.jop_number,
hth.contact_name,
tht.third_party_type_code
from maintenance_third_party hth
left join stellarhse_common.third_party  tp on tp.third_party_id=hth.third_party_id
left join stellarhse_common.third_party_type tht on tp.third_party_type_id = tht.third_party_type_id where hth.maintenance_id=$maintenance_id;
 
-- equipment
select
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from maintenance_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.maintenance_id=$maintenance_id;
 
-- people_involved
SELECT
    `mp`.`people_involved_id`,
    `mp`.`maintenance_id`,
    `mp`.`people_id`,
    `mp`.`third_party_id`,
    `mp`.`people_involved_name`,
    `mp`.`company`,
    `mp`.`supervisor`,
    `mp`.`position`,
    `mp`.`email`,
    `mp`.`primary_phone`,
    `mp`.`alternate_phone`,
    `mp`.`exp_in_current_postion`,
    `mp`.`exp_over_all`,
    `mp`.`age`,
    `mp`.`crew`,
    `mp`.`how_he_involved`,
    `mp`.`role_description`,
    `mp`.`last_update_date`,
    `mp`.`editing_by`,
    `mp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',')
    FROM
        `stellarhse_maintenance`.`maintenance_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `mp`.`people_involved_id`=ma.people_involved_id)as acting,       
      ( SELECT
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',')
        FROM
        `stellarhse_maintenance`.`maintenance_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `mp`.`people_involved_id`=mc.people_involved_id) as certificate
FROM `stellarhse_maintenance`.`maintenance_people_involved` `mp`
where mp.maintenance_id =$maintenance_id;
-- corrective_action
SELECT
    `hc`.`maintenance_followup_action_id`,
    `hc`.`maintenance_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_maintenance`.`maintenance_followup_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id and e.org_id = $org_id
where hc.maintenance_id=$maintenance_id;
 
 
select `hc`.`maintenance_followup_action_id`,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_maintenance`.`maintenance_followup_action_notified` hcn
join  `stellarhse_maintenance`.`maintenance_followup_action` hc on hc.maintenance_followup_action_id = hcn.maintenance_followup_action_id
join `stellarhse_maintenance`.`maintenance` h on h.maintenance_id = hc.maintenance_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.`notified_id`
WHERE h.maintenance_id=$maintenance_id and e.org_id = $org_id;
 
end$$

DELIMITER ;

/* */

/* added by Hend Sep. 12th, 2017 */

USE `stellarhse_incident`;
DROP procedure IF EXISTS `incident_reload_data`;

DELIMITER $$
USE `stellarhse_incident`$$
CREATE PROCEDURE `incident_reload_data`($incident_number int,$org_id varchar(100))
begin
set @incident_id=(select incident_id from incident where incident_number=$incident_number and org_id=$org_id and  version_number=(select max(version_number) from incident where incident_number=$incident_number and org_id=$org_id));
SELECT 
    `inc`.incident_id,
    `inc`.event_type_id AS `report_type_id`,
    hev.`incident_event_type_name` AS `incident_type_name`,
    `inc`.`incident_date` AS `report_date`,
    `inc`.`incident_hour` AS `report_hour`,
    `inc`.`incident_minute` AS `report_min`,
    `inc`.`reporter_id`,
    CONCAT(e1.first_name, ' ', e1.last_name) AS reporter_name,
    `inc`.`rep_name`,
    inc.`rep_emp_id`,
    `inc`.`rep_crew`,
    `inc`.`rep_email`,
    `inc`.`rep_position`,
    `inc`.`rep_company`,
    `inc`.`rep_primary_phone`,
    `inc`.`rep_alternate_phone`,
    `inc`.`rep_supervisor`,
    `inc`.`location1_id`,
    `inc`.`location2_id`,
    `inc`.`location3_id`,
    `inc`.`location4_id`,
    `inc`.`other_location` AS `other_location`,
    `l1`.`location1_name`,
    `l2`.`location2_name`,
    `l3`.`location3_name`,
    `l4`.`location4_name`,
    `inc`.`crew_involved` AS crew_id,
    cr.crew_name AS crew_involved_name,
    `inc`.`operation_type_id`,
    `otn`.`operation_type_name` AS `operation_type_name`,
    `inc`.`is_emergency_response` AS is_emergency_response,
    `inc`.`incident_description` AS `incident_description`,
    inc.`env_condition_note` AS `env_condition_note`,
    inc.`event_sequence`,
    `inc`.`should_work_stopped`,
    inc.`energy_form_note`,
    inc.`sub_standard_action_note`,
    inc.`sub_standard_condition_note`,
    inc.`under_lying_cause_note`,
     `inc`.`inv_status_id`,
    `inc`.`investigation_date`,
    `inc`.`investigator_id1`,
    `inc`.`investigator_name1`,
    `inc`.`investigator_id2`,
    `inc`.`investigator_name2`,
    `inc`.`investigator_id3`,
    `inc`.`investigator_name3`,
    `inc`.`investigation_summary`,
    `inc`.`investigation_follow_up_note`,
    `inc`.`investigation_response_cost`,
    `inc`.`investigation_repair_cost`,
    `inc`.`investigation_insurance_cost`,
    `inc`.`investigation_wcb_cost`,
    `inc`.`investigation_other_cost`,
    `inc`.`investigation_total_cost`,
    `inc`.`investigation_risk_of_recurrence_id`,
    `inc`.`investigation_severity_id`,
     group_concat(invs.inv_source_id)as inv_source_id ,
    `inc`.`investigation_source_details`,
    `inc`.`investigation_root_cause_note`,
    `inc`.`sign_off_investigator_id`,
    `inc`.`sign_off_investigator_name`,
    `inc`.`investigation_sign_off_date`,
    
    
    `inc`.`creator_id`,
    `inc`.`incident_number`,
    `inc`.`is_deleted`,
    `inc`.`last_update_date`,
    `inc`.`editing_by`,
    `inc`.`hide`,
    CONCAT(e2.first_name, ' ', e2.last_name) AS editing_by_name
FROM
    incident `inc`
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_incident`.`inc`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_incident`.`inc`.`editing_by`
        LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_incident`.`inc`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_incident`.`inc`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_incident`.`inc`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_incident`.`inc`.`location4_id`
        LEFT JOIN `stellarhse_incident`.`incident_event_type` `hev` ON `stellarhse_incident`.`inc`.`event_type_id` = hev.`incident_event_type_id`
        LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_incident`.`inc`.`operation_type_id`
        LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_incident`.`inc`.`crew_involved`
		LEFT JOIN `incident_inv_source` invs on invs.incident_id=inc.incident_id
WHERE
    inc.incident_id = @incident_id;
SELECT 
    hth.third_party_id,
    tp.third_party_name,
    hth.job_number,
    hth.contact_name,
    tht.third_party_type_code
FROM incident_third_party hth
        LEFT JOIN stellarhse_common.third_party tp ON tp.third_party_id = hth.third_party_id
        LEFT JOIN stellarhse_common.third_party_type tht ON tp.third_party_type_id = tht.third_party_type_id
WHERE hth.incident_id = @incident_id;

select 
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from incident_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.incident_id=@incident_id;
  SELECT `stellarhse_incident`.`incident`.`incident_id` AS `incident_id`,
  
           (SELECT 
            hrl.risk_level_id
   FROM
(`stellarhse_common`.`risk_level` `rl`
JOIN `stellarhse_incident`.`incident_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
((`hrl`.`incident_id` = `stellarhse_incident`.`incident`.`incident_id`)
  AND (`rl`.`risk_level_key` = 'incident_exist'))) AS `incident_exist_id`,
           
           (SELECT 
            hrl.risk_level_id
            FROM
(`stellarhse_common`.`risk_level` `rl`
JOIN `stellarhse_incident`.`incident_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
((`hrl`.`incident_id` = `stellarhse_incident`.`incident`.`incident_id`)
AND (`rl`.`risk_level_key` = 'worker_exposure'))) AS `worker_exposure_id`,
            
            (SELECT 
            hrl.risk_level_id
            FROM
(`stellarhse_common`.`risk_level` `rl`
JOIN `stellarhse_incident`.`incident_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE ((`hrl`.`incident_id` = `stellarhse_incident`.`incident`.`incident_id`)
AND (`rl`.`risk_level_key` = 'potential_consequences'))) AS `potential_consequences_id`
    FROM
        `stellarhse_incident`.`incident`
        where incident_id =@incident_id;
    SELECT 
        `iev`.`incident_id` AS `incident_id`,
        `t`.`env_condition_name` AS `env_condition_type`,
`t`.`env_condition_id`  as env_condition_id,
GROUP_CONCAT(`iev`.`env_cond_parameter_id`  SEPARATOR ',') AS `env_condition_sub_type`
    FROM
        (((`stellarhse_incident`.`incident_env_cond` `iev`
        JOIN `stellarhse_incident`.`env_cond_parameter` `st` ON ((`st`.`env_cond_parameter_id` = `iev`.`env_cond_parameter_id`)))
        JOIN `stellarhse_incident`.`env_condition` `t` ON ((`t`.`env_condition_id` = `st`.`env_condition_id`)))
        JOIN `stellarhse_incident`.`incident` `inc` ON ((`inc`.`incident_id` = `iev`.`incident_id`)))
    WHERE
        (`inc`.`is_deleted` = 0)
    GROUP BY `iev`.`incident_id` , `env_condition_type`
    ORDER BY `inc`.`incident_number`
    and iev.incident_id=@incident_id 
    ;
    
select oe_department_id from incident_oe_department where incident_id=@incident_id;
select `risk_control_id` from `stellarhse_incident`.`incident_risk_control`
WHERE  incident_id=@incident_id;
SELECT
    `hp`.`people_involved_id`,
    `hp`.`incident_id`,
    `hp`.`people_id`,
    `hp`.`third_party_id`,
    `hp`.`people_involved_name`,
    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',') 
    FROM
        `stellarhse_incident`.`incident_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
        
      (  SELECT 
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',') 
    FROM
        `stellarhse_incident`.`incident_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
        
FROM `stellarhse_incident`.`incident_people_involved` `hp`
 where hp.incident_id =@incident_id;
 -- corrective_action
  
  SELECT 
    `hc`.`incident_corrective_action_id`,
    `hc`.`incident_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_incident`.`incident_corrective_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id
where hc.incident_id=@incident_id and e.org_id = $org_id;
select `hc`.`incident_corrective_action_id`,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_incident`.`incident_corrective_action_notified` hcn
join  `stellarhse_incident`.`incident_corrective_action` hc on hc.incident_corrective_action_id = hcn.incident_corrective_action_id
join `stellarhse_incident`.`incident` h on h.incident_id = hc.incident_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.notified_id
WHERE h.incident_id=@incident_id and e.org_id = $org_id;

-- Scat Analysis
SELECT
`scat_analysis`.`scat_analysis_id`,
    `scat_analysis`.`incident_id`,
    `scat_analysis`.`type_of_energy_id` as `scat_items_params_id`,
      scp1.`scat_items_params_name` as type_of_energy_name ,
    `scat_analysis`.`immediate_cause_id` as `scat_direct_cause_id`,
       scp2.`scat_items_params_name` as immediate_cause_name,
    `scat_analysis`.`basic_cause_id` as `scat_basic_cause_id`,
       scp3.`scat_items_params_name`  as basic_cause_name,
    `scat_analysis`.`sub_cause_id` as `scat_sub_cause_id`,
       scp4.`scat_items_params_name` as sub_cause,
    `scat_analysis`.`immdeiate_cause_type` as `scatDirectCauseType`,
    `scat_analysis`.`basic_cause_type` as `scatBasicCauseType`,
    `scat_analysis`.`comment`,
    `scat_analysis`.`updated_date`
FROM `stellarhse_incident`.`scat_analysis`  
join scat_items_params scp1 on scp1.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
join scat_items_params scp2 on scp2.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
join scat_items_params scp3 on scp3.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
join scat_items_params scp4 on scp4.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
 where  `scat_analysis`.`incident_id`=@incident_id ;
 
 SELECT 
`inc_op`.`incident_id`,
`oa`.`observation_and_analysis_id` as main_type_id,
`oa`.`observation_and_analysis_code`,
(select parent_id from `observation_analysis_param` where observation_and_analysis_param_id=`inc_op`.`observation_and_analysis_param_id`) as parent_id,
(select observation_and_analysis_param_name from `observation_analysis_param` where observation_and_analysis_param_id =
(select parent_id from `observation_analysis_param` where observation_and_analysis_param_id=`inc_op`.`observation_and_analysis_param_id`)) as parent_name,
group_concat(`inc_op`.`observation_and_analysis_param_id`  separator ',')  as  sub_type
FROM `stellarhse_incident`.`incident_observation_analysis`  inc_op
join `observation_analysis_param` p on p.observation_and_analysis_param_id=inc_op.observation_and_analysis_param_id
join  `observation_analysis` oa on oa.`observation_and_analysis_id`=p.`observation_and_analysis_id`
group by incident_id,observation_and_analysis_code,parent_name
having incident_id=@incident_id 
order by observation_and_analysis_code;

select 
irc.incident_id,
if(rc.field_code is  null,rc.root_cause_name,rc.field_code) as cause_name,
rc.root_cause_id as root_cause_id,
group_concat(irc.root_cause_param_id) as root_cause_param_ids,
irc.other
from incident_root_cause  irc
left join root_cause_param  rcb  on rcb.root_cause_param_id=irc.root_cause_param_id
left join root_cause rc on rc.root_cause_id=rcb.root_cause_id
group by incident_id,root_cause_id
having incident_id=@incident_id;
end$$

DELIMITER ;

/* */

/* added by Alaa Sep. 13th, 2017 */

USE `stellarhse_incident`;
DROP procedure IF EXISTS `impact_reload_data`;

DELIMITER $$
USE `stellarhse_incident`$$
CREATE PROCEDURE `impact_reload_data`($incident_number int,$org_id varchar(100))
begin
declare ending1  int default 0;
declare ending2  int default 0;
declare ending3  int default 0;
declare ending4  int default 0;
declare ending5  int default 0;
declare ending6  int default 0;
declare $ill_id,$sp_id,$inj_id,$imp_id,$veh_id,$tra_id varchar(100);
set @incident_id=(select incident_id from incident where incident_number=$incident_number and org_id=$org_id and  version_number=(select max(version_number) from incident where incident_number=$incident_number and org_id=$org_id));
 
 -- incident_illness
 BLOCK1: BEGIN
declare  all_curs1 cursor for 
select incident_illness_id from incident_illness where incident_id=@incident_id;
declare continue handler for not found set ending1 = 1;
  open all_curs1;
  curs1:loop
  fetch all_curs1 into $ill_id;
  if ending1=1  then leave curs1;
  end if;
  -- if $ill_id is not null then 
  SELECT `incident_illness`.`incident_illness_id`,
    `incident_illness`.`incident_id`,
     imp.impact_type_name as impact_type,
	 imp.impact_type_code,
	 imp.impact_type_id as impact_type_id,
	`imps`.`impact_sub_type_name`,
    `incident_illness`.`impact_sub_type_id`,
    `incident_illness`.`impact_description`,
    group_concat(ext.ext_agency_id separator ',') as external_agency,
    `incident_illness`.`initial_employee_id1`,
    `incident_illness`.`initial_employee_name1`,
    `incident_illness`.`initial_employee_dept1`,
    `incident_illness`.`initial_employee_id2`,
    `incident_illness`.`initial_employee_name2`,
    `incident_illness`.`initial_employee_dept2`,
    `incident_illness`.`initial_employee_id3`,
    `incident_illness`.`initial_employee_name3`,
    `incident_illness`.`initial_employee_dept3`,
    `incident_illness`.`primary_responder_id`,
    `incident_illness`.`primary_responder_name`,
    `incident_illness`.`estimated_cost`,
    `incident_illness`.`personal_afflicted_id`,
    `incident_illness`.`personal_afflicted_name`,
    `incident_illness`.`initial_treatment_id`,
    group_concat(iis.symptoms_id)as  symptoms_id, 
    `incident_illness`.`restricted_work_id`,
    `incident_illness`.`lost_time_start`,
    `incident_illness`.`lost_time_end`,
    `incident_illness`.`adjustment_days`,
    `incident_illness`.`total_days_off`,
    `incident_illness`.`editing_by`,
    `incident_illness`.`hide`
FROM `stellarhse_incident`.`incident_illness`
left join stellarhse_common.impact_sub_type imps  on imps.impact_sub_type_id=`incident_illness`.`impact_sub_type_id`
left join stellarhse_common.impact_type imp on imp.impact_type_id=`imps`.`impact_type_id`
left join impacts_ext_agency ext on ext.illness_id=`incident_illness`.`incident_illness_id`
left join incident_illness_symptoms iis on iis.incident_illness_id=`incident_illness`.`incident_illness_id`
where incident_id =@incident_id and `incident_illness`.incident_illness_id=$ill_id;
end loop;
close all_curs1;
end BLOCK1 ;
BLOCK2: BEGIN
declare  all_curs2 cursor for 
select incident_impact_id from incident_impact where incident_id=@incident_id;
declare continue handler for not found set ending2 =1;
  open all_curs2;
  curs2:loop
  fetch all_curs2 into $imp_id;
  if ending2=1  then leave curs2;
  end if;
  -- if $imp_id is not null  then 
 SELECT 
    `incident_impact`.`incident_impact_id`,
    `incident_impact`.`incident_id`,
	 imp.impact_type_name as impact_type,
	 imp.impact_type_code,
	 imp.impact_type_id as impact_type_id,
    `incident_impact`.`impact_sub_type_id`,
    `incident_impact`.`impact_description`,
	group_concat(ext.ext_agency_id separator ',') as external_agency,
    `incident_impact`.`initial_employee_id1`,
    `incident_impact`.`initial_employee_name1`,
    `incident_impact`.`initial_employee_dept1`,
    `incident_impact`.`initial_employee_id2`,
    `incident_impact`.`initial_employee_name2`,
    `incident_impact`.`initial_employee_dept2`,
    `incident_impact`.`initial_employee_id3`,
    `incident_impact`.`initial_employee_name3`,
    `incident_impact`.`initial_employee_dept3`,
    `incident_impact`.`primary_responder_id`,
    `incident_impact`.`primary_responder_name`,
    `incident_impact`.`estimated_cost`,
    `incident_impact`.`last_update_date`,
    `incident_impact`.`editing_by`,
    `incident_impact`.`hide`
FROM `stellarhse_incident`.`incident_impact`
left join stellarhse_common.impact_sub_type imps  on imps.impact_sub_type_id=`incident_impact`.`impact_sub_type_id`
left join stellarhse_common.impact_type imp on imp.impact_type_id=`imps`.`impact_type_id`
left join impacts_ext_agency ext on ext.impact_id=`incident_impact`.`incident_impact_id`
where incident_id =@incident_id and incident_impact_id=$imp_id;
end loop;
close all_curs2;
end BLOCK2 ;
BLOCK3: BEGIN
declare  all_curs3 cursor for 
select incident_injury_id from incident_injury where incident_id=@incident_id;
declare continue handler for not found set ending3= 1;
  open all_curs3;
  curs3:loop
  fetch all_curs3 into $inj_id;
  if ending3=1  then leave curs3;
  end if;
 -- if $inj_id is not null then 
 
 SELECT 
    `incident_injury`.`incident_injury_id`,
    `incident_injury`.`incident_id`,
	 imp.impact_type_name as impact_type,
	 imp.impact_type_code,
	 imp.impact_type_id as impact_type_id,
    `incident_injury`.`personal_injured_id`,
    `incident_injury`.`personal_injured_name`,
    `incident_injury`.`initial_treatment_id`,
    group_concat(bp.body_part_id separator ',')as body_part,
    `incident_injury`.`contact_code_id`,
	group_concat(it.injury_type_id separator ',')as injury_type,    
    `incident_injury`.`contact_agency_id`,
	group_concat(ba.body_area_id separator ',')as body_area,    
    `incident_injury`.`recordable_id`,
    `incident_injury`.`injury_description`,
	group_concat(ext.ext_agency_id separator ',') as external_agency,
    `incident_injury`.`restricted_work_id`,
    `incident_injury`.`lost_time_start`,
    `incident_injury`.`lost_time_end`,
    `incident_injury`.`adjustment_days`,
    `incident_injury`.`total_days_off`,
    `incident_injury`.`impact_sub_type_id`,
    `incident_injury`.`initial_employee_id1`,
    `incident_injury`.`initial_employee_name1`,
    `incident_injury`.`initial_employee_dept1`,
    `incident_injury`.`initial_employee_id2`,
    `incident_injury`.`initial_employee_name2`,
    `incident_injury`.`initial_employee_dept2`,
    `incident_injury`.`initial_employee_id3`,
    `incident_injury`.`initial_employee_name3`,
    `incident_injury`.`initial_employee_dept3`,
    `incident_injury`.`primary_responder_id`,
    `incident_injury`.`primary_responder_name`,
    `incident_injury`.`impact_description`,
    `incident_injury`.`estimated_cost`,
    `incident_injury`.`last_update_date`,
    `incident_injury`.`editing_by`,
    `incident_injury`.`hide`
FROM `stellarhse_incident`.`incident_injury`
left join stellarhse_common.impact_sub_type imps  on imps.impact_sub_type_id=`incident_injury`.`impact_sub_type_id`
left join stellarhse_common.impact_type imp on imp.impact_type_id=`imps`.`impact_type_id`
left join impacts_ext_agency ext on ext.injury_id=`incident_injury`.`incident_injury_id`
left join impact_injury_body_part bp on bp.injury_id=`incident_injury`.`incident_injury_id`
left join impact_injury_body_area ba on ba.injury_id=`incident_injury`.`incident_injury_id` 
left join impact_injury_type it on it.injury_id=`incident_injury`.`incident_injury_id` 
where incident_id =@incident_id and incident_injury_id=$inj_id;
end loop;
close all_curs3;
end BLOCK3 ;
BLOCK4: BEGIN
declare  all_curs4 cursor for 
select incident_spill_release_id from incident_spill_release where incident_id=@incident_id;
declare continue handler for not found set ending4 = 1;
  open all_curs4;
  curs4:loop
  fetch all_curs4 into $sp_id;
  if ending4=1  then leave curs4;
  end if;
 
 -- if $sp_id is not null  then 
SELECT `incident_spill_release`.`incident_spill_release_id`,
    `incident_spill_release`.`incident_id`,
	 imp.impact_type_name as impact_type,
	 imp.impact_type_code,
	 imp.impact_type_id as impact_type_id,
    `incident_spill_release`.`spill_release_source_id`,
    `incident_spill_release`.`duration_value`,
    `incident_spill_release`.`duration_unit_id`,
    `incident_spill_release`.`quantity_value`,
    `incident_spill_release`.`quantity_unit_id`,
    `incident_spill_release`.`quantity_recovered_value`,
    `incident_spill_release`.`quantity_recovered_unit_id`,
    `incident_spill_release`.`what_was_spill_release`,
    `incident_spill_release`.`how_spill_release_occur`,
    `incident_spill_release`.`is_reportable`,
    `incident_spill_release`.`spill_release_agency_id`,
    `incident_spill_release`.`impact_sub_type_id`,
    `incident_spill_release`.`initial_employee_id1`,
    `incident_spill_release`.`initial_employee_name1`,
    `incident_spill_release`.`initial_employee_dept1`,
    `incident_spill_release`.`initial_employee_id2`,
    `incident_spill_release`.`initial_employee_name2`,
    `incident_spill_release`.`initial_employee_dept2`,
    `incident_spill_release`.`initial_employee_id3`,
    `incident_spill_release`.`initial_employee_name3`,
    `incident_spill_release`.`initial_employee_dept3`,
    `incident_spill_release`.`primary_responder_id`,
    `incident_spill_release`.`primary_responder_name`,
    `incident_spill_release`.`impact_description`,
	group_concat(ext.ext_agency_id separator ',') as external_agency,
    `incident_spill_release`.`estimated_cost`,
    `incident_spill_release`.`last_update_date`,
    `incident_spill_release`.`editing_by`,
    `incident_spill_release`.`hide`
FROM `stellarhse_incident`.`incident_spill_release`
left join stellarhse_common.impact_sub_type imps  on imps.impact_sub_type_id=`incident_spill_release`.`impact_sub_type_id`
left join stellarhse_common.impact_type imp on imp.impact_type_id=`imps`.`impact_type_id`
left join impacts_ext_agency ext on ext.spill_release_id=`incident_spill_release`.`incident_spill_release_id`
where incident_id =@incident_id and incident_spill_release_id=$sp_id;
end loop;
close all_curs4;
end BLOCK4 ;
BLOCK5: BEGIN
declare  all_curs5 cursor for 
select incident_vehicle_damage_id from incident_vehicle_damage where incident_id=@incident_id;
declare continue handler for not found set ending5 =1;
  open all_curs5;
  curs5:loop
  fetch all_curs5 into $veh_id;
  if ending5=1  then leave curs5;
  end if;
  -- if $veh_id is not null  then 
 SELECT `incident_vehicle_damage`.`incident_vehicle_damage_id`,
    `incident_vehicle_damage`.`incident_id`,
	 imp.impact_type_name as impact_type,
	 imp.impact_type_code,
	 imp.impact_type_id as impact_type_id,
    `incident_vehicle_damage`.`driver_id`,
    `incident_vehicle_damage`.`driver_name`,
    `incident_vehicle_damage`.`driver_licence`,
    `incident_vehicle_damage`.`vehicle_type_id`,
    `incident_vehicle_damage`.`vehicle_licence`,
    `incident_vehicle_damage`.`how_did_that_occur`,
    `incident_vehicle_damage`.`damage_description`,
    `incident_vehicle_damage`.`impact_sub_type_id`,
    `incident_vehicle_damage`.`initial_employee_id1`,
    `incident_vehicle_damage`.`initial_employee_name1`,
    `incident_vehicle_damage`.`initial_employee_dept1`,
    `incident_vehicle_damage`.`initial_employee_id2`,
    `incident_vehicle_damage`.`initial_employee_name2`,
    `incident_vehicle_damage`.`initial_employee_dept2`,
    `incident_vehicle_damage`.`initial_employee_id3`,
    `incident_vehicle_damage`.`initial_employee_name3`,
    `incident_vehicle_damage`.`initial_employee_dept3`,
    `incident_vehicle_damage`.`primary_responder_id`,
    `incident_vehicle_damage`.`primary_responder_name`,
    `incident_vehicle_damage`.`impact_description`,
	 group_concat(ext.ext_agency_id separator ',') as external_agency,
    `incident_vehicle_damage`.`estimated_cost`,
    `incident_vehicle_damage`.`last_update_date`,
    `incident_vehicle_damage`.`editing_by`,
    `incident_vehicle_damage`.`hide`
FROM `stellarhse_incident`.`incident_vehicle_damage`
left join stellarhse_common.impact_sub_type imps  on imps.impact_sub_type_id=`incident_vehicle_damage`.`impact_sub_type_id`
left join stellarhse_common.impact_type imp on imp.impact_type_id=`imps`.`impact_type_id`
left join impacts_ext_agency ext on ext.vehicle_damage_id=`incident_vehicle_damage`.`incident_vehicle_damage_id`
where incident_id =@incident_id and incident_vehicle_damage_id=$veh_id;
end loop;
close all_curs5;
end BLOCK5 ;
BLOCK5: BEGIN
declare  all_curs cursor for 
select incident_traffic_violation_id from incident_traffic_violation where incident_id=@incident_id;
declare continue handler for not found set ending6 =1;
set @rst='';
  open all_curs;
  curs:loop
  fetch all_curs into $tra_id;
  if ending6=1  then leave curs;
  end if;
  SELECT `incident_traffic_violation`.`incident_traffic_violation_id`,
    `incident_traffic_violation`.`incident_id`,
	 imp.impact_type_name as impact_type,
	 imp.impact_type_code,
	 imp.impact_type_id as impact_type_id,
    `incident_traffic_violation`.`driver_id`,
    `incident_traffic_violation`.`driver_name`,
    `incident_traffic_violation`.`driver_licence`,
    `incident_traffic_violation`.`vehicle_type_id`,
    `incident_traffic_violation`.`vehicle_licence`,
    `incident_traffic_violation`.`damage_description`,
    `incident_traffic_violation`.`value_of_fine`,
    `incident_traffic_violation`.`ticket_number`,
    `incident_traffic_violation`.`how_did_that_occur`,
    `incident_traffic_violation`.`impact_sub_type_id`,
    `incident_traffic_violation`.`initial_employee_id1`,
    `incident_traffic_violation`.`initial_employee_name1`,
    `incident_traffic_violation`.`initial_employee_dept1`,
    `incident_traffic_violation`.`initial_employee_id2`,
    `incident_traffic_violation`.`initial_employee_name2`,
    `incident_traffic_violation`.`initial_employee_dept2`,
    `incident_traffic_violation`.`initial_employee_id3`,
    `incident_traffic_violation`.`initial_employee_name3`,
    `incident_traffic_violation`.`initial_employee_dept3`,
    `incident_traffic_violation`.`primary_responder_name`,
    `incident_traffic_violation`.`primary_responder_id`,
    `incident_traffic_violation`.`impact_description`,
	group_concat(ext.ext_agency_id separator ',') as external_agency,
    `incident_traffic_violation`.`estimated_cost`,
    `incident_traffic_violation`.`last_update_date`,
    `incident_traffic_violation`.`editing_by`,
    `incident_traffic_violation`.`hide`
FROM `stellarhse_incident`.`incident_traffic_violation`
left join stellarhse_common.impact_sub_type imps  on imps.impact_sub_type_id=`incident_traffic_violation`.`impact_sub_type_id`
left join stellarhse_common.impact_type imp on imp.impact_type_id=`imps`.`impact_type_id`
left join impacts_ext_agency ext on ext.traffic_violation_id=`incident_traffic_violation`.`incident_traffic_violation_id`
where incident_id =@incident_id and incident_traffic_violation_id=$tra_id;
end loop;
close all_curs;
end BLOCK5 ;
end$$

DELIMITER ;

/* */

/* added by Alaa Sep. 14th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident` 
CHANGE COLUMN `is_deleted` `is_deleted` BIT(1) NULL DEFAULT 0 ;

/* */

/* added by Alaa Sep. 25th, 2017 */

USE `stellarhse_incident`;
DROP procedure IF EXISTS `incident_reload_data`;

DELIMITER $$
USE `stellarhse_incident`$$
CREATE PROCEDURE `incident_reload_data`($incident_number int,$org_id varchar(100))
begin
set @incident_id=(select incident_id from incident where incident_number=$incident_number and org_id=$org_id and  version_number=(select max(version_number) from incident where incident_number=$incident_number and org_id=$org_id));
SELECT 
    `inc`.incident_id,
    `inc`.event_type_id AS `report_type_id`,
    hev.`incident_event_type_name` AS `incident_type_name`,
    `inc`.`incident_date` AS `report_date`,
    `inc`.`incident_hour` AS `report_hour`,
    `inc`.`incident_minute` AS `report_min`,
    `inc`.`reporter_id`,
    CONCAT(e1.first_name, ' ', e1.last_name) AS reporter_name,
    `inc`.`rep_name`,
    inc.`rep_emp_id`,
    `inc`.`rep_crew`,
    `inc`.`rep_email`,
    `inc`.`rep_position`,
    `inc`.`rep_company`,
    `inc`.`rep_primary_phone`,
    `inc`.`rep_alternate_phone`,
    `inc`.`rep_supervisor`,
    `inc`.`location1_id`,
    `inc`.`location2_id`,
    `inc`.`location3_id`,
    `inc`.`location4_id`,
    `inc`.`other_location` AS `other_location`,
    `l1`.`location1_name`,
    `l2`.`location2_name`,
    `l3`.`location3_name`,
    `l4`.`location4_name`,
    `inc`.`crew_involved` AS crew_id,
    cr.crew_name AS crew_involved_name,
    `inc`.`operation_type_id`,
    `otn`.`operation_type_name` AS `operation_type_name`,
CASE `inc`.`is_emergency_response` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `is_emergency_response`,
    `inc`.`incident_description` AS `incident_description`,
    inc.`env_condition_note` AS `env_condition_note`,
    inc.`event_sequence`,
    `inc`.`should_work_stopped`,
    inc.`energy_form_note`,
    inc.`sub_standard_action_note`,
    inc.`sub_standard_condition_note`,
    inc.`under_lying_cause_note`,
     `inc`.`inv_status_id`,
    `inc`.`investigation_date`,
    `inc`.`investigator_id1`,
    `inc`.`investigator_name1`,
    `inc`.`investigator_id2`,
    `inc`.`investigator_name2`,
    `inc`.`investigator_id3`,
    `inc`.`investigator_name3`,
    `inc`.`investigation_summary`,
    `inc`.`investigation_follow_up_note`,
    `inc`.`investigation_response_cost`,
    `inc`.`investigation_repair_cost`,
    `inc`.`investigation_insurance_cost`,
    `inc`.`investigation_wcb_cost`,
    `inc`.`investigation_other_cost`,
    `inc`.`investigation_total_cost`,
    `inc`.`investigation_risk_of_recurrence_id`,
    `inc`.`investigation_severity_id`,
     group_concat(invs.inv_source_id)as inv_source_id ,
    `inc`.`investigation_source_details`,
    `inc`.`investigation_root_cause_note`,
    `inc`.`sign_off_investigator_id`,
    `inc`.`sign_off_investigator_name`,
    `inc`.`investigation_sign_off_date`,
    `inc`.`creator_id`,
    `inc`.`incident_number`,
    `inc`.`is_deleted`,
    `inc`.`last_update_date`,
    `inc`.`editing_by`,
    `inc`.`hide`,
    CONCAT(e2.first_name, ' ', e2.last_name) AS editing_by_name
FROM
    incident `inc`
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_incident`.`inc`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_incident`.`inc`.`editing_by`
        LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_incident`.`inc`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_incident`.`inc`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_incident`.`inc`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_incident`.`inc`.`location4_id`
        LEFT JOIN `stellarhse_incident`.`incident_event_type` `hev` ON `stellarhse_incident`.`inc`.`event_type_id` = hev.`incident_event_type_id`
        LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_incident`.`inc`.`operation_type_id`
        LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_incident`.`inc`.`crew_involved`
left join `incident_inv_source` invs on invs.incident_id=inc.incident_id
WHERE
    inc.incident_id = @incident_id;
SELECT 
    hth.third_party_id,
    tp.third_party_name,
    hth.job_number,
    hth.contact_name,
    tht.third_party_type_code
FROM incident_third_party hth
        LEFT JOIN stellarhse_common.third_party tp ON tp.third_party_id = hth.third_party_id
        LEFT JOIN stellarhse_common.third_party_type tht ON tp.third_party_type_id = tht.third_party_type_id
WHERE hth.incident_id = @incident_id;

select 
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from incident_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.incident_id=@incident_id;
  SELECT `stellarhse_incident`.`incident`.`incident_id` AS `incident_id`,
  
           (SELECT 
            hrl.risk_level_id
   FROM
(`stellarhse_common`.`risk_level` `rl`
JOIN `stellarhse_incident`.`incident_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
((`hrl`.`incident_id` = `stellarhse_incident`.`incident`.`incident_id`)
  AND (`rl`.`risk_level_key` = 'incident_exist'))) AS `incident_exist_id`,
           
           (SELECT 
            hrl.risk_level_id
            FROM
(`stellarhse_common`.`risk_level` `rl`
JOIN `stellarhse_incident`.`incident_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
((`hrl`.`incident_id` = `stellarhse_incident`.`incident`.`incident_id`)
AND (`rl`.`risk_level_key` = 'worker_exposure'))) AS `worker_exposure_id`,
            
            (SELECT 
            hrl.risk_level_id
            FROM
(`stellarhse_common`.`risk_level` `rl`
JOIN `stellarhse_incident`.`incident_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE ((`hrl`.`incident_id` = `stellarhse_incident`.`incident`.`incident_id`)
AND (`rl`.`risk_level_key` = 'potential_consequences'))) AS `potential_consequences_id`
    FROM
        `stellarhse_incident`.`incident`
        where incident_id =@incident_id;
    SELECT 
        `iev`.`incident_id` AS `incident_id`,
        `t`.`env_condition_name` AS `env_condition_type`,
`t`.`env_condition_id`  as env_condition_id,
GROUP_CONCAT(`iev`.`env_cond_parameter_id`  SEPARATOR ',') AS `env_condition_sub_type`
    FROM
        ((`stellarhse_incident`.`incident_env_cond` `iev`
        JOIN `stellarhse_incident`.`env_cond_parameter` `st` ON ((`st`.`env_cond_parameter_id` = `iev`.`env_cond_parameter_id`)))
        JOIN `stellarhse_incident`.`env_condition` `t` ON ((`t`.`env_condition_id` = `st`.`env_condition_id`)))
       -- JOIN `stellarhse_incident`.`incident` `inc` ON ((`inc`.`incident_id` = `iev`.`incident_id`)))
    WHERE
    incident_id=@incident_id 
       -- (`inc`.`is_deleted` = 0)
    GROUP BY `env_condition_type`
   -- ORDER BY `inc`.`incident_number`
  --  and iev.incident_id=@incident_id 
    ;
    
select oe_department_id from incident_oe_department where incident_id=@incident_id;
select `risk_control_id` from `stellarhse_incident`.`incident_risk_control`
WHERE  incident_id=@incident_id;
SELECT
    `hp`.`people_involved_id`,
    `hp`.`incident_id`,
    `hp`.`people_id`,
    `hp`.`third_party_id`,
   `hp`.`people_involved_name`,
    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',') 
    FROM
        `stellarhse_incident`.`incident_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
        
      (  SELECT 
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',') 
    FROM
        `stellarhse_incident`.`incident_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
        
FROM `stellarhse_incident`.`incident_people_involved` `hp`
 where hp.incident_id =@incident_id;
 -- corrective_action
  
  SELECT 
    `hc`.`incident_corrective_action_id` as corrective_action_id,
    `hc`.`incident_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_incident`.`incident_corrective_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id
where hc.incident_id=@incident_id and e.org_id = $org_id;



select `hc`.`incident_corrective_action_id` as corrective_action_id,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_incident`.`incident_corrective_action_notified` hcn
join  `stellarhse_incident`.`incident_corrective_action` hc on hc.incident_corrective_action_id = hcn.incident_corrective_action_id
join `stellarhse_incident`.`incident` h on h.incident_id = hc.incident_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.notified_id
WHERE h.incident_id=@incident_id and e.org_id = $org_id;

-- Scat Analysis
SELECT
`scat_analysis`.`scat_analysis_id`,
    `scat_analysis`.`incident_id`,
    `scat_analysis`.`type_of_energy_id` as `scat_items_params_id`,
      scp1.`scat_items_params_name` as type_of_energy_name ,
    `scat_analysis`.`immediate_cause_id` as `scat_direct_cause_id`,
       scp2.`scat_items_params_name` as immediate_cause_name,
    `scat_analysis`.`basic_cause_id` as `scat_basic_cause_id`,
       scp3.`scat_items_params_name`  as basic_cause_name,
    `scat_analysis`.`sub_cause_id` as `scat_sub_cause_id`,
       scp4.`scat_items_params_name` as sub_cause,
    `scat_analysis`.`immdeiate_cause_type` as `scatDirectCauseType`,
    `scat_analysis`.`basic_cause_type` as `scatBasicCauseType`,
    `scat_analysis`.`comment`,
    `scat_analysis`.`updated_date`
FROM `stellarhse_incident`.`scat_analysis`  
join scat_items_params scp1 on scp1.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
join scat_items_params scp2 on scp2.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
join scat_items_params scp3 on scp3.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
join scat_items_params scp4 on scp4.`scat_items_params_id`=  `scat_analysis`.`type_of_energy_id`
 where  `scat_analysis`.`incident_id`=@incident_id ;
 
 SELECT 
`inc_op`.`incident_id`,
`oa`.`observation_and_analysis_id` as main_type_id,
`oa`.`observation_and_analysis_code`,
(select parent_id from `observation_analysis_param` where observation_and_analysis_param_id=`inc_op`.`observation_and_analysis_param_id`) as parent_id,
(select observation_and_analysis_param_name from `observation_analysis_param` where observation_and_analysis_param_id =
(select parent_id from `observation_analysis_param` where observation_and_analysis_param_id=`inc_op`.`observation_and_analysis_param_id`)) as parent_name,
group_concat(`inc_op`.`observation_and_analysis_param_id`  separator ',')  as  sub_type
FROM `stellarhse_incident`.`incident_observation_analysis`  inc_op
join `observation_analysis_param` p on p.observation_and_analysis_param_id=inc_op.observation_and_analysis_param_id
join  `observation_analysis` oa on oa.`observation_and_analysis_id`=p.`observation_and_analysis_id`
group by incident_id,observation_and_analysis_code,parent_name
having incident_id=@incident_id 
order by observation_and_analysis_code;

select 
irc.incident_id,
if(rc.field_code is  null,rc.root_cause_name,rc.field_code) as cause_name,
rc.root_cause_id as root_cause_id,
group_concat(irc.root_cause_param_id) as root_cause_param_ids,
irc.other
from incident_root_cause  irc
left join root_cause_param  rcb  on rcb.root_cause_param_id=irc.root_cause_param_id
left join root_cause rc on rc.root_cause_id=rcb.root_cause_id
group by incident_id,root_cause_id
having incident_id=@incident_id;
end$$

DELIMITER ;

/* */

/* added by Alaa Sep. 27th, 2017 */

ALTER TABLE `stellarhse_incident`.`incident_third_party` 
CHANGE COLUMN `job_number` `jop_number` VARCHAR(255) NULL DEFAULT NULL ;

USE `stellarhse_incident`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    DEFINER = `devuser`@`%` 
    SQL SECURITY DEFINER
VIEW `stellarhse_incident`.`incident_third_party_detail_view` AS
    SELECT 
        `stellarhse_incident`.`incident`.`incident_id` AS `incident_id`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_common`.`third_party`.`third_party_id`
                        SEPARATOR ' ; ')
            FROM
                (`stellarhse_common`.`third_party`
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Customer')
                    AND `stellarhse_common`.`third_party`.`third_party_id` IN (SELECT 
                        `stellarhse_incident`.`incident_third_party`.`third_party_id`
                    FROM
                        `stellarhse_incident`.`incident_third_party`
                    WHERE
                        (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`)))) AS `customer_id`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_common`.`third_party`.`third_party_name`
                        SEPARATOR ' ; ')
            FROM
                (`stellarhse_common`.`third_party`
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Customer')
                    AND `stellarhse_common`.`third_party`.`third_party_id` IN (SELECT 
                        `stellarhse_incident`.`incident_third_party`.`third_party_id`
                    FROM
                        `stellarhse_incident`.`incident_third_party`
                    WHERE
                        (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`)))) AS `customer_name`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_incident`.`incident_third_party`.`contact_name`
                        SEPARATOR ' ; ')
            FROM
                ((`stellarhse_incident`.`incident_third_party`
                LEFT JOIN `stellarhse_common`.`third_party` ON ((`stellarhse_incident`.`incident_third_party`.`third_party_id` = `stellarhse_common`.`third_party`.`third_party_id`)))
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Customer')
                    AND (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`))) AS `cust_name`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_incident`.`incident_third_party`.`jop_number`
                        SEPARATOR ' ; ')
            FROM
                ((`stellarhse_incident`.`incident_third_party`
                LEFT JOIN `stellarhse_common`.`third_party` ON ((`stellarhse_incident`.`incident_third_party`.`third_party_id` = `stellarhse_common`.`third_party`.`third_party_id`)))
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Customer')
                    AND (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`))) AS `customer_job_number`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_common`.`third_party`.`third_party_id`
                        SEPARATOR ' ; ')
            FROM
                (`stellarhse_common`.`third_party`
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Contractor')
                    AND `stellarhse_common`.`third_party`.`third_party_id` IN (SELECT 
                        `stellarhse_incident`.`incident_third_party`.`third_party_id`
                    FROM
                        `stellarhse_incident`.`incident_third_party`
                    WHERE
                        (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`)))) AS `contractor_id`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_common`.`third_party`.`third_party_name`
                        SEPARATOR ' ; ')
            FROM
                (`stellarhse_common`.`third_party`
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Contractor')
                    AND `stellarhse_common`.`third_party`.`third_party_id` IN (SELECT 
                        `stellarhse_incident`.`incident_third_party`.`third_party_id`
                    FROM
                        `stellarhse_incident`.`incident_third_party`
                    WHERE
                        (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`)))) AS `Contractor_name`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_incident`.`incident_third_party`.`jop_number`
                        SEPARATOR ' ; ')
            FROM
                ((`stellarhse_incident`.`incident_third_party`
                LEFT JOIN `stellarhse_common`.`third_party` ON ((`stellarhse_incident`.`incident_third_party`.`third_party_id` = `stellarhse_common`.`third_party`.`third_party_id`)))
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Contractor')
                    AND (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`))) AS `contractor_job_number`,
        (SELECT 
                GROUP_CONCAT(`stellarhse_incident`.`incident_third_party`.`contact_name`
                        SEPARATOR ' ; ')
            FROM
                ((`stellarhse_incident`.`incident_third_party`
                LEFT JOIN `stellarhse_common`.`third_party` ON ((`stellarhse_incident`.`incident_third_party`.`third_party_id` = `stellarhse_common`.`third_party`.`third_party_id`)))
                LEFT JOIN `stellarhse_common`.`third_party_type` ON ((`stellarhse_common`.`third_party_type`.`third_party_type_id` = `stellarhse_common`.`third_party`.`third_party_type_id`)))
            WHERE
                ((`stellarhse_common`.`third_party_type`.`third_party_type_name` = 'Contractor')
                    AND (`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`))) AS `ContName`
    FROM
        (`stellarhse_incident`.`incident_third_party`
        JOIN `stellarhse_incident`.`incident` ON ((`stellarhse_incident`.`incident`.`incident_id` = `stellarhse_incident`.`incident_third_party`.`incident_id`)))
    GROUP BY `stellarhse_incident`.`incident_third_party`.`incident_id`;

USE `stellarhse_incident`;
CREATE 
     OR REPLACE ALGORITHM = UNDEFINED 
    DEFINER = `devuser`@`%` 
    SQL SECURITY DEFINER
VIEW `third_parties_involved_view` AS
    SELECT 
        `itp`.`incident_id` AS `incident_id`,
        `iev`.`incident_event_type_name` AS `event_type_name`,
        DATE_FORMAT(`inc`.`incident_date`, '%m/%d/%Y') AS `incident_date`,
        `inc`.`org_id` AS `org_id`,
        `inc`.`incident_number` AS `incident_number`,
        CONCAT(`e1`.`first_name`, ' ', `e1`.`last_name`) AS `creator_name`,
        `tp`.`third_party_name` AS `third_party_name`,
        `tpt`.`third_party_type_name` AS `third_party_type_name`,
        `itp`.`jop_number` AS `job_number`,
        `itp`.`contact_name` AS `contact_name`,
        `inc`.`rep_name` AS `rep_name`,
        `inc`.`rep_email` AS `rep_email`,
        `inc`.`rep_position` AS `rep_position`,
        `inc`.`rep_company` AS `rep_company`,
        `inc`.`rep_crew` AS `rep_crew`,
        `inc`.`rep_primary_phone` AS `rep_primary_phone`,
        `inc`.`rep_alternate_phone` AS `rep_alternate_phone`,
        `inc`.`rep_supervisor` AS `supervisor`,
        `l1`.`location1_name` AS `country`,
        `l2`.`location2_name` AS `state`,
        `l3`.`location3_name` AS `city`,
        `l4`.`location4_name` AS `community`,
        `inc`.`other_location` AS `other_location`,
        `inc`.`incident_description` AS `incident_description`,
        `ipiv`.`how_he_involved` AS `how_he_involved`,
        `ircv`.`risk_control` AS `risk_control`,
        `irlv`.`Probability_of_hazard_exists` AS `Probability_of_hazard_exists`,
        `irlv`.`Probability_of_worker_exposure` AS `Probability_of_worker_exposure`,
        `irlv`.`Probability_of_potential_consequences` AS `Probability_of_potential_consequences`,
        `irlv`.`total_risk_level_value` AS `total_risk_level_value`
    FROM
        ((((((((((((`stellarhse_incident`.`incident_third_party` `itp`
        JOIN `stellarhse_incident`.`incident_tbl_vw` `inc` ON ((`inc`.`incident_id` = `itp`.`incident_id`)))
        LEFT JOIN `stellarhse_common`.`third_party` `tp` ON ((`tp`.`third_party_id` = `itp`.`third_party_id`)))
        LEFT JOIN `stellarhse_common`.`third_party_type` `tpt` ON ((`tpt`.`third_party_type_id` = `tp`.`third_party_type_id`)))
        LEFT JOIN `stellarhse_incident`.`incident_event_type` `iev` ON ((`iev`.`incident_event_type_id` = `inc`.`event_type_id`)))
        LEFT JOIN `stellarhse_common`.`location1` `l1` ON ((`l1`.`location1_id` = `inc`.`location1_id`)))
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON ((`l2`.`location2_id` = `inc`.`location2_id`)))
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON ((`l3`.`location3_id` = `inc`.`location3_id`)))
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON ((`l4`.`location4_id` = `inc`.`location4_id`)))
        LEFT JOIN `stellarhse_incident`.`incident_people_involved_view` `ipiv` ON (((`ipiv`.`incident_id` = `inc`.`incident_id`)
            AND (`ipiv`.`third_party_id` = `itp`.`third_party_id`))))
        LEFT JOIN `stellarhse_incident`.`incident_risk_level_view` `irlv` ON ((`irlv`.`incident_id` = `inc`.`incident_id`)))
        LEFT JOIN `stellarhse_incident`.`incident_risk_control_view` `ircv` ON ((`ircv`.`incident_id` = `inc`.`incident_id`)))
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON ((`e1`.`employee_id` = `inc`.`reporter_id`)))
    WHERE
        (`inc`.`is_deleted` = 0)
    ORDER BY `inc`.`incident_number`;

-----------------
USE `stellarhse_inspection`;
DROP procedure IF EXISTS `ins_reload_data`;

DELIMITER $$
USE `stellarhse_inspection`$$
CREATE DEFINER=`devuser`@`%` PROCEDURE `ins_reload_data`($inspection_number int,$org_id varchar(100))
begin
set @inspection_id=(select inspection_id from inspection where inspection_number=$inspection_number and org_id=$org_id and  version_number=(select max(version_number) from inspection where inspection_number=$inspection_number and org_id=$org_id));
select 
h.inspection_type_id as `report_type_id`,
hev.`inspection_type_name`,
h.`inspection_date` as `report_date`,
h.`inspection_hour` as `report_hour`,
h.`inspection_min` as `report_min`,
`h`.`reporter_id`,
`h`.`inspection_reason_id` as `inspection_reason_id`,
`h`.`inspection_description` as `inspection_description`,
concat(e1.first_name,' ',e1.last_name) as reporter_name,
`h`.`rep_name`,
`h`.`rep_crew`,
`h`.`rep_email`,
`h`.`rep_position`,
`h`.`rep_company`,
`h`.`rep_emp_id`, 
`h`.`rep_primary_phone` ,
`h`.`rep_alternate_phone` ,
`h`.`rep_supervisor` as `rep_supervisor`,
`h`.`location1_id`,
`h`.`location2_id`,
`h`.`location3_id`,
`h`.`location4_id`,
`l1`.`location1_name`,
`l2`.`location2_name`,
`l3`.`location3_name`,
`l4`.`location4_name`,
`h`.`crew_involved` as crew_id,
cr.crew_name as crew_involved_name,
`h`.`operation_type_id`,
`otn`.`operation_type_name` AS `operation_type_name`,
`h`.`hazard_description` as `report_description`, 
`h`.`hazard_suspected_cause` as `report_suspected_cause`,
`h`.`initial_action_token`,
`h`.`inspection_status_id` as `inspection_status_id`,
`hs`.`status_Name` AS `status`,
`h`.`are_additional_corrective_actions_required`,
`h`.`recommended_corrective_actions_summary`,
`h`.`potential_impacts_desc`,
`h`.`should_work_stopped`,
`h`.`creator_id`,
`h`.`inspection_number`,
`h`.`hazard_note`,
`h`.`hazard_cause_note`,
`h`.`inspection_other_location` as `other_location`,
`h`.`is_deleted`,
`h`.`last_update_date`,
`h`.`editing_by`,
`h`.`hide`,
concat(e2.first_name,' ',e2.last_name) as editing_by_name
from inspection  h 
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_inspection`.`h`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_inspection`.`h`.`editing_by`
LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_inspection`.`h`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_inspection`.`h`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_inspection`.`h`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_inspection`.`h`.`location4_id`
LEFT JOIN `stellarhse_inspection`.`inspection_event_type` `hev` ON `hev`.`inspection_type_id` = `stellarhse_inspection`.`h`.`inspection_type_id`
LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_inspection`.`h`.`operation_type_id`
LEFT JOIN `stellarhse_common`.`status` `hs` ON `hs`.`status_id` = `stellarhse_inspection`.`h`.`inspection_status_id`
        LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_inspection`.`h`.`crew_involved`
where inspection_id=@inspection_id;
select 
hth.third_party_id,
tp.third_party_name,
hth.jop_number,
hth.contact_name,
tht.third_party_type_code
from inspection_third_party hth
left join stellarhse_common.third_party  tp on tp.third_party_id=hth.third_party_id 
left join stellarhse_common.third_party_type tht on tp.third_party_type_id = tht.third_party_type_id where hth.inspection_id=@inspection_id;
select 
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from inspection_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.inspection_id=@inspection_id;
SELECT hi.impact_type_id
FROM`stellarhse_inspection`.`inspection_impact` `hi`
where inspection_id=@inspection_id;
 -- risk_level   
  SELECT `stellarhse_inspection`.`inspection`.`inspection_id` AS `inspection_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_inspection`.`inspection_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`inspection_id` = `stellarhse_inspection`.`inspection`.`inspection_id`)
                    AND (`rl`.`risk_level_key` = 'hazard_exist'))) AS `hazard_exist_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_inspection`.`inspection_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`inspection_id` = `stellarhse_inspection`.`inspection`.`inspection_id`)
                    AND (`rl`.`risk_level_key` = 'worker_exposure'))) AS `worker_exposure_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_inspection`.`inspection_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`inspection_id` = `stellarhse_inspection`.`inspection`.`inspection_id`)
                    AND (`rl`.`risk_level_key` = 'potential_consequences'))) AS `potential_consequences_id`
    FROM
        `stellarhse_inspection`.`inspection`
    
        where inspection_id =@inspection_id;
        select `risk_control_id` from `stellarhse_inspection`.`inspection_risk_control`
       WHERE  inspection_id=@inspection_id;
  -- inspection_details_tab     
     select * from hazard_details_view where inspection_id=@inspection_id;
SELECT
    `hp`.`people_involved_id`,
    `hp`.`inspection_id`,
    `hp`.`people_id`,
    `hp`.`third_party_id`,
    `hp`.`people_involved_name`,
--     IF(`hp`.`people_id` is not null,`e`.`full_name`,`tp`.`contact_name`) AS `people_involved_name`,    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',') 
    FROM
        `stellarhse_inspection`.`inspection_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
        
      (  SELECT 
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',') 
    FROM
        `stellarhse_inspection`.`inspection_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
        
FROM `stellarhse_inspection`.`inspection_people_involved` `hp`
left join stellarhse_auth.get_user_info e on  e.employee_id = hp.people_id
left join stellarhse_common.third_party tp on tp.third_party_id = hp.third_party_id 
 where hp.inspection_id =@inspection_id;
  -- corrective_action
  
  SELECT 
    `hc`.`inspection_corrective_action_id` as `corrective_action_id`,
    `hc`.`inspection_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_inspection`.`inspection_corrective_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id and e.org_id = $org_id
where hc.inspection_id=@inspection_id;
select `hc`.`inspection_corrective_action_id` as `corrective_action_id`,hcn.`notified_id` as `employee_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_inspection`.`inspection_corrective_action_notified` hcn
join  `stellarhse_inspection`.`inspection_corrective_action` hc on hc.inspection_corrective_action_id = hcn.inspection_corrective_action_id
join `stellarhse_inspection`.`inspection` h on h.inspection_id = hc.inspection_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.notified_id
WHERE h.inspection_id=@inspection_id and e.org_id = $org_id;

end$$

DELIMITER ;


/* */

/* added by Alaa Oct. 2nd, 2017 */

UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_event_type', `table_field_name`='haz_type_name' WHERE `field_id`='dev5-c37c3fd9-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_description`='Type of hazard', `default_help_me_name`='What is the hazard type?', `default_help_me_description`='The incident type is an action, occurrence or condition that starts a chain reaction of results. For example, a severe weather event may trigger the collapse of a building that then causes damage to its contents or injuries to occupants. Choose the one that best matches the hazard you are reporting. ' WHERE `field_id`='dev5-c37c3fd9-67a7-11e7-8bbe-74e6e2020496';

/* */

/* added by Alaa Oct. 9th, 2017 */

UPDATE `stellarhse_hazard`.`field` SET `field_name`='hour' WHERE `field_id`='dev5-c38b91a9-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='crew_involved' WHERE `field_id`='dev5-21db03f8-6b91-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='contractor_jop_number' WHERE `field_id`='dev5-c38b8747-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='contractor_id' WHERE `field_id`='dev5-c38b83a6-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='contractor_contact_name' WHERE `field_id`='dev5-c38b534c-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='customer_contact_name' WHERE `field_id`='dev5-c38b5950-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='initial_action_taken' WHERE `field_id`='dev5-c38b7a4f-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='potential_impacts_description' WHERE `field_id`='dev5-c38baa47-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='frequency_of_worker_exposure' WHERE `field_id`='dev5-22b732e1-67b3-11e7-8bbe-74e6e2020496';

/* */

/* added by Alaa Oct. 10th, 2017 */

UPDATE `stellarhse_hazard`.`field` SET `field_name`='people_involved_supervisor' WHERE `field_id`='dev5-e5f419a6-6aca-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='corrective_action_supervisor' WHERE `field_id`='dev5-10f7405a-6ad2-11e7-8bbe-74e6e2020496';
INSERT INTO `stellarhse_hazard`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-10f7405a-6ad2-11e7-8bbe-74e6e2020496', 'Supervisor:', 0, 0);

/* */

/* added by Alaa Oct. 11th, 2017 */

INSERT INTO `stellarhse_hazard`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-df148453-aea1-11e7-8deb-00505621a9ce', 'Notify supervisor', 0, 0);
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_auth.crew', `table_field_name`='crew_name', `field_key`='crew_id' WHERE `field_id`='dev5-21db03f8-6b91-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_field_name`='status_Name' WHERE `field_id`='dev5-c38b6b3c-67a7-11e7-8bbe-74e6e2020496';
ALTER TABLE `stellarhse_common`.`status` 
CHANGE COLUMN `status_Name` `status_Name` VARCHAR(100) NOT NULL ;
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.impact_type', `table_field_name`='impact_type_name', `field_key`='impact_type_id' WHERE `field_id`='dev5-c38bb31e-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `field_name`='severity_of_potential_consequences' WHERE `field_id`='dev5-22b73348-67b3-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.risk_level', `table_field_name`='risk_level_degree', `field_key`='risk_level_id' WHERE `field_id`='dev5-22b73348-67b3-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.risk_level', `table_field_name`='risk_level_degree', `field_key`='risk_level_id' WHERE `field_id`='dev5-22b732e1-67b3-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.risk_level', `table_field_name`='risk_level_degree', `field_key`='risk_level_id' WHERE `field_id`='dev5-c38b7c36-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.effects_type', `table_field_name`='effects_type_name', `field_key`='effects_type_id' WHERE `field_id`='dev5-47b3a556-6be3-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.cause_types', `table_field_name`='cause_types_name', `field_key`='cause_types_id' WHERE `field_id`='dev5-47bb88cc-6be3-11e7-8bbe-74e6e2020496';

/* */

/* added by Alaa Oct. 17th, 2017 */

INSERT INTO `stellarhse_inspection`.`field` (`field_id`,`field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_editable`, `field_type_id`, `sub_tab_id`, `table_name`, `table_field_name`, `field_key`, `is_hidden`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES (myuuid(),'reason_for_inspection', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Reason for inspection:', 0, 1, 'cs4sql-28cc9ed9-dc5c-11e4-b362-5254000a52fa', 'dev5-b65fb949-6c64-11e7-8bbe-74e6e2020496', 'inspection_reason', 'inspection_reason_name', 'inspection_reason_id', 0, '0', 0, 0, 0);
INSERT INTO `stellarhse_inspection`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-a5f9f116-b3a7-11e7-bc74-00505621a9ce', 'Reason for inspection:', 0, 0);
UPDATE `stellarhse_inspection`.`field` SET `field_name`='type_and_subtype' WHERE `field_id`='dev5-75f5b3bb-6c6d-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='cause_types_and_subtypes' WHERE `field_id`='dev5-75fa7782-6c6d-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `default_field_label`='Inspection Type:' WHERE `field_id`='dev5-e89b8dbf-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`org_field` SET `field_label`='Inspection Type:' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-e89b8dbf-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `default_field_label`='Inspection Time:' WHERE `field_id`='dev5-e897add1-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`org_field` SET `field_label`='Inspection Time:' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-e897add1-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='hour' WHERE `field_id`='dev5-e89e3392-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='min' WHERE `field_id`='dev5-e89e35c7-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `is_editable`=1 WHERE `field_id`='dev5-e89e35c7-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='identified_by' WHERE `field_id`='dev5-e89bad0f-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='other_location' WHERE `field_id`='dev5-e89bb806-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='crew_involved' WHERE `field_id`='dev5-e89b8697-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='contractor_id' WHERE `field_id`='dev5-e89e21cb-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='contractor_jop_number' WHERE `field_id`='dev5-e89e273e-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='contractor_contact_name' WHERE `field_id`='dev5-e89b9ccd-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='customer_contact_name' WHERE `field_id`='dev5-e89ba079-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='customer_jop_number', `default_field_label`='Customer\'s jop #:' WHERE `field_id`='dev5-e89e2514-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='customer_job_number' WHERE `field_id`='dev5-e89e2514-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='initial_action_taken' WHERE `field_id`='dev5-e89bbf9a-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='status_id' WHERE `field_id`='dev5-e89bb26f-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='potential_impacts_description' WHERE `field_id`='dev5-e89e43e9-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `is_hidden`=0 WHERE `field_id`='dev5-e8c08995-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`org_field` SET `is_hidden`=0 WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-e8c08995-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='risk_level' WHERE `field_id`='dev5-e89e2d51-6c68-11e7-8bbe-74e6e2020496';
INSERT INTO `stellarhse_inspection`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-75ba07fc-aea9-11e7-8d63-74e6e2020496', 'Notify supervisor :', 0, 0);
UPDATE `stellarhse_inspection`.`field` SET `field_name`='frequency_of_worker_exposure' WHERE `field_id`='dev5-e89b89b3-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='severity_of_potential_consequences' WHERE `field_id`='dev5-e89b8bc3-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='stellarhse_common.cause_types', `table_field_name`='cause_types_name', `field_key`='cause_types_id' WHERE `field_id`='dev5-75fa7782-6c6d-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='stellarhse_common.effects_type', `table_field_name`='effects_type_name', `field_key`='effects_type_id' WHERE `field_id`='dev5-75f5b3bb-6c6d-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `field_name`='inspection_reason_id' WHERE `field_id`='debian-a5f9f116-b3a7-11e7-bc74-00505621a9ce';

/* */

/* added by Alaa Oct. 18th, 2017 */

UPDATE `stellarhse_safetymeeting`.`field` SET `field_name`='customer_job_number' WHERE `field_id`='dev5-9c7e8785-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `field_name`='identified_by' WHERE `field_id`='dev5-9c7e587e-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `field_name`='crew_involved' WHERE `field_id`='dev5-9c7e2dc1-6f28-11e7-8bbe-74e6e2020496';
INSERT INTO `stellarhse_safetymeeting`.`field` (`field_id`,`field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_editable`, `field_type_id`, `sub_tab_id`, `is_hidden`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES (MyUUID(),'time', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Meeting Time:', 0, 1, 'cs4sql-28dd5b30-dc5c-11e4-b362-5254000a52fa', 'dev5-37475f0f-6c66-11e7-8bbe-74e6e2020496', 0, '0', 0, 0, 0);
INSERT INTO `stellarhse_safetymeeting`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-143a87c5-b428-11e7-a5e5-00505621a9ce', 'Meeting Time:', 0, 0);
UPDATE `stellarhse_safetymeeting`.`field` SET `table_field_name`='safetymeeting_type_name' WHERE `field_id`='dev5-9c7e3e55-6f28-11e7-8bbe-74e6e2020496';
INSERT INTO `stellarhse_safetymeeting`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-fe0e4835-6f28-11e7-8bbe-74e6e2020496', 'Supervisor:', 0, 0);
INSERT INTO `stellarhse_safetymeeting`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-9fe413d3-6f2a-11e7-8bbe-74e6e2020496', 'Notify supervisor', 0, 0);

UPDATE `stellarhse_maintenance`.`field` SET `field_name`='facility_location_last_maintenance' WHERE `field_id`='dev5-0e3d48cf-ad25-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `field_name`='identified_by' WHERE `field_id`='dev5-93f52dd9-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `field_name`='description' WHERE `field_id`='dev5-93d30798-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `field_name`='min' WHERE `field_id`='dev5-93f5625e-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `field_name`='date' WHERE `field_id`='dev5-93f54da9-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `field_name`='customer_job_number' WHERE `field_id`='dev5-93f55694-acfc-11e7-8d63-74e6e2020496';
INSERT INTO `stellarhse_maintenance`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-2c7787ac-acfd-11e7-8d63-74e6e2020496', 'Supervisor:', 0, 0);

/* */

/* added by Alaa Oct. 19th, 2017 */

INSERT INTO `stellarhse_training`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-b9c828f4-ad78-11e7-8d63-74e6e2020496', 'Supervisor:', 0, 0);
UPDATE `stellarhse_training`.`field` SET `field_name`='identified_by' WHERE `field_id`='dev5-3bee305c-ad7e-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_name' WHERE `field_id`='dev5-837ee7d3-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='date' WHERE `field_id`='dev5-837eb86f-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_id' WHERE `field_id`='dev5-837e616a-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_crew' WHERE `field_id`='dev5-837e65d8-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_supervisor' WHERE `field_id`='dev5-837e68ca-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_primary_phone' WHERE `field_id`='dev5-837e83a7-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_alternate_phone' WHERE `field_id`='dev5-837e893a-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_position' WHERE `field_id`='dev5-837ee9bf-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_email' WHERE `field_id`='dev5-837eebac-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='rep_company' WHERE `field_id`='dev5-837eedbd-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='identified_by' WHERE `field_id`='dev5-837ea148-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='training_provided_by' WHERE `field_id`='dev5-3bee305c-ad7e-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='staff_member_id' WHERE `field_id`='dev5-3bff8d49-ad7e-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='address' WHERE `field_id`='dev5-3c260426-ad7e-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='contact_name', `default_field_label`='Contact Name' WHERE `field_id`='dev5-837ea71d-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`org_field` SET `field_label`='Contact Name', `help_me_name`='Contact Name' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-837ea71d-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `field_name`='training_comments' WHERE `field_id`='dev5-b8d78a6e-ad83-11e7-8d63-74e6e2020496';

/* */

/* added by Alaa Oct. 22nd, 2017 */

UPDATE `stellarhse_incident`.`field` SET `field_name`='date' WHERE `field_id`='cs4sql-275d61d5-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='time' WHERE `field_id`='cs4sql-2796b968-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='hour', `is_editable`=1, `field_type_id`='cs4sql-28dc4f93-dc5c-11e4-b362-5254000a52fa', `sub_tab_id`='cs4sql-dca40360-dc5a-11e4-b362-5254000a52fa' WHERE `field_id`='cs4sql-d279dee3-2b6b-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='min', `is_editable`=1, `field_type_id`='cs4sql-28dc4f93-dc5c-11e4-b362-5254000a52fa', `sub_tab_id`='cs4sql-dca40360-dc5a-11e4-b362-5254000a52fa' WHERE `field_id`='cs4sql-d2a3c538-2b6b-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='identified_by' WHERE `field_id`='cs4sql-26bd63ad-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='location' WHERE `field_id`='cs4sql-272252f6-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='description' WHERE `field_id`='cs4sql-28bcd146-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='third_parties_involved' WHERE `field_id`='cs4sql-28ba8d15-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='contractor_jop_number' WHERE `field_id`='cs4sql-2769cd76-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='contractor_contact_name' WHERE `field_id`='cs4sql-266e1bf9-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='customer_contact_name' WHERE `field_id`='cs4sql-266f86a1-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='probability_of_hazard' WHERE `field_id`='dev5-237f5d16-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `field_name`='estimated_cost' WHERE `field_id`='cs4sql-26668b52-dc5c-11e4-b362-5254000a52fa';

insert into stellarhse_incident.field values
(myuuid(), 'rep_supervisor', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Supervisor :', NULL, 0, 1, 'cs4sql-28cc9ed9-dc5c-11e4-b362-5254000a52fa', 'cs4sql-dca40360-dc5a-11e4-b362-5254000a52fa', '', '', NULL, NULL, ' ', '', '', 0, '4.02', NULL, '2017-07-18 03:19:34', NULL, 0, 1, 'Don\'t want a help pop-up for this field? Simply delete any help content form the Help content field below and click Submit.', 0, 0);
insert into stellarhse_incident.field values
(myuuid(), 'rep_id', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'ID:', NULL, 0, 1, 'cs4sql-28cc9ed9-dc5c-11e4-b362-5254000a52fa', 'cs4sql-dca40360-dc5a-11e4-b362-5254000a52fa', '', '', NULL, NULL, ' ', '', '', 0, '4.02', NULL, '2017-07-18 03:19:34', NULL, 0, 1, 'Don\'t want a help pop-up for this field? Simply delete any help content form the Help content field below and click Submit.', 0, 0);
insert into stellarhse_incident.field values
(myuuid(), 'risk_control_id', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Risk controls required', NULL, 0, 1, 'cs4sql-28cc9ed9-dc5c-11e4-b362-5254000a52fa', 'cs4sql-dca40360-dc5a-11e4-b362-5254000a52fa', '', '', NULL, NULL, ' ', '', '', 0, '4.02', NULL, '2017-07-18 03:19:34', NULL, 0, 1, 'Don\'t want a help pop-up for this field? Simply delete any help content form the Help content field below and click Submit.', 0, 0);
insert into stellarhse_incident.field values
(myuuid(), 'notified_id', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Also notified:', NULL, 0, 1, 'cs4sql-28cc9ed9-dc5c-11e4-b362-5254000a52fa', 'cs4sql-dca5a53e-dc5a-11e4-b362-5254000a52fa', '', '', NULL, NULL, ' ', '', '', 0, '4.02', NULL, '2017-07-18 03:19:34', NULL, 0, 1, 'Don\'t want a help pop-up for this field? Simply delete any help content form the Help content field below and click Submit.', 0, 0);
insert into stellarhse_incident.field values
(myuuid(), 'actual_cost', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Actual cost:', NULL, 0, 1, 'cs4sql-28cc9ed9-dc5c-11e4-b362-5254000a52fa', 'cs4sql-dca5a53e-dc5a-11e4-b362-5254000a52fa', '', '', NULL, NULL, ' ', '', '', 0, '4.02', NULL, '2017-07-18 03:19:34', NULL, 0, 1, 'Don\'t want a help pop-up for this field? Simply delete any help content form the Help content field below and click Submit.', 0, 0);

UPDATE `stellarhse_incident`.`field` SET `field_name`='substandard_actions' WHERE `field_id`='cs4sql-2670f38a-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='substandard_actions_note' WHERE `field_id`='cs4sql-28b63611-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='substandard_conditions' WHERE `field_id`='cs4sql-267400c5-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='substandard_conditions_note' WHERE `field_id`='cs4sql-262260d0-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='underlying_cause_note' WHERE `field_id`='cs4sql-2626403a-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='underlying_causes_title' WHERE `field_id`='cs4sql-26244e5f-dc5c-11e4-b362-5254000a52fa';

/* */

/* added by Alaa Oct. 23rd, 2017 */

UPDATE `stellarhse_incident`.`field` SET `field_name`='acting_id' WHERE `field_id`='dev5-8631b0a0-ae3d-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_auth.crew', `table_field_name`='crew_name', `field_key`='crew_id' WHERE `field_id`='debian-8e182259-b772-11e7-9421-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.risk_control', `table_field_name`='risk_control_name', `field_key`='risk_control_id' WHERE `field_id`='debian-fe80dd4f-b784-11e7-9421-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_name`='env_condition', `table_field_name`='env_condition_name', `field_key`='env_condition_id' WHERE `field_id`='cs4sql-276b990e-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_auth.oe_department' WHERE `field_id`='cs4sql-27524629-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `table_field_name`='observation_and_analysis_param_name', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-28b243b7-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='investigation_costs' WHERE `field_id`='cs4sql-26a79b10-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='investigation_source_details' WHERE `field_id`='cs4sql-2648d313-dc5c-11e4-b362-5254000a52fa';
insert into stellarhse_incident.field values
(myuuid(), 'investigators', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Investigators', NULL, 0, 1, 'cs4sql-28da2581-dc5c-11e4-b362-5254000a52fa', 'cs4sql-dca40360-dc5a-11e4-b362-5254000a52fa', '', '', NULL, NULL, ' ', '', '', 0, '4.02', NULL, '2017-07-18 03:19:34', NULL, 0, 1, 'Don\'t want a help pop-up for this field? Simply delete any help content form the Help content field below and click Submit.', 0, 0);

UPDATE `stellarhse_incident`.`field` SET `field_name`='root_cause_id', `table_name`='root_cause', `table_field_name`='root_cause_name', `field_key`='root_cause_id' WHERE `field_id`='cs4sql-278061cb-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='internal_individuals', `is_custom`=0 WHERE `field_id`='cs4sql-28b85c0d-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='initial_department_id1' WHERE `field_id`='cs4sql-2793304f-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='initial_department_id2' WHERE `field_id`='cs4sql-2794f132-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='initial_department_id3' WHERE `field_id`='cs4sql-27987969-dc5c-11e4-b362-5254000a52fa';

/* */

/* added by Alaa Oct. 25th, 2017 */

UPDATE `stellarhse_incident`.`field` SET `field_name`='traffic_details' WHERE `field_id`='cs4sql-289324e1-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='vehicle_type', `table_field_name`='vehicle_type_name', `field_key`='vehicle_type_id' WHERE `field_id`='cs4sql-288dc944-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='vehicle_type', `table_field_name`='vehicle_type_name', `field_key`='vehicle_type_id' WHERE `field_id`='cs4sql-288342ef-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `default_field_label`='' WHERE `field_id`='cs4sql-2859f48e-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `default_field_label`='Duration of spill/release unit:' WHERE `field_id`='cs4sql-2858306c-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `default_field_label`='Quantity spilled/release unit:' WHERE `field_id`='cs4sql-285bad93-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `default_field_label`='' WHERE `field_id`='cs4sql-285d6af4-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='how_did_spill_occur' WHERE `field_id`='cs4sql-28647c4b-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='spill_reported_to' WHERE `field_id`='cs4sql-287d8351-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `default_field_label`='' WHERE `field_id`='cs4sql-28610e48-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='spill_release_source', `table_field_name`='spill_release_source_name', `field_key`='spill_release_source_id' WHERE `field_id`='cs4sql-28566926-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='quantity_unit', `table_field_name`='quantity_unit_name', `field_key`='quantity_unit_id' WHERE `field_id`='cs4sql-285d6af4-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='duration_unit', `table_field_name`='duration_unit_name', `field_key`='duration_unit_id' WHERE `field_id`='cs4sql-2859f48e-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='quantity_unit', `table_field_name`='quantity_unit_name', `field_key`='quantity_unit_id' WHERE `field_id`='cs4sql-28610e48-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='spill_release_agency', `table_field_name`='spill_release_agency_name', `field_key`='spill_release_agency_id' WHERE `field_id`='cs4sql-287d8351-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_personal_afflicted' WHERE `field_id`='cs4sql-283584e2-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_initial_treatment_id' WHERE `field_id`='cs4sql-2733550c-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_contact_agency_id' WHERE `field_id`='cs4sql-27a9924c-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_lost_time_start' WHERE `field_id`='cs4sql-284fe9e6-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_lost_time_end' WHERE `field_id`='cs4sql-283200a9-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_adjustment_days' WHERE `field_id`='cs4sql-2852285d-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='injury_total_days_off' WHERE `field_id`='cs4sql-2833d173-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='contact_agency', `table_field_name`='contact_agency_name', `field_key`='contact_agency_id' WHERE `field_id`='cs4sql-27a9924c-dc5c-11e4-b362-5254000a52fa';

UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `table_field_name`='observation_and_analysis_param_name', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-267400c5-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `table_field_name`='observation_and_analysis_param_name', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-2670f38a-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-26244e5f-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='immediate_cause_type', `default_field_label`='immediate cause type' WHERE `field_id`='debian-3c08247a-bcc6-11e7-a55b-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `field_name`='cause_comments' WHERE `field_id`='debian-3c0c4888-bcc6-11e7-a55b-00505621a9ce';

/* */

/* added by Alaa Nov. 13th, 2017 */

USE `stellarhse_incident`;
DROP procedure IF EXISTS `get_assign_notifications`;

DELIMITER $$
USE `stellarhse_incident`$$
CREATE PROCEDURE `get_assign_notifications`(xmlData text   charset utf8)
BEGIN
SET @org_id = extractvalue(xmlData, '//org_id');
SET @page = extractvalue(xmlData, '//page');
SET @sortOrder =  extractvalue(xmlData, '//sortOrder');
SET @index =  extractvalue(xmlData, '//index');
set @selectquery1 ='
SELECT  
SQL_CALC_FOUND_ROWS
email_to_id, 
group_id, 
employee_id, 
employee_name, 
-- GROUP_CONCAT(DISTINCT last_sent_date SEPARATOR \', \') AS last_sent_date,
position, 
group_name, 
email_type_name AS email_type_name, 
GROUP_CONCAT(DISTINCT assigned_notifications SEPARATOR \', \') AS assigned_notifications, 
GROUP_CONCAT(DISTINCT days_start SEPARATOR \', \') AS days_start, 
GROUP_CONCAT(DISTINCT days_freq SEPARATOR \', \') AS days_freq,  
GROUP_CONCAT(DISTINCT days_start_inc SEPARATOR \', \') AS days_start_inc, 
GROUP_CONCAT(DISTINCT days_freq_inc SEPARATOR \', \') AS days_freq_inc,
last_sent_date
FROM
(      
SELECT 
        `eto`.`email_to_id` AS `email_to_id`,
        `eto`.`group_id` AS `group_id`,
        `eto`.`employee_id` AS `employee_id`, 
        CONCAT(`e`.`first_name`,  ''  '' , `e`.`last_name`) AS `employee_name`,
        -- Null as last_sent_date,
        `e`.`position` AS `position`,
        `g`.`group_name` AS `group_name`,
        group_CONCAT(distinct `et`.`email_type_name`
            separator '', '') AS `email_type_name`,
        `eto`.`org_id` AS `org_id`,
        get_assign_notifications_fun(`eto`.`employee_id`,
                `eto`.`group_id`,
                `eto`.`org_id`) AS `assigned_notifications`,
        NULL AS `days_start`,
        NULL AS `days_freq`,
        NULL AS `days_start_inc`,
        NULL AS `days_freq_inc`,
`last_sent_date_fun`(`eto`.`employee_id`, `eto`.`group_id`) AS last_sent_date ';
                
set @selectquery2 ='
  UNION ALL SELECT
        `etoesc`.`email_to_esc_id` AS `email_to_id`,
        `etoesc`.`group_id` AS `group_id`,
        `etoesc`.`employee_id` AS `employee_id`,
        CONCAT(`e`.`first_name`, ''  '' , `e`.`last_name`) AS `employee_name`,
         -- `etoesc`.`last_sent_date` as `last_sent_date`,
        `e`.`position` AS `position`,
        `g`.`group_name` AS `group_name`,
        NULL AS `email_type_name`,
        `etoesc`.`org_id` AS `org_id`,
        esc_email_only(`etoesc`.`employee_id`,
                `etoesc`.`group_id`,
                `etoesc`.`org_id`) AS `assigned_notifications`,
        email_to_fun(`etoesc`.`org_id`,
                `etoesc`.`group_id`,
                `etoesc`.`employee_id`,
                1,
                \'corrective_action\') AS `days_start`,
        email_to_fun(`etoesc`.`org_id`,
                `etoesc`.`group_id`,
                `etoesc`.`employee_id`,
                2,
                \'corrective_action\') AS `days_freq`,
        email_to_fun(`etoesc`.`org_id`,
                `etoesc`.`group_id`,
                `etoesc`.`employee_id`,
                1,
                \'incident\') AS `days_start_inc`,
        email_to_fun(`etoesc`.`org_id`,
                `etoesc`.`group_id`,
                `etoesc`.`employee_id`,
                2,
                \'incident\') AS `days_freq_inc`,
		`last_sent_date_fun`(`etoesc`.`employee_id`, `etoesc`.`group_id`) AS last_sent_date ';
-- SELECT @selectquery1, @selectquery2;
set @queryFrom1 = CONCAT('    from
        ((((`email_to` `eto`
        left join `email_to_esc` `etoesc` ON (((`eto`.`org_id` = `etoesc`.`org_id`)
            and (`eto`.`employee_id` = `etoesc`.`employee_id`)
            and (`eto`.`group_id` = `etoesc`.`group_id`))))
        left join stellarhse_auth.`employee` `e` ON ((`eto`.`employee_id` = `e`.`employee_id`)))
        join stellarhse_common.`email_type` `et` ON ((`et`.`email_type_id` = `eto`.`email_type_id`)))
        left join stellarhse_auth.`group` `g` ON ((`g`.`group_id` = `eto`.`group_id`)))
where eto.org_id = "', @org_id,'"
GROUP BY `eto`.`employee_id` , `eto`.`group_id`
');
-- select  @queryFrom1;
set @queryFrom2 = CONCAT('
 from
        (((`email_to_esc` `etoesc`
        left join `email_to` `eto` ON (((`eto`.`org_id` = `etoesc`.`org_id`)
            and (`eto`.`employee_id` = `etoesc`.`employee_id`)
            and (`eto`.`group_id` = `etoesc`.`group_id`))))
        left join stellarhse_auth.`employee` `e` ON ((`etoesc`.`employee_id` = `e`.`employee_id`)))
        left join stellarhse_auth.`group` `g` ON ((`g`.`group_id` = `etoesc`.`group_id`)))
where etoesc.org_id = "', @org_id,'" 
');
SET @queryWhere = ' where 1= 1 ';
-- SET @queryWhere = CONCAT(@queryWhere,' and email_to_view.org_id =   "', @org_id,'" ');
SET @queryFrom1 =  CONCAT(@queryFrom1,' having  1 = 1 ' );
SET @queryFrom2 = CONCAT(@queryFrom2,' having  1 = 1 ' );
SET @myArrayOfValue = 'email_to_id,employee_name,position,group_name,email_type_name,assigned_notifications,last_notification_sent,days_start,days_freq,days_start_inc,days_freq_inc,';
SET @Postition = LOCATE(',', @myArrayOfValue);
WHILE ( @Postition > 0 ) DO
 SET @STR = SUBSTRING(@myArrayOfValue, 1, @Postition-1);
 SET @myArrayOfValue = SUBSTRING(@myArrayOfValue, @Postition + 1);
 SET @Col =  extractvalue(xmlData, CONCAT('//',@STR));
 IF (@Col != '' AND @Col !='NULL') THEN
  -- SET @queryWhere = CONCAT(@queryWhere,CONCAT(' AND    ',@STR,' like '"'%", @Col ,"%'")); 
    SET @queryFrom2 = CONCAT(@queryFrom2,CONCAT(' AND    ',@STR,' like '"'%", @Col ,"%'")); 
      SET @queryFrom1 = CONCAT(@queryFrom1,CONCAT(' AND    ',@STR,' like '"'%", @Col ,"%'")); 
 END IF;
 
 SET @Postition = LOCATE(',', @myArrayOfValue);
END WHILE;
SET @LastSentDateFrom =  extractvalue(xmlData, '//last_sent_date_from');
SET @LastSentDateTo =  extractvalue(xmlData, '//last_sent_date_to');
IF(@LastSentDateTo ="" AND @LastSentDateFrom !="" ) THEN
	SET @LastSentDateFrom  = STR_TO_DATE(@LastSentDateFrom , '%m/%d/%Y');
	SET @LastSentDateFrom2 = DATE_ADD(@LastSentDateFrom ,INTERVAL 1 DAY) ;
    
    SET @queryFrom2 = CONCAT(@queryFrom2,'  AND last_sent_date >=  ',  "'", @LastSentDateFrom ,"'" );	
	SET @queryFrom2 = CONCAT(@queryFrom2,'  AND last_sent_date <  ', "'", @LastSentDateFrom2  ,"'");
	SET @queryFrom1 = CONCAT(@queryFrom1,'  AND last_sent_date >=  ',  "'", @LastSentDateFrom ,"'" );	
	SET @queryFrom1 = CONCAT(@queryFrom1,'  AND last_sent_date <  ', "'", @LastSentDateFrom2  ,"'");
ELSE IF(@LastSentDateTo !="") then
		SET @LastSentDateFrom  = STR_TO_DATE(@LastSentDateFrom , '%m/%d/%Y');
		SET @LastSentDateTo  = STR_TO_DATE(@LastSentDateTo , '%m/%d/%Y');
		SET @LastSentDateTo2 = DATE_ADD(@LastSentDateTo ,INTERVAL 1 DAY) ;
        SET @queryFrom1 = CONCAT(@queryFrom1,'  AND last_sent_date >  ', "'" , @LastSentDateFrom ,"'" );	
		SET @queryFrom1 = CONCAT(@queryFrom1,'  AND last_sent_date <=  ', "'",  @LastSentDateTo2  ,"'" );	
		SET @queryFrom2 = CONCAT(@queryFrom2,'  AND last_sent_date >  ', "'" , @LastSentDateFrom ,"'" );	
		SET @queryFrom2 = CONCAT(@queryFrom2,'  AND last_sent_date <=  ', "'",  @LastSentDateTo2  ,"'" );	
	END IF;
END IF;
SET @GrpOrdrQry = '
) tbl1
GROUP BY `employee_id` , `group_id`  ';
set  @selectquery=CONCAT(@selectquery1, @queryFrom1, @selectquery2, @queryFrom2, @GrpOrdrQry);
SET @query = CONCAT( @selectquery);
if( @index = 'Order') then set  @index = '`Order`';  end if;
SET @query = CONCAT(@query, ' order by ', @index,'  ', @sortOrder);
SET @query = CONCAT(@query ,  ' ;');
-- select  @query;
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1; 
SELECT FOUND_ROWS();
-- select  @query;
END$$

DELIMITER ;

/* */

/* added by Alaa Nov. 27th, 2017 */

UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.equipment' WHERE `field_id`='dev5-23847f29-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.equipment' WHERE `field_id`='dev5-238494f8-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.equipment' WHERE `field_id`='dev5-23849e12-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.equipment' WHERE `field_id`='dev5-2384a746-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.equipment' WHERE `field_id`='dev5-2384b170-b4f8-11e7-b3a0-74e6e2020496';

/* */

/* added by Alaa Dec. 6th, 2017 */

UPDATE `stellarhse_incident`.`field` SET `is_notified`='1' WHERE `field_id`='cs4sql-4f37da20-2a1e-11e6-8267-5254000a52fa';
INSERT INTO `stellarhse_incident`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'cs4sql-4f37da20-2a1e-11e6-8267-5254000a52fa', 'Corrective Actions', 0, 0);
INSERT INTO `stellarhse_hazard`.`field` (`field_id`,`field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_metrics`, `is_notified`, `is_editable`, `is_hidden`, `order`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES (myuuid(),'CorrectiveActionsHeader', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Corrective Actions', 0, '0', '1', 1, 0, '10.00', '0', 0, 0, 1);
INSERT INTO `stellarhse_hazard`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'Corrective Actions', 0, 0);
UPDATE `stellarhse_hazard`.`field` SET `is_notified`='1' WHERE `field_id`='dev5-c38b6d56-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`org_field` SET `field_label`='Report Owner' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-c38b6d56-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.metrics_scope', `table_field_name`='metrics_scope_name', `field_key`='metrics_scope_id' WHERE `field_id`='dev5-c38b6d56-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='stellarhse_common.third_party', `table_field_name`='customer_name', `field_key`='third_party_id' WHERE `field_id`='dev5-e89e1f72-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `is_notified`='0' WHERE `field_id`='dev5-5d918d6b-6ec9-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `is_notified`='0' WHERE `field_id`='dev5-2c754901-acfd-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='stellarhse_common.third_party', `table_field_name`='customer_name', `field_key`='third_party_id' WHERE `field_id`='dev5-93f5524f-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='stellarhse_common.location_view' WHERE `field_id`='dev5-93f519b3-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='stellarhse_common.location_view' WHERE `field_id`='dev5-93f51ba5-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='stellarhse_common.location_view' WHERE `field_id`='dev5-93f52184-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='stellarhse_common.location_view' WHERE `field_id`='dev5-93f5235d-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `is_notified`='0' WHERE `field_id`='dev5-fe073bd8-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `is_notified`='0' WHERE `field_id`='dev5-b9c381dd-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `is_notified`='0' WHERE `field_id`='dev5-9c408c13-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_name`='stellarhse_auth.crew', `table_field_name`='crew_name', `field_key`='crew_id' WHERE `field_id`='dev5-837e65d8-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `is_notified`='1' WHERE `field_id`='dev5-837e7ab6-ad78-11e7-8d63-74e6e2020496';

/* */

/* added by Alaa Dec. 10th, 2017 */

UPDATE `stellarhse_incident`.`field` SET `is_notified`='1' WHERE `field_id`='cs4sql-2726e131-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.metrics_scope', `table_field_name`='metrics_scope_name', `field_key`='metrics_scope_id' WHERE `field_id`='cs4sql-2726e131-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`org_field` SET `field_label`='Report Owner' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='cs4sql-2726e131-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_inspection`.`field` SET `is_notified`='1', `table_name`='stellarhse_common.metrics_scope', `table_field_name`='metrics_scope_name', `field_key`='metrics_scope_id' WHERE `field_id`='dev5-e89bb456-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`org_field` SET `field_label`='Report Owner' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-e89bb456-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `is_notified`='1', `table_name`='stellarhse_common.metrics_scope', `table_field_name`='metrics_scope_name', `field_key`='metrics_scope_id' WHERE `field_id`='dev5-93f5342e-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`org_field` SET `field_label`='Report Owner' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-93f5342e-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `is_notified`='1', `table_name`='stellarhse_common.metrics_scope', `table_field_name`='metrics_scope_name', `field_key`='metrics_scope_id' WHERE `field_id`='dev5-9c7e5ec9-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`org_field` SET `field_label`='Report Owner' WHERE `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa' and`field_id`='dev5-9c7e5ec9-6f28-11e7-8bbe-74e6e2020496';
INSERT INTO `stellarhse_training`.`field` (`field_id`, `field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_metrics`, `is_notified`, `is_editable`, `field_type_id`, `table_name`, `table_field_name`, `field_key`, `is_hidden`, `order`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES ('dev5-9c7e5ec9-6f28-11e7-8bbe-74e6e2020496', 'creator_name', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Creator Name', 0, '0', '1', 0, 'cs4sql-28dd5b30-dc5c-11e4-b362-5254000a52fa', 'stellarhse_common.metrics_scope', 'metrics_scope_name', 'metrics_scope_id', 0, '1.32', '0', 0, 0, 0);
INSERT INTO `stellarhse_training`.`org_field` (`org_id`, `field_id`, `field_label`, `help_me_name`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'dev5-9c7e5ec9-6f28-11e7-8bbe-74e6e2020496', 'Report Owner', 'CreatorName', 0, 0);
INSERT INTO `stellarhse_inspection`.`field` (`field_id`, `field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_metrics`, `is_notified`, `is_editable`, `is_hidden`, `order`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES ('debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'CorrectiveActionsHeader', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Corrective Actions', 0, '0', '1', 1, 0, '10.00', '0', 0, 0, 1);
INSERT INTO `stellarhse_inspection`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'Corrective Actions', 0, 0);
INSERT INTO `stellarhse_maintenance`.`field` (`field_id`, `field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_metrics`, `is_notified`, `is_editable`, `is_hidden`, `order`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES ('debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'CorrectiveActionsHeader', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Corrective Actions', 0, '0', '1', 1, 0, '10.00', '0', 0, 0, 1);
INSERT INTO `stellarhse_maintenance`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'Corrective Actions', 0, 0);
INSERT INTO `stellarhse_safetymeeting`.`field` (`field_id`, `field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_metrics`, `is_notified`, `is_editable`, `is_hidden`, `order`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES ('debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'CorrectiveActionsHeader', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Corrective Actions', 0, '0', '1', 1, 0, '10.00', '0', 0, 0, 1);
INSERT INTO `stellarhse_safetymeeting`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'Corrective Actions', 0, 0);
INSERT INTO `stellarhse_training`.`field` (`field_id`, `field_name`, `language_id`, `default_field_label`, `is_statistical`, `is_metrics`, `is_notified`, `is_editable`, `is_hidden`, `order`, `hide`, `is_template`, `is_mandatory`, `is_custom`) VALUES ('debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'CorrectiveActionsHeader', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Corrective Actions', 0, '0', '1', 1, 0, '10.00', '0', 0, 0, 1);
INSERT INTO `stellarhse_training`.`org_field` (`org_id`, `field_id`, `field_label`, `is_mandatory`, `is_hidden`) VALUES ('cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'debian-d9874699-dabf-11e7-81e4-00505621a9ce', 'Corrective Actions', 0, 0);

/* */

/* added by Alaa Dec. 10th, 2017 */

USE `stellarhse_common`;
DROP procedure IF EXISTS `get_org_notification_value`;
DELIMITER $$
USE `stellarhse_common`$$
CREATE PROCEDURE `get_org_notification_value`($org_id varchar(100),$field_id varchar(100),$product_code varchar(100),$injury_id text)
begin
set @lang_id=(select language_id from stellarhse_auth.organization where org_id=$org_id);
if $product_code="ABCanTrack" THEN set @db='stellarhse_incident'; set @mt='incident' ; end if;
if $product_code= "Hazard" THEN set @db='stellarhse_hazard'; set @mt='hazard';end if;
if $product_code="Inspection" THEN set @db='stellarhse_inspection';set @mt='inspection';end if;
if $product_code="SafetyMeeting" THEN set @db='stellarhse_safetymeeting'; set @mt='safetymeeting'; end if;
if $product_code="Training" THEN set @db='stellarhse_training'; set @mt='training'; end if;
if $product_code="MaintenanceManagement" THEN set @db='stellarhse_maintenance'; set @mt='maintenance';end if;
set @query=concat('select table_field_name,table_name,field_key into @table_field_name,@table_name ,@field_key from ',@db,'.field where field_id=''',$field_id,''''  );
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
 
SET @Position = LOCATE('.',@table_name);
if @position =0 then set @table_name=concat(@db,'.',@table_name);end if;
if @table_name='stellarhse_common.location_view' and @table_field_name='location1_name' then set @table_name='stellarhse_common.location1'; end if;
if @table_name='stellarhse_common.location_view' and @table_field_name='location2_name' then set @table_name='stellarhse_common.location2_view'; end if;
if @table_name='stellarhse_common.location_view' and @table_field_name='location3_name' then set @table_name='stellarhse_common.location3_view'; end if;
if @table_name='stellarhse_common.location_view' and @table_field_name='location4_name' then set @table_name='stellarhse_common.location4_view'; end if;
if @table_name='stellarhse_common.risk_level' and @table_field_name='risk_level_value' then set @table_name='stellarhse_common.risklevel_view'; end if;
if ($injury_id is null or $injury_id ='') and (lower(replace(@table_field_name,'_','')) not in ('customername','contractorname'))
then
set @query=concat('select ',@field_key,' as `id`,',@table_field_name,' as `name`');
if@table_name in ('stellarhse_common.location2_view','stellarhse_common.location3_view','stellarhse_common.location4_view')
then set @query=concat(@query,' , parent_name '); end if;
-- select @table_name;
if@table_name in ('stellarhse_common.equipment')
then set @query=concat(@query,' ,concat(equipment_name," - ",equipment_number) as name'); end if;
 
if@table_name in ('stellarhse_common.risklevel_view')
then set @query=concat(@query,' , risk_level_degree, risk_level_name '); end if;
set @query=concat(@query,'  from ',@table_name,' where hide = 0 ');
if@table_name not in ('stellarhse_common.metrics_scope', 'stellarhse_common.impact_sub_type')
then
set @query=concat(@query,'and org_id=''',$org_id,'''');
end if;
if@table_name = 'stellarhse_common.metrics_scope' then
set @query=concat(@query,'and metrics_scope_name<>''All''');
end if;
if@table_name not in ('stellarhse_common.location1','stellarhse_common.location2_view','stellarhse_common.location3_view','stellarhse_common.location4_view')
then
set @query=concat(@query,' and language_id=''',@lang_id,'''');
end if;
if@table_name in ('stellarhse_common.risklevel_view')
then set @query=concat(@query,' order by risk_level_name, risk_level_value '); end if;
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
elseif $injury_id is null or $injury_id ='' and lower(replace(@table_field_name,'_',''))  in ('customername','contractorname')
then
set @table_field_name=trim(trailing '_name' from @table_field_name);
set @query=concat('select third_party_type_id into @code  from stellarhse_common.third_party_type where org_id=''',$org_id,''' and language_id=''',@lang_id,''' and third_party_type_code like '"'%",@table_field_name,"%'"'');
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
select third_party_id as id,third_party_name as `name` from stellarhse_common.third_party where org_id=$org_id  and third_party_type_id=@code;
else
set @rst='';
if $injury_id is not null
then
set @statment=$injury_id;
set @Position = LOCATE(',',@statment);
if @Position > 0
then
theloop:loop
SET @Position = LOCATE(',',@statment);
set @restofstr=substring(@statment,@Position+1);
set @accessrole=substring(@statment,1,@Position-1);
set@rst=concat("'",@accessrole,"'",',',@rst);
set @statment=@restofstr;
SET @Position = LOCATE(',',@statment);
if @Position=0 then leave theloop ; end if;
end loop;
set@rst=concat("'",@statment,"'",',',@rst);
else
set@rst=concat("'",@accessrole,"'",',',@rst);
end if;
end if;
set @rst=trim(trailing ',' from @rst);
-- select @rst;
set @query=concat('select sp.impact_sub_type_id as id,concat(sp.impact_sub_type_name,"(",s.`impact_type_name`,")") as name,
sp.impact_type_id as impact_type_id
from stellarhse_common.impact_sub_type sp
join stellarhse_common.impact_type s on s.impact_type_id=sp.impact_type_id
 where sp.impact_type_id in(',@rst,')  and sp.language_id=''',@lang_id,'''');
-- select @query;
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
end if;
end$$
DELIMITER ;

/* */

/* added by Alaa Dec. 12th, 2017 */

UPDATE `stellarhse_incident`.`field` SET `field_name`='expired_corrective_actions_header' WHERE `field_id`='cs4sql-4f381733-2a1e-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='expired_corrective_actions_header' WHERE `field_id`='cs4sql-5623c04c-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_name`='expired_corrective_actions_header' WHERE `field_id`='cs4sql-a67f5ac6-2a29-11e6-8267-5254000a52fa';
------------------
use stellarhse_hazard;
insert into stellarhse_hazard.field values
(myuuid(), 'DaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days after expiry', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'Sürenin dolmasından sonraki gün sayısı', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Количество дней после истечения', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'E-posta hatırlatıcılarının sıklığı (gün)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Периодичность напоминания по электронной почте (дни)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('DaysStart','DaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';

use stellarhse_inspection;
insert into stellarhse_inspection.field values
(myuuid(), 'DaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days after expiry', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'Sürenin dolmasından sonraki gün sayısı', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Количество дней после истечения', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'E-posta hatırlatıcılarının sıklığı (gün)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Периодичность напоминания по электронной почте (дни)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('DaysStart','DaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';

use stellarhse_maintenance;
insert into stellarhse_maintenance.field values
(myuuid(), 'DaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days after expiry', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'Sürenin dolmasından sonraki gün sayısı', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Количество дней после истечения', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'E-posta hatırlatıcılarının sıklığı (gün)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Периодичность напоминания по электронной почте (дни)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('DaysStart','DaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';

use stellarhse_safetymeeting;
insert into stellarhse_safetymeeting.field values
(myuuid(), 'DaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days after expiry', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'Sürenin dolmasından sonraki gün sayısı', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Количество дней после истечения', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'E-posta hatırlatıcılarının sıklığı (gün)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Периодичность напоминания по электронной почте (дни)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('DaysStart','DaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';

use stellarhse_training;
insert into stellarhse_training.field values
(myuuid(), 'DaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days after expiry', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'Sürenin dolmasından sonraki gün sayısı', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysStart', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Количество дней после истечения', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-5405567e-352c-11e6-8267-5254000a52fa', 'E-posta hatırlatıcılarının sıklığı (gün)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-19 10:16:47', NULL, 0, 0, null, 0, 1),
(myuuid(), 'DaysFreq', 'cs4sql-a5753833-2a29-11e6-8267-5254000a52fa', 'Периодичность напоминания по электронной почте (дни)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-06-05 07:57:49', NULL, 0, 0,null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('DaysStart','DaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';

use stellarhse_training;
insert into stellarhse_training.field values
(myuuid(), 'OverdueTraining', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Overdue Training', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'TrainingDaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days after training to be completed by', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'TrainingDaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('OverdueTraining','TrainingDaysStart','TrainingDaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';

use stellarhse_training;
insert into stellarhse_training.field values
(myuuid(), 'ExpiryDateNotification', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Recertification/expiry date', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'ExpiryDaysStart', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Number of days in advance of expiry date', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1),
(myuuid(), 'ExpiryDaysFreq', 'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'Frequency of email reminder (days)', NULL, 0, 0, 0, 1, NULL, NULL, null, null, NULL, NULL, null, null, null, 0, '10.00', null, '2016-04-15 07:32:25', NULL, 0, 0, null, 0, 1);
insert into org_field 
select 
'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa',
field_id,
default_field_label,
default_help_me_name,
default_help_me_description,
is_mandatory,
0,
current_timestamp()
from field where field_name in('ExpiryDateNotification','ExpiryDaysStart','ExpiryDaysFreq') and language_id='cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa';
-----------
use stellarhse_common;
delimiter $$
drop procedure if exists get_escalated_field$$
CREATE PROCEDURE `get_escalated_field`($org_id varchar(100),$product_code  varchar(100))
begin
    if $product_code="ABCanTrack" THEN set @db='stellarhse_incident'; set @mt='incident' ; end if; 
	if $product_code= "Hazard" THEN set @db='stellarhse_hazard'; set @mt='hazard';end if;
	if $product_code="Inspection" THEN set @db='stellarhse_inspection';set @mt='inspection';end if; 
	if $product_code="SafetyMeeting" THEN set @db='stellarhse_safetymeeting'; set @mt='safetymeeting'; end if;
    if $product_code="Training" THEN set @db='stellarhse_training'; set @mt='training'; end if;
	if $product_code="MaintenanceManagement" THEN set @db='stellarhse_maintenance'; set @mt='maintenance';end if;

set @lang_id=(select language_id from stellarhse_auth.organization where org_id=$org_id);
set @query=concat('select f.field_id,f.field_name,f.table_field_name,replace(of.field_label,'':'','''')as field_label
from ',@db,'.field f  join ',@db,'.org_field of on   of.field_id=f.field_id where  of.is_hidden= 0   and f.language_id=''',@lang_id,'''and of.org_id=''',$org_id,'''');
if $product_code in ('Hazard','Inspection','SafetyMeeting','MaintenanceManagement')
then 
set @query=concat(@query,' and f.field_name in (''expired_corrective_actions_header'',''DaysStart'',''DaysFreq'')');
-- select @query;
end if;

if $product_code in ('ABCanTrack')
then set @query=concat(@query,' and f.field_name in(''expired_corrective_actions_header'',''InvestigationClosedHeader'',''DaysStart'',''DaysStartInc'',''DaysFreq'',''DaysFreqInc'')');
-- select @query;
end if;

if $product_code in ('Training')
then set @query=concat(@query,' and f.field_name in(''expired_corrective_actions_header'',''OverdueTraining'',''ExpiryDateNotification'',''DaysStart'',''DaysFreq'',''TrainingDaysStart'',''TrainingDaysFreq'',''ExpiryDaysStart'',''ExpiryDaysFreq'')');
-- select @query;
end if;
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
end$$
delimiter ;

---------
ALTER TABLE `stellarhse_hazard`.`email_to` 
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_incident`.`email_to` 
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_inspection`.`email_to` 
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_maintenance`.`email_to` 
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_safetymeeting`.`email_to` 
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_training`.`email_to` 
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `table_name`;

-----------

USE `stellarhse_common`;
DROP procedure IF EXISTS `get_notifications_field`;

DELIMITER $$
USE `stellarhse_common`$$
CREATE DEFINER=`devuser`@`%` PROCEDURE `get_notifications_field`($org_id varchar(100),$product_code  varchar(100))
begin

    if $product_code="ABCanTrack" THEN set @db='stellarhse_incident'; set @mt='incident' ; end if;
                if $product_code= "Hazard" THEN set @db='stellarhse_hazard'; set @mt='hazard';end if;
                if $product_code="Inspection" THEN set @db='stellarhse_inspection';set @mt='inspection';end if;
                if $product_code="SafetyMeeting" THEN set @db='stellarhse_safetymeeting'; set @mt='safetymeeting'; end if;
    if $product_code="Training" THEN set @db='stellarhse_training'; set @mt='training'; end if;
                if $product_code="MaintenanceManagement" THEN set @db='stellarhse_maintenance'; set @mt='maintenance';end if;
 
set @lang_id=(select language_id from stellarhse_auth.organization where org_id=$org_id);
set @query=concat('select f.field_id,f.field_name,f.table_field_name,replace(of.field_label,'':'','''')as field_label,f.table_name
from ',@db,'.field f join ',@db,'.org_field of on of.field_id=f.field_id where  of.is_hidden= 0  and f.is_notified=1 and f.language_id=''',@lang_id,'''and of.org_id=''',$org_id,'''');
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
end$$

DELIMITER ;

/* */

/* added by Alaa Dec. 18th, 2017 */

UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_corrective_action', `field_key`='incident_corrective_action_id' WHERE `field_id`='cs4sql-4f37da20-2a1e-11e6-8267-5254000a52fa';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='debian-d9874699-dabf-11e7-81e4-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='inspection_corrective_action', `field_key`='inspection_corrective_action_id' WHERE `field_id`='debian-d9874699-dabf-11e7-81e4-00505621a9ce';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='maintenance_followup_action', `field_key`='maintenance_followup_action_id' WHERE `field_id`='debian-d9874699-dabf-11e7-81e4-00505621a9ce';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_followup_action', `field_key`='safetymeeting_followup_action_id' WHERE `field_id`='debian-d9874699-dabf-11e7-81e4-00505621a9ce';
UPDATE `stellarhse_training`.`field` SET `table_name`='training_followup_action', `field_key`='training_followup_action_id' WHERE `field_id`='debian-d9874699-dabf-11e7-81e4-00505621a9ce';

ALTER TABLE `stellarhse_incident`.`email_to` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_hazard`.`email_to` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_inspection`.`email_to` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_maintenance`.`email_to` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_safetymeeting`.`email_to` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_training`.`email_to` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`;

ALTER TABLE `stellarhse_hazard`.`email_to_esc` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`,
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `field_id`;

UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='debian-57e59311-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='debian-57e5c9a7-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='debian-57e5f1a6-deb9-11e7-a370-00505621a9ce';

UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.third_party', `table_field_name`='contractor_name', `field_key`='third_party_id' WHERE `field_id`='dev5-c38b83a6-67a7-11e7-8bbe-74e6e2020496';

UPDATE `stellarhse_training`.`field` SET `is_notified`='0' WHERE `field_id`='dev5-b8d766a0-ad83-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_name`='training' WHERE `field_id`='dev5-b8d766a0-ad83-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_name`='training' WHERE `field_id`='debian-3c5e7834-df78-11e7-9ff5-00505621a9ce';
UPDATE `stellarhse_training`.`field` SET `table_name`='training', `table_field_name`='expiry_date' WHERE `field_id`='debian-89fa5fe4-df79-11e7-9ff5-00505621a9ce';

UPDATE `stellarhse_training`.`field` SET `table_name`='training_followup_action' WHERE `field_id`='debian-58deac69-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_training`.`field` SET `table_name`='training_followup_action' WHERE `field_id`='debian-58dee474-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_training`.`field` SET `table_name`='training_followup_action' WHERE `field_id`='debian-58df0ee4-deb9-11e7-a370-00505621a9ce';

ALTER TABLE `stellarhse_training`.`email_to_esc` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`,
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `field_id`;

ALTER TABLE `stellarhse_incident`.`email_to_esc` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`,
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `field_id`;

UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_corrective_action' WHERE `field_id`='cs4sql-4f381733-2a1e-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_corrective_action' WHERE `field_id`='cs4sql-5623c04c-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_corrective_action' WHERE `field_id`='cs4sql-a67f5ac6-2a29-11e6-8267-5254000a52fa';

UPDATE `stellarhse_incident`.`field` SET `table_name`='incident' WHERE `field_id`='cs4sql-4f387242-2a1e-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident' WHERE `field_id`='cs4sql-562420f7-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident' WHERE `field_id`='cs4sql-a67f9d73-2a29-11e6-8267-5254000a52fa';

ALTER TABLE `stellarhse_inspection`.`email_to_esc` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`,
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `field_id`;

UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='inspection_corrective_action' WHERE `field_id`='debian-57ff1c80-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='inspection_corrective_action' WHERE `field_id`='debian-580b1bf1-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='inspection_corrective_action' WHERE `field_id`='debian-580b3129-deb9-11e7-a370-00505621a9ce';

ALTER TABLE `stellarhse_maintenance`.`email_to_esc` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`,
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `field_id`;

UPDATE `stellarhse_maintenance`.`field` SET `table_name`='maintenance_followup_action' WHERE `field_id`='debian-5864c917-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='maintenance_followup_action' WHERE `field_id`='debian-5864dd3b-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='maintenance_followup_action' WHERE `field_id`='debian-5864ea9f-deb9-11e7-a370-00505621a9ce';

ALTER TABLE `stellarhse_safetymeeting`.`email_to_esc` 
ADD COLUMN `field_id` VARCHAR(50) NULL DEFAULT NULL AFTER `table_name`,
ADD COLUMN `notification_trigger_number` INT(11) NULL DEFAULT NULL AFTER `field_id`;

UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_followup_action' WHERE `field_id`='debian-58a04aef-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_followup_action' WHERE `field_id`='debian-58a08782-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_followup_action' WHERE `field_id`='debian-58a0bc57-deb9-11e7-a370-00505621a9ce';

---------------------

USE `stellarhse_common`;
DROP procedure IF EXISTS `get_escalated_field`;

DELIMITER $$
USE `stellarhse_common`$$
CREATE DEFINER=`devuser`@`%` PROCEDURE `get_escalated_field`($org_id varchar(100),$product_code  varchar(100))
begin
    if $product_code="ABCanTrack" THEN set @db='stellarhse_incident'; set @mt='incident' ; end if; 
	if $product_code= "Hazard" THEN set @db='stellarhse_hazard'; set @mt='hazard';end if;
	if $product_code="Inspection" THEN set @db='stellarhse_inspection';set @mt='inspection';end if; 
	if $product_code="SafetyMeeting" THEN set @db='stellarhse_safetymeeting'; set @mt='safetymeeting'; end if;
    if $product_code="Training" THEN set @db='stellarhse_training'; set @mt='training'; end if;
	if $product_code="MaintenanceManagement" THEN set @db='stellarhse_maintenance'; set @mt='maintenance';end if;

set @lang_id=(select language_id from stellarhse_auth.organization where org_id=$org_id);
set @query=concat('select f.field_id,f.field_name,f.table_name,replace(of.field_label,'':'','''')as field_label
from ',@db,'.field f  join ',@db,'.org_field of on   of.field_id=f.field_id where  of.is_hidden= 0   and f.language_id=''',@lang_id,'''and of.org_id=''',$org_id,'''');
if $product_code in ('Hazard','Inspection','SafetyMeeting','MaintenanceManagement')
then 
set @query=concat(@query,' and f.field_name in (''expired_corrective_actions_header'',''DaysStart'',''DaysFreq'')');
-- select @query;
end if;

if $product_code in ('ABCanTrack')
then set @query=concat(@query,' and f.field_name in(''expired_corrective_actions_header'',''InvestigationClosedHeader'',''DaysStart'',''DaysStartInc'',''DaysFreq'',''DaysFreqInc'')');
-- select @query;
end if;

if $product_code in ('Training')
then set @query=concat(@query,' and f.field_name in(''expired_corrective_actions_header'',''OverdueTraining'',''ExpiryDateNotification'',''DaysStart'',''DaysFreq'',''TrainingDaysStart'',''TrainingDaysFreq'',''ExpiryDaysStart'',''ExpiryDaysFreq'')');
-- select @query;
end if;
PREPARE stmt1 FROM @query;
EXECUTE stmt1;
DEALLOCATE PREPARE stmt1;
end$$

DELIMITER ;

/* */

/* added by Alaa Dec. 21st, 2017 */

UPDATE `stellarhse_inspection`.`field` SET `table_name`='inspection_corrective_action', `table_field_name`='' WHERE `field_id`='debian-57ff1c80-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='inspection_corrective_action', `table_field_name`='' WHERE `field_id`='debian-580b1bf1-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='inspection_corrective_action', `table_field_name`='' WHERE `field_id`='debian-580b3129-deb9-11e7-a370-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='stellarhse_common.third_party', `table_field_name`='contractor_name', `field_key`='third_party_id' WHERE `field_id`='dev5-e89e21cb-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_name`='stellarhse_common.third_party', `table_field_name`='contractor_name', `field_key`='third_party_id' WHERE `field_id`='dev5-93f5546a-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_third_party', `table_field_name`='customer_name', `field_key`='third_party_id' WHERE `field_id`='dev5-9c7e835f-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_third_party', `table_field_name`='contractor_name', `field_key`='third_party_id' WHERE `field_id`='dev5-9c7e857a-6f28-11e7-8bbe-74e6e2020496';

/* */

/* added by Alaa Jan. 2nd, 2018 */

UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1e03e-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1e528-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1e75c-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1e96d-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1eb4f-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1edc1-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action_notified', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1e2e9-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1efdc-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1f6c1-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-0ab1fad3-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-0ae3e357-6bdc-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-0c0a40c3-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-0c2200bc-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-0c249c5b-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-0c2ffe9a-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.equipment', `field_key`='equipment_id' WHERE `field_id`='dev5-0c34c401-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.equipment', `field_key`='equipment_id' WHERE `field_id`='dev5-0c46c9da-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.equipment', `field_key`='equipment_id' WHERE `field_id`='dev5-0c47688f-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.equipment', `field_key`='equipment_id' WHERE `field_id`='dev5-0c47ebf1-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-0c4bec35-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_note', `field_key`='hazard_id' WHERE `field_id`='dev5-47b904da-6be3-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_cause_note', `field_key`='hazard_id' WHERE `field_id`='dev5-47bc06ba-6be3-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c3890b2b-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c3890f57-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-573d3f6f-6acf-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_corrective_action', `field_key`='hazard_corrective_action_id' WHERE `field_id`='dev5-9db6c063-ae56-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_number', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b635b-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='version_number', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b6547-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b672a-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b694a-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_other_location', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b72d5-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='modifier_id', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b7670-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b7a4f-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_date', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b7e1e-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_desc', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b7fec-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_third_party', `field_key`='hazard_third_party_id' WHERE `field_id`='dev5-c38b8574-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_third_party', `field_key`='hazard_third_party_id' WHERE `field_id`='dev5-c38b8747-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_third_party', `field_key`='hazard_third_party_id' WHERE `field_id`='dev5-c38b534c-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_third_party', `field_key`='hazard_third_party_id' WHERE `field_id`='dev5-c38b5950-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `table_field_name`='hazard_suspected_cause', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b891f-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b8fd1-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b91a9-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b9a9f-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b9cd9-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38b9fa2-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38ba20a-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38ba40b-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_third_party', `field_key`='hazard_third_party_id' WHERE `field_id`='dev5-c38ba60c-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard', `field_key`='hazard_id' WHERE `field_id`='dev5-c38baa47-67a7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da05f26a-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da05f67b-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da05fc41-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da060135-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da0606e1-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da060a30-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da060d65-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da061062-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da0613fe-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-da226079-6ac6-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-e5f419a6-6aca-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='hazard_people_involved', `field_key`='people_involved_id' WHERE `field_id`='dev5-e6075ad3-6aca-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.how_involved_field', `field_key`='how_involved_id' WHERE `field_id`='dev5-da225ab3-6ac6-11e7-8bbe-74e6e2020496';

/* */

/* added by Alaa Jan. 9th, 2018 */

USE `stellarhse_hazard`;
DROP procedure IF EXISTS `reload_data`;

DELIMITER $$
USE `stellarhse_hazard`$$
CREATE DEFINER=`devuser`@`%` PROCEDURE `reload_data`($hazard_number int,$org_id varchar(100))
begin
SET @@session.group_concat_max_len = 10000000000000000; 
set @hazard_id=(select hazard_id from hazard where hazard_number=$hazard_number and org_id=$org_id and  version_number=(select max(version_number) from hazard where hazard_number=$hazard_number and org_id=$org_id));
select 
h.event_type_id as `report_type_id`,
h.other_event_type as `other_event_type`,
h.hazard_record_number as `hazard_record_number`,
hev.`haz_type_name` as `hazard_type_name`,
h.`hazard_date` as `report_date`,
h.`hazard_time` as `report_hour`,
h.`hazard_min` as `report_min`,
`h`.`reporter_id`,
concat(e1.first_name,' ',e1.last_name) as reporter_name,
`h`.`rep_name`,
`h`.`rep_emp_id`,
`h`.`rep_crew`,
`h`.`rep_email`,
`h`.`rep_position`,
`h`.`rep_company`,
`h`.`rep_primary_phone`,
`h`.`rep_alternate_phone`,
`h`.`rep_supervisor`,
`h`.`location1_id`,
`h`.`location2_id`,
`h`.`location3_id`,
`h`.`location4_id`,
`l1`.`location1_name`,
`l2`.`location2_name`,
`l3`.`location3_name`,
`l4`.`location4_name`,
`h`.`crew_involved` as crew_id,
cr.crew_name as crew_involved_name,
`h`.`operation_type_id`,
`otn`.`operation_type_name` AS `operation_type_name`,
`h`.`hazard_desc` as `report_description`,
`h`.`hazard_suspected_cause` as `report_suspected_cause`,
`h`.`initial_action_token`,
`h`.`hazard_status_id` as `hazard_status`,
`hs`.`status_Name` AS `status`,
`h`.`are_additional_corrective_actions_required`,
`h`.`recommended_corrective_actions_summary`,
`h`.`potential_impacts_desc`,
`h`.`should_work_stopped`,
`h`.`creator_id`,
`h`.`hazard_number`,
`h`.`hazard_note`,
`h`.`hazard_cause_note`,
`h`.`hazard_other_location` as `other_location`,
`h`.`is_deleted`,
`h`.`last_update_date`,
`h`.`editing_by`,
`h`.`hide`,
concat(e2.first_name,' ',e2.last_name) as editing_by_name
from hazard  h 
        LEFT JOIN `stellarhse_auth`.`employee` `e1` ON `e1`.`employee_id` = `stellarhse_hazard`.`h`.`reporter_id`
        LEFT JOIN `stellarhse_auth`.`employee` `e2` ON `e2`.`employee_id` = `stellarhse_hazard`.`h`.`editing_by`
LEFT JOIN `stellarhse_common`.`location1` `l1` ON `l1`.`location1_id` = `stellarhse_hazard`.`h`.`location1_id`
        LEFT JOIN `stellarhse_common`.`location2` `l2` ON `l2`.`location2_id` = `stellarhse_hazard`.`h`.`location2_id`
        LEFT JOIN `stellarhse_common`.`location3` `l3` ON `l3`.`location3_id` = `stellarhse_hazard`.`h`.`location3_id`
        LEFT JOIN `stellarhse_common`.`location4` `l4` ON `l4`.`location4_id` = `stellarhse_hazard`.`h`.`location4_id`
LEFT JOIN `stellarhse_hazard`.`hazard_event_type` `hev` ON `hev`.`event_type_id` = `stellarhse_hazard`.`h`.`event_type_id`
LEFT JOIN `stellarhse_common`.`operation_type` `otn` ON `otn`.`operation_type_id` = `stellarhse_hazard`.`h`.`operation_type_id`
LEFT JOIN `stellarhse_common`.`status` `hs` ON `hs`.`status_id` = `stellarhse_hazard`.`h`.`hazard_status_id`
        LEFT JOIN `stellarhse_auth`.`crew` `cr` ON `cr`.`crew_id` = `stellarhse_hazard`.`h`.`crew_involved`
where hazard_id=@hazard_id;
select 
hth.third_party_id,
tp.third_party_name,
hth.jop_number,
hth.contact_name,
tht.third_party_type_code
from hazard_third_party hth
left join stellarhse_common.third_party  tp on tp.third_party_id=hth.third_party_id 
left join stellarhse_common.third_party_type tht on tp.third_party_type_id = tht.third_party_type_id where hth.hazard_id=@hazard_id;
select 
he.equipment_id ,
`e`.`equipment_type`,
`e`.`equipment_category_name`,
`e`.`equipment_name`,
`e`.`equipment_number`
from hazard_equipment he left join stellarhse_common.equipment e on e.equipment_id=he.equipment_id
where he.hazard_id=@hazard_id;
SELECT hi.impact_type_id
FROM`stellarhse_hazard`.`hazard_impact` `hi`
where hazard_id=@hazard_id;
 -- risk_level   
  SELECT `stellarhse_hazard`.`hazard`.`hazard_id` AS `hazard_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_hazard`.`hazard_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`hazard_id` = `stellarhse_hazard`.`hazard`.`hazard_id`)
                    AND (`rl`.`risk_level_key` = 'hazard_exist'))) AS `hazard_exist_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_hazard`.`hazard_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`hazard_id` = `stellarhse_hazard`.`hazard`.`hazard_id`)
                    AND (`rl`.`risk_level_key` = 'worker_exposure'))) AS `worker_exposure_id`,
        (SELECT 
        hrl.risk_level_id
            FROM
                (`stellarhse_common`.`risk_level` `rl`
                JOIN `stellarhse_hazard`.`hazard_risk_level` `hrl` ON ((`hrl`.`risk_level_id` = `rl`.`risk_level_id`)))
            WHERE
                ((`hrl`.`hazard_id` = `stellarhse_hazard`.`hazard`.`hazard_id`)
                    AND (`rl`.`risk_level_key` = 'potential_consequences'))) AS `potential_consequences_id`
    FROM
        `stellarhse_hazard`.`hazard`
    
        where hazard_id =@hazard_id;
        select `risk_control_id` from `stellarhse_hazard`.`hazard_risk_control`
       WHERE  hazard_id=@hazard_id;
  -- hazard_details_tab     
        SELECT * from hazard_details_view where hazard_id=@hazard_id;

SELECT
    `hp`.`people_involved_id`,
    `hp`.`hazard_id`,
    `hp`.`people_id`,
        IF(ISNULL(`hp`.`people_id`),
            `tp`.`contact_name`,
            `e`.`full_name`) AS `people_involved_name`,
    `hp`.`third_party_id`,
    `hp`.`company`,
    `hp`.`supervisor`,
    `hp`.`position`,
    `hp`.`email`,
    `hp`.`primary_phone`,
    `hp`.`alternate_phone`,
    `hp`.`exp_in_current_postion`,
    `hp`.`exp_over_all`,
    `hp`.`age`,
    `hp`.`crew`,
    `hp`.`how_he_involved`,
    `hp`.`role_description`,
    `hp`.`last_update_date`,
    `hp`.`editing_by`,
    `hp`.`hide`,
    (select GROUP_CONCAT(ma.acting_id SEPARATOR ',') 
    FROM
        `stellarhse_hazard`.`hazard_acting` `ma`
        JOIN `stellarhse_common`.`acting` `a` ON `a`.`acting_id` = `ma`.`acting_id` where  `hp`.`people_involved_id`=ma.people_involved_id)as acting,
        
      (  SELECT 
        GROUP_CONCAT(mc.certificate_id SEPARATOR ',') 
    FROM
        `stellarhse_hazard`.`hazard_certificate` `mc`
        JOIN `stellarhse_common`.`certificate` `c` ON `c`.`certificate_id` = `mc`.`certificate_id` where  `hp`.`people_involved_id`=mc.people_involved_id) as certificate
        
FROM `stellarhse_hazard`.`hazard_people_involved` `hp`
left join stellarhse_auth.get_user_info e on  e.employee_id = hp.people_id
left join stellarhse_common.third_party tp on tp.third_party_id = hp.third_party_id 
 where hp.hazard_id =@hazard_id and e.org_id = $org_id;

  -- corrective_action
  
  SELECT 
    `hc`.`hazard_corrective_action_id`,
    `hc`.`hazard_id`,
    `hc`.`corrective_action_status_id`,
    s.corrective_action_status_name,
    `hc`.`corrective_action_priority_id`,
    p.corrective_action_priority_name,
    `hc`.`assigned_to_id`,
    concat(e.first_name,' ',e.last_name) as assigned_to_name,
    e.`position`,
    e.`org_name`,
    `hc`.`supervisor`,
    `hc`.`supervisor_notify`,
    `hc`.`start_date`,
    `hc`.`target_end_date`,
    `hc`.`actual_end_date`,
    `hc`.`estimated_cost`,
    `hc`.`actual_cost`,
    `hc`.`task_description`,
    `hc`.`out_come_follow_up`,
CASE `hc`.`desired_results` WHEN '0' THEN '0' WHEN '1' THEN '1' END as `desired_results`,
    `hc`.`comments`
FROM `stellarhse_hazard`.`hazard_corrective_action` hc
left join stellarhse_common.corrective_action_status s on s.corrective_action_status_id=hc.corrective_action_status_id
left join stellarhse_common.corrective_action_priority p on p.corrective_action_priority_id=hc.corrective_action_priority_id
left join stellarhse_auth.get_user_info e on  e.employee_id=hc.assigned_to_id
where hc.hazard_id=@hazard_id and e.org_id = $org_id;
select `hc`.`hazard_corrective_action_id`,hcn.`notified_id`, e.`full_name`, e.`position`, e.`org_name` from `stellarhse_hazard`.`hazard_corrective_action_notified` hcn
join  `stellarhse_hazard`.`hazard_corrective_action` hc on hc.hazard_corrective_action_id = hcn.hazard_corrective_action_id
join `stellarhse_hazard`.`hazard` h on h.hazard_id = hc.hazard_id
join stellarhse_auth.get_user_info e on  e.employee_id = hcn.notified_id
       WHERE h.hazard_id=@hazard_id and e.org_id = $org_id;
end$$

DELIMITER ;

/* */

/* added by Alaa Jan. 18th, 2018 */

UPDATE `stellarhse_hazard`.`field` SET `table_name`='stellarhse_common.risklevel_view' WHERE `field_id`='dev5-c38b8dd5-67a7-11e7-8bbe-74e6e2020496';

INSERT INTO `stellarhse_hazard`.`email_template` (`template_id`,`language_id`, `org_id`, `email_type_id`, `subject`, `body`, `is_active`, `order`) VALUES (myuuid(),'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'cs4sql-37fac449-dc5c-11e4-b362-5254000a52fa', 'New Hazard Template', 'A New hazard Report involving $event_type_id is available for your review', 1, '1');

ALTER TABLE `stellarhse_hazard`.`email_template` 
CHANGE COLUMN `updated_date` `updated_date` DATETIME NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ;

ALTER TABLE `stellarhse_incident`.`email_template` 
CHANGE COLUMN `updated_date` `updated_date` DATETIME NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ;

UPDATE `stellarhse_hazard`.`email_template` SET `email_type_id`='cs4sql-37d91cbf-dc5c-11e4-b362-5254000a52fa' WHERE `template_id`='debian-7a7ae10c-fc1f-11e7-a954-00505621a9ce';
UPDATE `stellarhse_incident`.`email_template` SET `email_type_id`='cs4sql-37d91cbf-dc5c-11e4-b362-5254000a52fa', `subject`='New Incident Template', `body`='<p>A New incident Report involving $incident_event_type_id is available for your review</p>' WHERE `template_id`='cs4sql-0126df45-f268-11e4-9d99-5254000a52fa';
UPDATE `stellarhse_incident`.`email_template` SET `org_id`='cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', `subject`='New Incident Template', `body`='<p>A New incident Report involving $incident_event_type_id_type_id is available for your review</p>' WHERE `template_id`='cs4sql-0126df45-f268-11e4-9d99-5254000a52fa';

ALTER TABLE `stellarhse_inspection`.`email_template` 
CHANGE COLUMN `updated_date` `updated_date` DATETIME NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ;

INSERT INTO `stellarhse_inspection`.`email_template` (`template_id`,`language_id`, `org_id`, `email_type_id`, `subject`, `body`, `is_active`, `order`) VALUES (myuuid(),'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'cs4sql-37d91cbf-dc5c-11e4-b362-5254000a52fa', 'New inspection Template', '<p>A New inspection Report involving $incident_event_type_id_type_id is available for your review</p>', 1, '1');
UPDATE `stellarhse_inspection`.`email_template` SET `body`='<p>A New inspection Report involving $inspection_type_id is available for your review</p>' WHERE `template_id`='debian-92e71f21-fc93-11e7-b5d6-00505621a9ce';

ALTER TABLE `stellarhse_safetymeeting`.`email_template` 
CHANGE COLUMN `updated_date` `updated_date` DATETIME NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ;

ALTER TABLE `stellarhse_training`.`email_template` 
CHANGE COLUMN `updated_date` `updated_date` DATETIME NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ;

INSERT INTO `stellarhse_maintenance`.`email_template` (`template_id`,`language_id`, `org_id`, `email_type_id`, `subject`, `body`) VALUES (myuuid(),'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'cs4sql-37d91cbf-dc5c-11e4-b362-5254000a52fa', 'New Maintenance Template', '<p>A New maintenance Report involving $maintenance_type_id is available for your review</p>');
UPDATE `stellarhse_maintenance`.`email_template` SET `is_active`=1, `order`='1' WHERE `template_id`='debian-6b82740d-fc95-11e7-b5d6-00505621a9ce';

INSERT INTO `stellarhse_safetymeeting`.`email_template` (`template_id`,`language_id`, `org_id`, `email_type_id`, `subject`, `body`, `is_active`, `order`) VALUES (myuuid(),'cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'cs4sql-37d91cbf-dc5c-11e4-b362-5254000a52fa', 'New Safety Meeting Template', '<p>A New safetymeeting Report involving $safetymeeting_type_id is available for your review</p>', 1, '1');

INSERT INTO `stellarhse_training`.`email_template` (`language_id`, `org_id`, `email_type_id`, `subject`, `body`, `is_active`, `order`) VALUES ('cs4sql-3daf2a4e-dc78-11e4-b362-5254000a52fa', 'cs4sql-a592668d-dc76-11e4-b362-5254000a52fa', 'cs4sql-37d91cbf-dc5c-11e4-b362-5254000a52fa', 'New training Template', '<p>A New training Report involving $training_type_id is available for your review</p>', 1, '1');

/* */

/* added by Alaa Jan. 30th, 2018 */

UPDATE `stellarhse_hazard`.`field` SET `table_field_name`='actual_end_date' WHERE `field_id`='dev5-0ab1e96d-6ac7-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='Inspection_time' WHERE `field_id`='dev5-e897add1-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='inspection_number' WHERE `field_id`='dev5-e89ba735-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='modifier_id' WHERE `field_id`='dev5-e89bb9e9-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='inspection_date' WHERE `field_id`='dev5-e89e1908-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='inspection_hour' WHERE `field_id`='dev5-e89e3392-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_inspection`.`field` SET `table_name`='stellarhse_common.impact_type', `table_field_name`='impact_type_name', `field_key`='impact_type_id' WHERE `field_id`='dev5-e8c08995-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_field_name`='actual_end_date' WHERE `field_id`='dev5-2c75574c-acfd-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_field_name`='maintenance_date' WHERE `field_id`='dev5-93f54da9-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_field_name`='other_location' WHERE `field_id`='dev5-93f537f8-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting', `table_field_name`='safetymeeting_number', `field_key`='safetymeeting_id' WHERE `field_id`='dev5-9c7e53e7-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_field_name`='safetymeeting_hour' WHERE `field_id`='dev5-9c7e9106-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_field_name`='safetymeeting_date' WHERE `field_id`='dev5-9c7e7f00-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_field_name`='safetymeeting_other_location' WHERE `field_id`='dev5-9c7e6a6f-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting', `table_field_name`='crew_involved', `field_key`='safetymeeting_id' WHERE `field_id`='dev5-9c7e2dc1-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_name`='safetymeeting_third_party' WHERE `field_id`='dev5-9c7e8962-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_field_name`='customer_job_number' WHERE `field_id`='dev5-9c7e8785-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_field_name`='actual_end_date' WHERE `field_id`='dev5-b9c80684-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_field_name`='traininy_completed_by' WHERE `field_id`='dev5-837eb86f-ad78-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_field_name`='staff_member_id' WHERE `field_id`='dev5-3bff8d49-ad7e-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_name`='training', `table_field_name`='third_party_id', `field_key`='training_id' WHERE `field_id`='dev5-3c10d41a-ad7e-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_name`='training', `field_key`='training_id' WHERE `field_id`='dev5-b8d75e6d-ad83-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_name`='training', `field_key`='training_id' WHERE `field_id`='dev5-b8d763e1-ad83-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_date', `field_key`='incident_id' WHERE `field_id`='cs4sql-275d61d5-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_date', `field_key`='incident_id' WHERE `field_id`='cs4sql-5604bb45-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_date', `field_key`='incident_id' WHERE `field_id`='cs4sql-a657819a-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_number', `field_key`='incident_id' WHERE `field_id`='cs4sql-5603581c-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_number', `field_key`='incident_id' WHERE `field_id`='cs4sql-a656d06b-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-272ef1f4-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_hour', `field_key`='incident_id' WHERE `field_id`='cs4sql-2796b968-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_hour', `field_key`='incident_id' WHERE `field_id`='cs4sql-56081b77-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_hour', `field_key`='incident_id' WHERE `field_id`='cs4sql-a658cd7c-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_hour', `field_key`='incident_id' WHERE `field_id`='cs4sql-d279dee3-2b6b-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_minute', `field_key`='incident_id' WHERE `field_id`='cs4sql-27d2cfca-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='incident_description', `field_key`='incident_id' WHERE `field_id`='cs4sql-27606e3b-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-262073ba-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-26377a24-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-28543e0f-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-55fdcfc8-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-55fedbf0-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-560a17d4-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-560b0765-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-560bf934-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-560cf4cc-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-a65418cd-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-a654892a-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-a659e03a-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-a65a5d8a-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-a65b3958-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-a65bb50d-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='debian-8e18181e-b772-11e7-9421-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `field_key`='incident_id' WHERE `field_id`='cs4sql-28a36c1b-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_key`='incident_id' WHERE `field_id`='cs4sql-288f9910-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_key`='incident_id' WHERE `field_id`='cs4sql-287b49aa-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-266f86a1-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-2767aeae-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-56014a7d-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-56052ab7-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-a655c691-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-a657b509-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-5604e528-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-a65795b8-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-5604f90d-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='stellarhse_common.third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-a657a0d9-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_key`='incident_id' WHERE `field_id`='cs4sql-27823fbf-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_key`='incident_id' WHERE `field_id`='cs4sql-56073d47-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_key`='incident_id' WHERE `field_id`='cs4sql-a6585a14-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `field_key`='equipment_id' WHERE `field_id`='dev5-238494f8-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `field_key`='equipment_id' WHERE `field_id`='dev5-23849e12-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `field_key`='equipment_id' WHERE `field_id`='dev5-2384a746-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `field_key`='equipment_id' WHERE `field_id`='dev5-2384b170-b4f8-11e7-b3a0-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-27593664-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `field_key`='incident_id' WHERE `field_id`='cs4sql-276f2416-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28b071c1-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_third_party', `field_key`='third_party_id' WHERE `field_id`='cs4sql-266e1bf9-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-289a7842-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560c8035-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65b7e6c-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-289e19c5-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560ca8c6-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65b956d-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-289c5db2-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560c94ab-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65b8b1a-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='debian-8e161a93-b772-11e7-9421-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='incident_people_involved' WHERE `field_id`='debian-8e18293c-b772-11e7-9421-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28a1abc5-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28a52a95-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560cd934-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560d0936-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65baa9b-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65bbf59-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-289fefb6-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560cbf0d-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-f2e7a30f-2b0b-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28a6eb44-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28a8a904-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560d1e96-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560d3300-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65bc9a2-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65bd581-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28aa99a1-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560d476e-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65bdfcc-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-28ae34a0-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-560d753e-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_people_involved', `field_key`='people_involved_id' WHERE `field_id`='cs4sql-a65bf788-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='scat_analysis', `field_key`='scat_analysis_id' WHERE `field_id`='debian-3c08247a-bcc6-11e7-a55b-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_name`='scat_analysis', `field_key`='scat_analysis_id' WHERE `field_id`='debian-3c0c2b59-bcc6-11e7-a55b-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_field_name`='basic_cause_type' WHERE `field_id`='debian-3c0c2b59-bcc6-11e7-a55b-00505621a9ce';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `table_field_name`='observation_and_analysis_param_name', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-55fe0491-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param' WHERE `field_id`='cs4sql-56046b9c-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `table_field_name`='observation_and_analysis_param_name', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-560d9e3b-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_analysis_param', `table_field_name`='observation_and_analysis_param_name', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-a6542d61-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='observation_and_analysis_param', `field_key`='observation_and_analysis_param_id' WHERE `field_id`='cs4sql-a65c105e-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='sub_standard_action_note', `field_key`='incident_id' WHERE `field_id`='cs4sql-28b63611-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_field_name`='risk_of_recurrence_name' WHERE `field_id`='cs4sql-a6580505-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='investigation_sign_off_date', `field_key`='incident_id' WHERE `field_id`='cs4sql-56000022-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='investigation_sign_off_date', `field_key`='incident_id' WHERE `field_id`='cs4sql-a6553080-2a29-11e6-8267-5254000a52fa';

/* */

/* added by Alaa Jan. 31th, 2018 */

UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `table_field_name`='impact_description', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-56078db0-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-278da455-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-278fb703-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-2791752e-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `table_field_name`='initial_employee_dept1', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-2793304f-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `table_field_name`='initial_employee_dept2', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-2794f132-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `table_field_name`='initial_employee_dept3', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-27987969-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-279a39d4-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `table_field_name`='estimated_cost', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-26abf4ee-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_corrective_action', `field_key`='incident_corrective_action_id' WHERE `field_id`='cs4sql-5600afdc-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_corrective_action', `field_key`='incident_corrective_action_id' WHERE `field_id`='cs4sql-a6558a46-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-56027cc3-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_impact', `field_key`='incident_impact_id' WHERE `field_id`='cs4sql-a65661bc-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_injury', `table_field_name`='personal_injured_name', `field_key`='incident_injury_id' WHERE `field_id`='cs4sql-279e0bce-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_illness', `table_field_name`='personal_afflicted_name', `field_key`='incident_illness_id' WHERE `field_id`='cs4sql-283584e2-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_illness', `table_field_name`='personal_afflicted_name', `field_key`='incident_illness_id' WHERE `field_id`='cs4sql-56098919-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_illness', `table_field_name`='personal_afflicted_name', `field_key`='incident_illness_id' WHERE `field_id`='cs4sql-a659936d-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-2858306c-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-285bad93-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `table_field_name`='what_was_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-2862c400-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `table_field_name`='how_spill_release_occur', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-28647c4b-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-286641dc-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-285f2cca-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-560a7281-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-560a9b5f-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-a65a0a4c-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_spill_release', `field_key`='incident_spill_release_id' WHERE `field_id`='cs4sql-a65a2333-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='quantity_unit', `table_field_name`='quantity_unit_name', `field_key`='quantity_unit_id' WHERE `field_id`='cs4sql-560a871d-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='quantity_unit', `table_field_name`='quantity_unit_name', `field_key`='quantity_unit_id' WHERE `field_id`='cs4sql-a65a1632-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `table_field_name`='driver_name', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-288a483a-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `table_field_name`='driver_licence', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-288c03af-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-28916229-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `table_field_name`='damage_description', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-289324e1-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `table_field_name`='how_did_that_occur', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-2898b20f-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-2894f36f-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-560c425d-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-a65b5f10-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-2896eb0a-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-560c56cf-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_traffic_violation', `field_key`='incident_traffic_violation_id' WHERE `field_id`='cs4sql-a65b6994-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='driver_name', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-287f56dd-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='driver_licence', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-28817c11-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='vehicle_licence', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-288509f2-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-2886d046-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-28888b99-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='driver_name', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-560b30b9-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='vehicle_licence', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-560b45f3-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='vehicle_type', `table_field_name`='vehicle_type_name', `field_key`='vehicle_type_id' WHERE `field_id`='cs4sql-560b5a2a-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='vehicle_licence', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-560b6e48-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-560ba43b-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='driver_name', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-a65a7286-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='driver_licence', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-a65a7c9e-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='vehicle_type', `table_field_name`='vehicle_type_name', `field_key`='vehicle_type_id' WHERE `field_id`='cs4sql-a65a86b7-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-a65b0fe8-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_vehicle_damage', `table_field_name`='vehicle_licence', `field_key`='incident_vehicle_damage_id' WHERE `field_id`='cs4sql-a65a9482-2a29-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_illness', `table_field_name`='personal_afflicted_name', `field_key`='incident_illness_id' WHERE `field_id`='cs4sql-26772556-dc5c-11e4-b362-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_illness', `table_field_name`='personal_afflicted_name', `field_key`='incident_illness_id' WHERE `field_id`='cs4sql-5601b06d-352c-11e6-8267-5254000a52fa';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident_illness', `table_field_name`='personal_afflicted_name', `field_key`='incident_illness_id' WHERE `field_id`='cs4sql-a655fc15-2a29-11e6-8267-5254000a52fa';

/* */

/* added by Alaa Jan. 3rd, 2018 */

UPDATE `stellarhse_hazard`.`email_template` SET `subject`='Hazard Report', `body`='Please find the following hazard report data:' WHERE `template_id`='debian-7a7ae10c-fc1f-11e7-a954-00505621a9ce';

/* */

/* added by Alaa Feb. 10th, 2018 */

UPDATE `stellarhse_hazard`.`field` SET `table_field_name`='rep_emp_id' WHERE `field_id`='dev5-0c2200bc-6b85-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_incident`.`field` SET `table_name`='incident', `table_field_name`='rep_emp_id', `field_key`='incident_id' WHERE `field_id`='debian-71016c10-b78f-11e7-9421-00505621a9ce';
UPDATE `stellarhse_inspection`.`field` SET `table_field_name`='rep_emp_id' WHERE `field_id`='dev5-e897b2bb-6c68-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_maintenance`.`field` SET `table_field_name`='rep_emp_id' WHERE `field_id`='dev5-93e48a63-acfc-11e7-8d63-74e6e2020496';
UPDATE `stellarhse_safetymeeting`.`field` SET `table_field_name`='rep_emp_id' WHERE `field_id`='dev5-9c6e379a-6f28-11e7-8bbe-74e6e2020496';
UPDATE `stellarhse_training`.`field` SET `table_field_name`='assigned_to_emp_id' WHERE `field_id`='dev5-837e616a-ad78-11e7-8d63-74e6e2020496';

/* */